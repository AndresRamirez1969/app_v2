import{s as w,o as c,a as s,d as o,w as l,e as h,ae as G,ao as fe,ap as ge,_ as ye,a0 as ve,A as se,B as V,J as m,q as ke,aq as we,u as R,c as k,al as $,v as ne,V as te,b as K,Q as J,a2 as W,t as P,am as ie,ab as me,l as S,N as xe,S as ae,G as Ce,p as X,m as Y,C as b,H as re,f as q,x as le,L as Q,ar as pe,ai as Z,as as Ve,U as ee,af as he,ag as _e,at as be,b5 as Ae,b3 as ue,au as Se,an as $e,K as ze,a8 as Le}from"./index-mAfd8qbF.js";import{b as Be,k as Ee,l as De,p as Pe,e as Ie,f as Fe,g as Ne,i as de}from"./mdi-CCqP_oQm.js";import{_ as ce}from"./StatusChip-ejlLwmE5.js";/* empty css                */const Ue={class:"d-flex justify-center mt-4"},Me={__name:"BusinessTableMeta",props:{items:{type:Array,default:()=>[]},page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean},emits:["update:page","sort"],setup(j,{emit:U}){const C=j,y=U;return(g,r)=>{var f;return c(),w("div",null,[s(fe,{density:"comfortable",class:"fixed-table elevation-1 rounded-lg"},{default:l(()=>[o("thead",null,[o("tr",null,[o("th",{onClick:r[0]||(r[0]=p=>y("sort","folio")),class:"cursor-pointer folio-header"},[r[5]||(r[5]=h(" Folio ")),G(g.$slots,"sort-icon",{column:"folio"})]),r[8]||(r[8]=o("th",{class:"logo-header"},"Logo",-1)),o("th",{onClick:r[1]||(r[1]=p=>y("sort","legal_name")),class:"cursor-pointer legal-header"},[r[6]||(r[6]=h(" Nombre Legal ")),G(g.$slots,"sort-icon",{column:"legal_name"})]),o("th",{onClick:r[2]||(r[2]=p=>y("sort","address")),class:"cursor-pointer address-header"},[r[7]||(r[7]=h(" Dirección ")),G(g.$slots,"sort-icon",{column:"address"})]),r[9]||(r[9]=o("th",{class:"status-header"},"Estado",-1)),r[10]||(r[10]=o("th",{class:"actions-header"},null,-1))])]),o("tbody",null,[G(g.$slots,"rows")])]),_:3}),o("div",Ue,[s(ge,{modelValue:C.page,"onUpdate:modelValue":[r[3]||(r[3]=p=>C.page=p),r[4]||(r[4]=p=>y("update:page",p))],length:Math.ceil((((f=C.items)==null?void 0:f.length)||1)/C.itemsPerPage),"total-visible":"7",color:"primary"},null,8,["modelValue","length"])])])}}},Te={key:0,class:"text-center py-8"},je={key:0,class:"text-center py-8"},He={class:"logo-container-mobile"},Oe=["src"],qe={class:"d-flex align-center mb-1",style:{"justify-content":"space-between"}},Ke={class:"text-caption",style:{"margin-right":"8px"}},Re={key:1},Ge={class:"font-weight-medium mb-1"},Je={class:"text-caption"},Qe=["onClick"],We={class:"folio-cell"},Xe={key:1},Ye={class:"logo-cell"},Ze=["src"],et={class:"legal-cell"},tt={class:"address-cell"},at={class:"status-cell"},lt={__name:"BusinessList",props:{items:Array,isMobile:Boolean,isLoading:Boolean},setup(j){const U=j,C=ve(),y=se(),g=V(()=>y.user||{roles:[],permissions:[]}),r=V(()=>g.value.roles||[]),f=V(()=>g.value.permissions||[]),p=V(()=>r.value.includes("superadmin")),_=V(()=>r.value.includes("admin")),z=V(()=>p.value||_.value),L=V(()=>f.value.includes("business.update")),x=V(()=>f.value.includes("business.view")),M=V(()=>x.value||L.value||z.value),A=m("folio"),E=m(!1),D=m(1),B=m(10),n=u=>{A.value===u?E.value=!E.value:(A.value=u,E.value=!1)},a=u=>{if(!u)return"No disponible";const i=[u.street,u.outdoor_number,u.neighborhood,u.city,u.postal_code,u.state,u.country].filter(Boolean);return i.length?i.join(", "):"No disponible"},v=(u,i=60)=>u?u.length>i?u.slice(0,i)+"...":u:"",I=V(()=>[...U.items].sort((u,i)=>{var e,d;const N=A.value==="address"?a(u.address).toLowerCase():((e=u[A.value])==null?void 0:e.toString().toLowerCase())??"",t=A.value==="address"?a(i.address).toLowerCase():((d=i[A.value])==null?void 0:d.toString().toLowerCase())??"";return N.localeCompare(t)*(E.value?-1:1)})),F=V(()=>{const u=(D.value-1)*B.value;return I.value.slice(u,u+B.value)}),T=u=>C.push({path:`/empresas/editar/${u.id}`}),H=u=>C.push({path:`/empresas/${u.id}`}),O=async u=>{if(!z.value)return;const N=u.status==="activa"||u.status==="active"?"inactive":"active";try{const t=await Q.put(`/businesses/${u.id}`,{status:N});u.status=t.data.status||N}catch{alert("No se pudo cambiar el estatus")}};return(u,i)=>{const N=ke("router-link");return c(),w("div",null,[j.isLoading?(c(),w("div",Te,[s(we,{indeterminate:"",color:"primary",size:"64"}),i[4]||(i[4]=o("p",{class:"mt-4"},"Cargando negocios...",-1))])):(c(),w(R,{key:1},[F.value.length?j.isMobile?(c(!0),w(R,{key:1},ne(F.value,t=>(c(),k(me,{key:t.id,class:"mb-4 pa-3 elevation-1 rounded-lg row-clickable",onClick:e=>x.value?H(t):void 0,style:ie({cursor:x.value?"pointer":"default"})},{default:l(()=>[s(te,{"no-gutters":"",align:"center",class:"mb-1"},{default:l(()=>[s(K,{cols:"3",class:"d-flex justify-start align-center"},{default:l(()=>[o("div",He,[t.logo?(c(),k(J,{key:0,class:"logo-avatar-mobile",color:"grey lighten-2"},{default:l(()=>[o("img",{src:t.logo,alt:"Logo",class:"logo-img-cover"},null,8,Oe)]),_:2},1024)):(c(),k(J,{key:1,class:"logo-avatar-mobile",color:"grey lighten-2"},{default:l(()=>i[8]||(i[8]=[o("span",{style:{"font-size":"12px",color:"#888"}},"Sin logo",-1)])),_:1}))])]),_:2},1024),s(K,{cols:"1"}),s(K,{cols:"8"},{default:l(()=>[o("div",qe,[o("div",Ke,[x.value?(c(),k(N,{key:0,to:`/empresas/${t.id}`,onClick:i[0]||(i[0]=W(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:l(()=>[h(P(t.folio),1)]),_:2},1032,["to"])):(c(),w("span",Re,P(t.folio),1))]),s(ce,{status:t.status},null,8,["status"])]),o("div",Ge,P(t.legal_name),1),o("div",Je,[i[9]||(i[9]=o("strong",null,"Dirección:",-1)),h(" "+P(v(a(t.address),60)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128)):(c(),k(Me,{key:2,items:I.value.value,page:D.value,itemsPerPage:B.value,sortBy:A.value,sortDesc:E.value,"onUpdate:page":i[3]||(i[3]=t=>D.value=t),onSort:n},{"sort-icon":l(({column:t})=>[A.value===t?(c(),k($,{key:0,size:"16",class:"ml-1"},{default:l(()=>[h(P(E.value?b(Fe):b(Ne)),1)]),_:1})):S("",!0)]),rows:l(()=>[F.value.length?(c(!0),w(R,{key:0},ne(F.value,t=>(c(),w("tr",{key:t.id,onClick:e=>x.value?H(t):void 0,class:xe(["row-clickable",{"row-disabled":!x.value}]),style:ie({cursor:x.value?"pointer":"default"})},[o("td",We,[x.value?(c(),k(N,{key:0,to:`/empresas/${t.id}`,onClick:i[1]||(i[1]=W(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:l(()=>[h(P(t.folio),1)]),_:2},1032,["to"])):(c(),w("span",Xe,P(t.folio),1))]),o("td",Ye,[t.logo?(c(),k(J,{key:0,size:"48",class:"logo-avatar"},{default:l(()=>[o("img",{src:t.logo,alt:"Logo",class:"logo-img-cover"},null,8,Ze)]),_:2},1024)):(c(),k(J,{key:1,size:"48",color:"grey lighten-2",class:"d-flex align-center justify-center"},{default:l(()=>i[10]||(i[10]=[o("span",{style:{"font-size":"12px",color:"#888"}},"Sin logo",-1)])),_:1}))]),o("td",et,P(t.legal_name),1),o("td",tt,P(v(a(t.address),60)),1),o("td",at,[s(ce,{status:t.status},null,8,["status"])]),o("td",{class:"actions-cell",onClick:i[2]||(i[2]=W(()=>{},["stop"]))},[M.value?(c(),k(ae,{key:0,location:"bottom end"},{activator:l(({props:e})=>[s(q,le({ref_for:!0},e,{variant:"text",class:"pa-0","min-width":"0",height:"24"}),{default:l(()=>[s($,{icon:b(Ie),size:"20"},null,8,["icon"])]),_:2},1040)]),default:l(()=>[s(Ce,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:l(()=>[x.value?(c(),k(X,{key:0,onClick:e=>H(t)},{prepend:l(()=>[s($,{icon:b(Be),size:"18"},null,8,["icon"])]),default:l(()=>[s(Y,null,{default:l(()=>i[11]||(i[11]=[h("Ver")])),_:1})]),_:2},1032,["onClick"])):S("",!0),L.value&&x.value?(c(),k(re,{key:1,class:"my-1"})):S("",!0),L.value?(c(),k(X,{key:2,onClick:e=>T(t)},{prepend:l(()=>[s($,{icon:b(Ee),size:"18"},null,8,["icon"])]),default:l(()=>[s(Y,null,{default:l(()=>i[12]||(i[12]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])):S("",!0),z.value?(c(),k(re,{key:3,class:"my-1"})):S("",!0),z.value?(c(),k(X,{key:4,onClick:e=>O(t)},{prepend:l(()=>[s($,{icon:t.status==="activa"||t.status==="active"?b(De):b(Pe),size:"18"},null,8,["icon"])]),default:l(()=>[s(Y,null,{default:l(()=>[h(P(t.status==="activa"||t.status==="active"?"Desactivar":"Activar"),1)]),_:2},1024)]),_:2},1032,["onClick"])):S("",!0)]),_:2},1024)]),_:2},1024)):S("",!0)])],14,Qe))),128)):S("",!0)]),_:1},8,["items","page","itemsPerPage","sortBy","sortDesc"])):(c(),w("div",je,[s($,{size:"64",color:"grey lighten-1"},{default:l(()=>i[5]||(i[5]=[h("mdi-domain-off")])),_:1}),i[6]||(i[6]=o("p",{class:"mt-4 text-h6 text-grey-darken-1"},"No existen empresas",-1)),i[7]||(i[7]=o("p",{class:"text-body-2 text-grey"},"No se encontraron empresas con los filtros aplicados",-1))]))],64))])}}},st=ye(lt,[["__scopeId","data-v-dab91ecd"]]),ot={class:"d-flex align-center mb-6",style:{gap:"16px"}},nt={class:"filter-btn-wrapper ml-2 flex-shrink-0",style:{"min-width":"44px",position:"relative"}},it={key:1,class:"filter-btn-content"},rt={key:0,class:"filter-indicator"},ut={key:0,class:"mb-3"},dt={class:"mb-3"},ct={__name:"BusinessFilters",emits:["search","filter","business-select"],setup(j,{emit:U}){const C=U,y=m(""),g=m(!1),r=m(null),f=[{title:"Activo",value:"active"},{title:"Inactivo",value:"inactive"}],p=m(null),_=m(null),z=m(!1),L=m(!1),{mdAndDown:x}=pe(),M=se(),A=V(()=>M.user||{roles:[],permissions:[]}),E=V(()=>A.value.roles||[]),D=V(()=>E.value.includes("superadmin")),B=m(null),n=m([]),a=m(""),v=m(!1),I=async t=>{if(D.value){v.value=!0;try{const{data:e}=await Q.get("/organizations",{params:{q:t||"",limit:10}});n.value=(e.data||[]).map(d=>({...d,display:`${d.folio}${d.legal_name?" - "+d.legal_name:""}`}))}catch{n.value=[]}finally{v.value=!1}}};Z(g,t=>{t&&D.value&&n.value.length===0&&I("")}),Z(a,t=>{D.value&&I(t)});function F(t,e,d){return e?(t.folio+" "+(t.legal_name||"")).toLowerCase().includes(e.toLowerCase()):!0}Z(y,t=>{C("search",t)});const T=V(()=>!!r.value||!!p.value||!!_.value||!!B.value);function H(){C("search",y.value)}function O(t){return t?typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t)?t:new Date(t).toISOString().slice(0,10):null}function u(){C("filter",{organizationId:B.value,status:r.value,createdAtStart:O(p.value),createdAtEnd:O(_.value)}),g.value=!1}function i(){r.value=null,p.value=null,_.value=null,B.value=null,a.value="",C("filter",{organizationId:null,status:null,createdAtStart:null,createdAtEnd:null})}function N(){i(),g.value=!1}return(t,e)=>(c(),w("div",ot,[s(ee,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=d=>y.value=d),placeholder:"Buscar por nombre legal, alias, folio o dirección...","prepend-inner-icon":"mdi-magnify",clearable:"",class:"flex-grow-1 search-bar",density:"compact",variant:"outlined",color:"primary","hide-details":"",style:{"min-width":"220px"},onKeyup:Ve(H,["enter"]),"onClick:clear":H},null,8,["modelValue"]),o("div",nt,[s(q,{icon:b(x),variant:"text",class:"filter-btn filter-btn-center",style:{"border-radius":"8px",border:"1px solid #ccc","min-width":"44px",height:"44px",width:"100%"},color:"#222",onClick:e[1]||(e[1]=d=>g.value=!0)},{default:l(()=>[b(x)?(c(),k($,{key:0},{default:l(()=>e[15]||(e[15]=[o("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[o("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1})):(c(),w("span",it,[s($,{class:"mr-2"},{default:l(()=>e[16]||(e[16]=[o("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1}),e[18]||(e[18]=o("span",null,"Filtros",-1)),s($,{class:"ml-2",end:""},{default:l(()=>e[17]||(e[17]=[h("mdi-filter-variant")])),_:1})]))]),_:1},8,["icon"]),T.value?(c(),w("span",rt)):S("",!0)]),s($e,{modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=d=>g.value=d),"max-width":"420"},{default:l(()=>[s(me,{class:"modal-padding",style:{position:"relative"}},{default:l(()=>[s(q,{icon:"",variant:"text",class:"position-absolute close-btn",style:{top:"10px",right:"10px",color:"#222","z-index":"10"},onClick:e[2]||(e[2]=d=>g.value=!1)},{default:l(()=>[s($,null,{default:l(()=>e[19]||(e[19]=[o("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),_:1})]),_:1}),s(he,{class:"font-weight-bold"},{default:l(()=>e[20]||(e[20]=[h("Filtros avanzados")])),_:1}),s(_e,{class:"pb-0"},{default:l(()=>[s(be,{modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=d=>r.value=d),items:f,label:"Estado",clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"mb-3 filter-padding",style:{"padding-top":"0px","padding-bottom":"0px"}},null,8,["modelValue"]),D.value?(c(),w("div",ut,[s(Ae,{modelValue:B.value,"onUpdate:modelValue":e[4]||(e[4]=d=>B.value=d),items:n.value,loading:v.value,"search-input":a.value,"onUpdate:searchInput":[e[5]||(e[5]=d=>a.value=d),I],"item-title":"display","item-value":"id",label:"Buscar organización (folio o nombre legal)",clearable:"","hide-details":"",variant:"outlined",color:"primary",density:"compact",filter:F,"menu-props":{maxHeight:"300px"}},null,8,["modelValue","items","loading","search-input"])])):S("",!0),o("div",dt,[s(ae,{modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=d=>z.value=d),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:l(({props:d})=>[s(ee,le({"model-value":O(p.value),label:"Creado desde",readonly:""},d,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field mb-2","onClick:clear":e[6]||(e[6]=oe=>p.value=null)}),null,16,["model-value"])]),default:l(()=>[s(ue,{modelValue:p.value,"onUpdate:modelValue":[e[7]||(e[7]=d=>p.value=d),e[8]||(e[8]=d=>z.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"]),s(ae,{modelValue:L.value,"onUpdate:modelValue":e[13]||(e[13]=d=>L.value=d),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:l(({props:d})=>[s(ee,le({"model-value":O(_.value),label:"Creado hasta",readonly:""},d,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field","onClick:clear":e[10]||(e[10]=oe=>_.value=null)}),null,16,["model-value"])]),default:l(()=>[s(ue,{modelValue:_.value,"onUpdate:modelValue":[e[11]||(e[11]=d=>_.value=d),e[12]||(e[12]=d=>L.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])])]),_:1}),s(Se,{class:"d-flex flex-column align-end pt-2",style:{gap:"8px"}},{default:l(()=>[s(q,{style:{"background-color":"#1677ff",color:"white","font-weight":"500","font-size":"14px",width:"100%","text-transform":"none"},onClick:u},{default:l(()=>e[21]||(e[21]=[h(" Aplicar ")])),_:1}),s(q,{variant:"text",style:{width:"100%",color:"#555","font-weight":"500","font-size":"13px","text-transform":"none"},onClick:N},{default:l(()=>e[22]||(e[22]=[h(" Limpiar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},vt={key:0},yt={__name:"index",setup(j){const U=ve(),C=m([]),y=m([]),{mdAndDown:g}=pe(),r=m(""),f=m({}),p=se(),_=m(!1),z=m(!1),L=m(!1),x=m(!1);function M(n){var a,v;return(v=(a=p.user)==null?void 0:a.permissions)==null?void 0:v.includes(n)}ze(async()=>{var n,a,v,I,F;if((a=(n=p.user)==null?void 0:n.roles)!=null&&a.includes("superadmin")||(I=(v=p.user)==null?void 0:v.roles)!=null&&I.includes("admin")||M("business.viewAny")){_.value=!0,z.value=M("business.create"),x.value=M("business.update");try{L.value=!0;const{data:T}=await Q.get("/businesses");C.value=T.data,y.value=T.data.slice(0,10)}catch(T){console.error("Error fetching businesses:",T)}finally{L.value=!1}}else _.value=!1,M("business.view")&&((F=p.user)!=null&&F.business_id)&&U.replace(`/empresas/${p.user.business_id}`)});const A=()=>{U.push("/empresas/crear")};function E(n){r.value=n,B()}async function D(n){f.value=n;try{const a={...n};n.organizationId&&(a.organization_id=n.organizationId,delete a.organizationId),n.createdAtStart&&(a.created_at_start=n.createdAtStart,delete a.createdAtStart),n.createdAtEnd&&(a.created_at_end=n.createdAtEnd,delete a.createdAtEnd),r.value&&(a.search=r.value);const{data:v}=await Q.get("/businesses",{params:a});y.value=v.data}catch(a){console.error("Error fetching filtered businesses:",a),y.value=[]}}function B(){let n=C.value;if(r.value){const a=r.value.toLowerCase();n=n.filter(v=>v.legal_name&&v.legal_name.toLowerCase().includes(a)||v.alias&&v.alias.toLowerCase().includes(a)||v.folio&&String(v.folio).toLowerCase().includes(a)||v.address&&Object.values(v.address).join(" ").toLowerCase().includes(a))}f.value.status&&(n=n.filter(a=>a.status===f.value.status)),f.value.createdAtStart&&(n=n.filter(a=>a.created_at&&a.created_at>=f.value.createdAtStart)),f.value.createdAtEnd&&(n=n.filter(a=>a.created_at&&a.created_at<=f.value.createdAtEnd)),f.value.updatedAtStart&&(n=n.filter(a=>a.updated_at&&a.updated_at>=f.value.updatedAtStart)),f.value.updatedAtEnd&&(n=n.filter(a=>a.updated_at&&a.updated_at<=f.value.updatedAtEnd)),f.value.organizationId&&(n=n.filter(a=>String(a.organization_id)===String(f.value.organizationId))),y.value=n}return(n,a)=>_.value?(c(),w("div",vt,[s(Le,{fluid:""},{default:l(()=>[s(te,{class:"align-center justify-space-between mb-4"},{default:l(()=>[s(K,{cols:"auto",class:"d-flex align-center"},{default:l(()=>a[0]||(a[0]=[o("h3",{class:"font-weight-medium mb-0"},"Empresas",-1)])),_:1}),z.value?(c(),k(K,{key:0,cols:"auto",class:"d-flex align-center justify-end"},{default:l(()=>[s(q,{color:"primary",class:"text-white",elevation:"1",onClick:A},{default:l(()=>[b(g)?(c(),w(R,{key:0},[s($,{icon:b(de),start:""},null,8,["icon"]),a[1]||(a[1]=o("span",null,"Agregar",-1))],64)):(c(),w(R,{key:1},[s($,{icon:b(de),start:""},null,8,["icon"]),a[2]||(a[2]=o("span",null,"Agregar Empresa",-1))],64))]),_:1})]),_:1})):S("",!0)]),_:1}),s(ct,{onSearch:E,onFilter:D,class:"mb-4"}),s(te,null,{default:l(()=>[s(K,null,{default:l(()=>[s(st,{items:y.value,isMobile:b(g),"can-edit-permission":x.value,isLoading:L.value},null,8,["items","isMobile","can-edit-permission","isLoading"])]),_:1})]),_:1})]),_:1})])):S("",!0)}};export{yt as default};
