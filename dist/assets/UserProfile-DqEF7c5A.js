import{c as V,o as v,w as t,a as e,V as z,b as w,O as B,E as D,d as f,t as F,e as C,f as x,a9 as j,af as M,ag as N,R as h,a0 as T,ah as S,ai as I,B as P,J as g,aj as $,C as k,G as O,s as R,u as L,v as G,p as Z,ak as H,l as J,al as W,am as U,A as q,an as K,a6 as Q}from"./index-BtdFDd_C.js";import{m as X,a as E}from"./mdi-CCqP_oQm.js";const Y={class:"text-subtitle-1 font-weight-bold"},ee={class:"text-body-2 text-grey-darken-1 font-weight-medium"},ae="/images/default-avatar.png",te={__name:"UserProfileHeader",props:{user:Object},setup(m){return(i,o)=>(v(),V(j,{class:"pa-4 rounded-xl mb-4",style:{backgroundColor:"#E6F3FD",color:"#07395B"},flat:""},{default:t(()=>[e(z,{align:"center","no-gutters":"",class:"flex-column flex-md-row align-md-center"},{default:t(()=>[e(w,{cols:"12",md:"auto",class:"d-flex justify-center justify-md-start mb-4 mb-md-0"},{default:t(()=>[e(B,{size:"64",class:"mr-4"},{default:t(()=>[e(D,{src:m.user.profile_picture||ae,alt:"Foto de Perfil",class:"cursor-pointer",onClick:o[0]||(o[0]=d=>i.$emit("view-photo"))},null,8,["src"])]),_:1})]),_:1}),e(w,{class:"text-center text-md-left"},{default:t(()=>{var d,r,c,a;return[f("div",Y,F(m.user.name),1),f("div",ee,[o[2]||(o[2]=f("strong",null,"Rol:",-1)),C(" "+F(((d=m.user.roles)==null?void 0:d[0])==="superadmin"?"Super Administrador":((r=m.user.roles)==null?void 0:r[0])==="admin"?"Administrador":((c=m.user.roles)==null?void 0:c[0])==="sponsor"?"Sponsor":((a=m.user.roles)==null?void 0:a[0])||""),1)])]}),_:1}),e(w,{cols:"12",md:"auto",class:"d-flex justify-center justify-md-end mt-3 mt-md-0"},{default:t(()=>[e(x,{color:"primary",class:"text-capitalize",onClick:o[1]||(o[1]=d=>i.$emit("change-photo"))},{default:t(()=>o[3]||(o[3]=[C(" Cambiar Foto ")])),_:1})]),_:1})]),_:1})]),_:1}))}},se={__name:"UserProfileForm",props:{user:Object},emits:["update","open-change-password"],setup(m,{emit:i}){const o=m,d=i,r=M({name:"",email:""});N(()=>o.user,a=>{a&&(r.name=a.name||"",r.email=a.email||"")},{immediate:!0,deep:!0});const c=()=>{d("update",{...r})};return(a,n)=>(v(),V(S,{onSubmit:T(c,["prevent"])},{default:t(()=>[e(h,{modelValue:r.name,"onUpdate:modelValue":n[0]||(n[0]=p=>r.name=p),label:"Nombre Completo",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue"]),e(h,{modelValue:r.email,"onUpdate:modelValue":n[1]||(n[1]=p=>r.email=p),label:"Correo Electrónico",variant:"outlined",density:"compact",class:"mb-2"},null,8,["modelValue"]),e(z,{class:"mt-0",justify:"end"},{default:t(()=>[e(w,{cols:"auto"},{default:t(()=>[e(x,{color:"secondary",class:"text-none",onClick:n[2]||(n[2]=p=>a.$emit("open-change-password"))},{default:t(()=>n[3]||(n[3]=[C(" Cambiar Contraseña ")])),_:1})]),_:1}),e(w,{cols:"auto"},{default:t(()=>[e(x,{color:"primary",type:"submit",class:"text-none"},{default:t(()=>n[4]||(n[4]=[C("Guardar Cambios")])),_:1})]),_:1})]),_:1})]),_:1}))}},oe={class:"d-flex flex-column mt-2"},le={__name:"ChangePasswordModal",props:{modelValue:Boolean},emits:["update:modelValue"],setup(m,{emit:i}){const o=I(),d=m,r=i,c=P({get:()=>d.modelValue,set:y=>r("update:modelValue",y)}),a=g({current_password:"",new_password:"",new_password_confirmation:""}),n=P(()=>[{label:"Al menos 6 caracteres",valid:a.value.new_password.length>=6},{label:"Al menos una letra mayúscula (A-Z)",valid:/[A-Z]/.test(a.value.new_password)},{label:"Al menos una letra minúscula (a-z)",valid:/[a-z]/.test(a.value.new_password)},{label:"Al menos un número (0-9)",valid:/\d/.test(a.value.new_password)}]),p=P(()=>a.value.new_password&&a.value.new_password===a.value.new_password_confirmation);function _(){a.value.current_password="",a.value.new_password="",a.value.new_password_confirmation="",r("update:modelValue",!1)}async function A(){try{await U.post("/change-password",a.value),o.success("Contraseña actualizada con éxito"),_()}catch(y){o.error("Error al cambiar la contraseña"),console.error(y)}}return(y,l)=>(v(),V(W,{modelValue:c.value,"onUpdate:modelValue":l[3]||(l[3]=s=>c.value=s),persistent:"","max-width":"800",transition:"dialog-transition"},{default:t(()=>[e(j,{class:"pa-16",style:{position:"relative"}},{default:t(()=>[e(x,{icon:"",variant:"text",class:"position-absolute",style:{top:"8px",right:"8px",color:"black"},onClick:_},{default:t(()=>[e($,{icon:k(X)},null,8,["icon"])]),_:1}),e(z,null,{default:t(()=>[e(w,{cols:"12",md:"6"},{default:t(()=>[l[4]||(l[4]=f("h2",{class:"h3 font-weight-bold mb-4"},"Cambiar Contraseña",-1)),l[5]||(l[5]=f("div",{class:"text-subtitle-3 mb-2"},"La contraseña debe contener:",-1)),e(O,{dense:""},{default:t(()=>[(v(!0),R(L,null,G(n.value,(s,u)=>(v(),V(Z,{key:u,class:"px-0 py-1",style:{"font-size":"0.85rem","min-height":"28px"}},{default:t(()=>[e($,{size:"20",color:s.valid?"primary":"grey",class:"mr-2",icon:k(E)},null,8,["color","icon"]),f("span",{style:H({textDecoration:s.valid?"line-through":"none",textDecorationColor:s.valid?"#000000":"transparent",textDecorationThickness:"1px"})},F(s.label),5)]),_:2},1024))),128))]),_:1})]),_:1}),e(w,{cols:"12",md:"6"},{default:t(()=>[e(h,{modelValue:a.value.current_password,"onUpdate:modelValue":l[0]||(l[0]=s=>a.value.current_password=s),label:"Contraseña Actual",type:"password",class:"mb-2",variant:"outlined",density:"compact"},null,8,["modelValue"]),e(h,{modelValue:a.value.new_password,"onUpdate:modelValue":l[1]||(l[1]=s=>a.value.new_password=s),label:"Nueva Contraseña",type:"password",class:"mb-2",variant:"outlined",density:"compact"},null,8,["modelValue"]),e(h,{modelValue:a.value.new_password_confirmation,"onUpdate:modelValue":l[2]||(l[2]=s=>a.value.new_password_confirmation=s),label:"Confirmar Nueva Contraseña",type:"password",class:"mb-2",color:p.value?"success":void 0,variant:"outlined",density:"compact"},{"append-inner":t(()=>[p.value?(v(),V($,{key:0,icon:k(E),color:"success"},null,8,["icon"])):J("",!0)]),_:1},8,["modelValue","color"]),f("div",oe,[e(x,{class:"mb-2",style:{"background-color":"#1677ff",color:"white","font-weight":"500","font-size":"14px",width:"100%","text-transform":"none"},onClick:A},{default:t(()=>l[6]||(l[6]=[C(" Guardar Contraseña ")])),_:1}),e(x,{variant:"text",style:{width:"100%",color:"#555","font-weight":"500","font-size":"13px","text-transform":"none"},onClick:_},{default:t(()=>l[7]||(l[7]=[C(" Cancelar ")])),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ue={__name:"UserProfile",setup(m){const i=q(),o=I(),d=g({}),r=g(null),c=g(null),a=g(!1),n=g(!1),p=async()=>{try{const s=await U.get("/user");d.value=s.data}catch{o.error("Error al obtener los datos del usuario.")}},_=()=>{r.value.click()},A=async s=>{const u=s.target.files[0];if(!u||!u.type.startsWith("image/")){o.error("El archivo debe ser una imagen válida.");return}const b=new FormData;b.append("profile_picture",u),b.append("_method","PUT");try{await U.post(`/users/${i.user.id}`,b,{headers:{"Content-Type":"multipart/form-data"}}),await i.fetchUser(),o.success("Foto de perfil actualizada.")}catch{o.error("Error al actualizar la foto de perfil.")}},y=async s=>{const u={name:s.name,email:s.email,_method:"PUT"};try{await U.post(`/users/${i.user.id}`,u),await i.fetchUser(),o.success("Perfil actualizado correctamente.")}catch{o.error("Error al actualizar el perfil.")}},l=()=>{a.value=!0};return K(p),(s,u)=>(v(),V(Q,{class:"py-6",fluid:""},{default:t(()=>[e(z,{justify:"start"},{default:t(()=>[e(w,{cols:"12"},{default:t(()=>[u[2]||(u[2]=f("h2",{class:"h3 font-weight-bold mb-4"},"Editar Perfil",-1)),e(te,{user:d.value,roles:k(i).user.roles,onChangePhoto:_,onViewPhoto:u[0]||(u[0]=b=>n.value=!0)},null,8,["user","roles"]),e(se,{user:d.value,onUpdate:y,ref_key:"formRef",ref:c,onOpenChangePassword:l},null,8,["user"]),f("input",{type:"file",ref_key:"fileInput",ref:r,accept:"image/*",class:"d-none",onChange:A},null,544),e(le,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=b=>a.value=b)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{ue as default};
