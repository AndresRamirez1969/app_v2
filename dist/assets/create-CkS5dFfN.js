import{_ as te,A as se,J as n,B as $,an as oe,am as P,ag as j,c as m,w as t,a,s as b,b as i,d as o,f as D,C as _,Z as ne,aj as F,V as c,l as U,H as q,R as ie,at as re,ao as ue,u as B,v as E,e as w,aB as H,ap as de,a6 as ce,o as r,L as J,b1 as Z,t as V,k as K,N as me,x as fe,a9 as ve}from"./index-BtdFDd_C.js";import{j as pe,H as ge}from"./mdi-CCqP_oQm.js";import{p as Q}from"./permissionTranslations-DjkJmpfr.js";import{_ as ye,p as X}from"./permissionfilter-BgE5Ncck.js";const he=["onClick"],xe={class:"text-center uniform-col",style:{"padding-left":"0","padding-right":"8px"}},be={class:"d-flex justify-center align-center",style:{height:"100%"}},_e={class:"text-center uniform-col",style:{"vertical-align":"middle"}},we={class:"text-center uniform-col",style:{"vertical-align":"middle"}},Ve={class:"text-center uniform-col",style:{"vertical-align":"middle"}},ke={key:0},Ce={class:"font-weight-medium",style:{"min-width":"100px","font-size":"0.85em"}},ze={class:"text-caption text-medium-emphasis",style:{"padding-top":"4px"}},Le={__name:"create",setup(Pe){var O;const N=se(),I=ne();function k(){var s,e;return(e=(s=N.user)==null?void 0:s.roles)==null?void 0:e.includes("superadmin")}const A=n(window.innerWidth<600);window.addEventListener("resize",()=>{A.value=window.innerWidth<600});const v=n(""),p=n(k()?null:((O=N.user)==null?void 0:O.organization_id)??null),g=n([]),y=n(!1),T=n(""),R=n([]),W=n([]),d=n([]),G=n(!1),S=n(!1),h=n(""),f=n(1),C=n(10),Y={user:"Usuario",role:"Rol",permission:"Permiso",businessUnit:"Ubicación",businessUnitGroup:"Grupo de Ubicaciones",organization:"Organización",business:"Negocio",form:"Formulario"},z=$(()=>{var s,e;return(e=(s=N.user)==null?void 0:s.permissions)==null?void 0:e.includes("role.create")});function ee(s){return s.filter(e=>e.name&&!e.name.startsWith("form_field.")&&!e.name.startsWith("permission.")&&!e.name.startsWith("person.")).map(e=>{var u;let l=e.name.split(".")[0]||e.model||e.model_name||"Otro";return l==="form_response"&&(l="form"),{id:e.id,name:e.name,model:l,modelLabel:Y[l]||l,label:Q[e.name]||Q[(u=e.name)==null?void 0:u.split(".")[1]]||e.name}})}const x=$(()=>{let s=ee(R.value);if(h.value){const l=h.value.toLowerCase();s=s.filter(u=>u.modelLabel.toLowerCase().includes(l)||u.label.toLowerCase().includes(l)||u.name.toLowerCase().includes(l))}W.value=s;const e=(f.value-1)*C.value;return s.slice(e,e+C.value)}),M=$(()=>Math.ceil(W.value.length/C.value));oe(async()=>{if(z.value){G.value=!0;try{const{data:s}=await P.get("/permissions");if(R.value=s.data||s,k()){y.value=!0;const e=await P.get("/organizations",{params:{search:T.value}});g.value=e.data.data||e.data,y.value=!1}}catch{R.value=[],g.value=[]}finally{G.value=!1}}}),j(h,()=>{f.value=1}),j(T,async s=>{if(k()){y.value=!0;try{const e=await P.get("/organizations",{params:{search:s}});g.value=e.data.data||e.data}catch{g.value=[]}finally{y.value=!1}}}),j([C,f],()=>{x.value});function L(s){d.value.includes(s)?d.value=d.value.filter(e=>e!==s):d.value.push(s)}function le(s){f.value=s}async function ae(){if(!(!z.value||!v.value||!p.value||d.value.length===0)){S.value=!0;try{await P.post("/roles",{name:v.value,organization_id:p.value,permissions:d.value}),I.push("/roles")}catch{}finally{S.value=!1}}}return(s,e)=>(r(),m(ce,null,{default:t(()=>[a(c,{class:"align-center mb-6","no-gutters":""},{default:t(()=>[a(i,{cols:"auto",class:"d-flex align-center"},{default:t(()=>[a(D,{icon:"",variant:"text",class:"px-3 py-2",style:{"border-radius":"8px",border:"1px solid #ccc"},onClick:e[0]||(e[0]=l=>_(I).back())},{default:t(()=>[a(F,{icon:_(pe)},null,8,["icon"])]),_:1}),e[5]||(e[5]=o("h3",{class:"font-weight-medium ml-3 mb-0"},"Agregar Rol",-1))]),_:1})]),_:1}),z.value?(r(),b(B,{key:0},[a(c,null,{default:t(()=>[a(i,{cols:"12"},{default:t(()=>[e[6]||(e[6]=o("h4",{class:"font-weight-bold mb-3"},"Información General",-1)),a(q,{class:"mb-6"})]),_:1})]),_:1}),a(c,null,{default:t(()=>[a(i,null,{default:t(()=>[a(ie,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),label:"Nombre del rol",variant:"outlined",color:"primary",required:"",class:"mb-4"},null,8,["modelValue"])]),_:1})]),_:1}),k()?(r(),m(c,{key:0},{default:t(()=>[a(i,null,{default:t(()=>[a(re,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l),items:g.value,"item-title":l=>`${l.folio??l.id} - ${l.legal_name??l.name}`,"item-value":"id",label:"Organización",variant:"outlined",color:"primary",required:"",class:"mb-4",loading:y.value,searchable:!0,clearable:""},null,8,["modelValue","items","item-title","loading"])]),_:1})]),_:1})):U("",!0),a(i,{cols:"12"},{default:t(()=>[a(q,{class:"mb-6"})]),_:1}),a(c,null,{default:t(()=>[a(i,null,{default:t(()=>[a(ye,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=l=>h.value=l)},null,8,["modelValue"])]),_:1})]),_:1}),A.value?(r(),m(c,{key:2},{default:t(()=>[(r(!0),b(B,null,E(x.value,l=>(r(),m(i,{cols:"12",key:l.id},{default:t(()=>[a(ve,{class:J(["permission-card",{"selected-row":d.value.includes(l.name)}]),onClick:u=>L(l.name),elevation:"1",style:{cursor:"pointer","margin-bottom":"20px",padding:"20px 16px"}},{default:t(()=>[a(c,{"no-gutters":""},{default:t(()=>[a(i,{cols:"auto",class:"d-flex align-center justify-center",style:{width:"64px"}},{default:t(()=>[a(Z,{"model-value":d.value.includes(l.name),"onUpdate:modelValue":u=>L(l.name),color:"primary","hide-details":"",ripple:!1,class:"pa-0 ma-0",style:{"--v-checkbox-bg":"#1976d2","--v-checkbox-checked-color":"#fff"}},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),a(i,{class:"d-flex flex-column justify-center",style:{"padding-left":"16px"}},{default:t(()=>[o("div",null,[o("span",Ce,V(l.modelLabel),1)]),o("div",null,[a(K,{color:"primary","text-color":"white",class:"ma-0 pa-1",style:{"font-weight":"500","font-size":"0.75em","min-width":"32px","padding-left":"3px","padding-right":"3px","margin-top":"2px","margin-left":"0"}},{default:t(()=>[w(V(l.label),1)]),_:2},1024)]),o("div",ze,V(_(X)[l.name]||"Sin descripción"),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),128)),x.value.length===0?(r(),m(i,{key:0,cols:"12"},{default:t(()=>[a(H,{type:"info",variant:"outlined"},{default:t(()=>e[9]||(e[9]=[w("No hay permisos disponibles.")])),_:1})]),_:1})):U("",!0)]),_:1})):(r(),m(c,{key:1},{default:t(()=>[a(i,null,{default:t(()=>[a(ue,{class:"rounded-lg elevation-1 uniform-table",style:{width:"100%"}},{default:t(()=>[e[8]||(e[8]=o("thead",null,[o("tr",null,[o("th",{class:"font-weight-bold text-center uniform-col",style:{width:"80px"}}),o("th",{class:"font-weight-bold text-center uniform-col",style:{width:"200px"}},"Modelo"),o("th",{class:"font-weight-bold text-center uniform-col",style:{width:"220px"}},"Permiso"),o("th",{class:"font-weight-bold text-center uniform-col",style:{width:"60px"}})])],-1)),o("tbody",null,[(r(!0),b(B,null,E(x.value,l=>(r(),b("tr",{key:l.id,class:J(["row-clickable",{"selected-row":d.value.includes(l.name)}]),style:{cursor:"pointer"},onClick:u=>L(l.name)},[o("td",xe,[o("div",be,[a(Z,{"model-value":d.value.includes(l.name),"onUpdate:modelValue":u=>L(l.name),color:"primary","hide-details":"",ripple:!1,class:"pa-0 ma-0",style:{"--v-checkbox-bg":"#1976d2","--v-checkbox-checked-color":"#fff"}},null,8,["model-value","onUpdate:modelValue"])])]),o("td",_e,V(l.modelLabel),1),o("td",we,[a(K,{color:"primary","text-color":"white",class:"ma-0 pa-2",style:{"font-weight":"500","font-size":"0.95em"}},{default:t(()=>[w(V(l.label),1)]),_:2},1024)]),o("td",Ve,[a(me,{location:"top",text:_(X)[l.name]||"Sin descripción"},{activator:t(({props:u})=>[a(F,fe({ref_for:!0},u,{icon:_(ge),color:"primary",style:{cursor:"pointer"}}),null,16,["icon"])]),_:2},1032,["text"])])],10,he))),128)),x.value.length===0?(r(),b("tr",ke,e[7]||(e[7]=[o("td",{colspan:"4",class:"text-center text-medium-emphasis"},"No hay permisos disponibles.",-1)]))):U("",!0)])]),_:1})]),_:1})]),_:1})),M.value>1?(r(),m(c,{key:3},{default:t(()=>[a(i,{class:"d-flex justify-center"},{default:t(()=>[a(de,{modelValue:f.value,"onUpdate:modelValue":[e[4]||(e[4]=l=>f.value=l),le],length:M.value,color:"primary"},null,8,["modelValue","length"])]),_:1})]),_:1})):U("",!0),a(c,null,{default:t(()=>[a(i,{class:"d-flex justify-end"},{default:t(()=>[a(D,{color:"primary",loading:S.value,disabled:!z.value||!v.value||!p.value||d.value.length===0,onClick:ae},{default:t(()=>e[10]||(e[10]=[w(" Guardar Rol ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})],64)):(r(),m(c,{key:1},{default:t(()=>[a(i,null,{default:t(()=>[a(H,{type:"error",variant:"outlined",class:"mt-4"},{default:t(()=>e[11]||(e[11]=[w(" No tienes permiso para crear roles. ")])),_:1})]),_:1})]),_:1}))]),_:1}))}},$e=te(Le,[["__scopeId","data-v-eda8de64"]]);export{$e as default};
