import{_ as J,ai as Z,aC as G,J as u,B as Q,an as W,c as D,w as s,a as t,b as m,a9 as S,ad as B,d as r,f as V,aj as N,C as R,t as f,e as v,V as E,a1 as X,ae as A,l as b,R as P,as as Y,at as ee,H as ae,s as i,aq as te,ao as se,u as oe,v as le,ap as re,a6 as ne,am as w,Z as de,o as d,a0 as ue}from"./index-BtdFDd_C.js";import{j as ie,t as ce,u as pe,q as me}from"./mdi-CCqP_oQm.js";import{D as fe,c as ve,f as L,d as ge}from"./constants-nBv8b9vA.js";const ye={class:"text-h5 mb-1"},xe={class:"text-body-2 text-grey-darken-1 mb-0"},_e={class:"d-flex gap-2"},Ve={key:0,class:"text-center py-8"},Re={key:1,class:"text-center py-8"},ke={key:2},he={key:0},be=["onClick"],we={key:0},Ce={class:"d-flex gap-2"},De={class:"d-flex justify-center mt-4"},Ee={__name:"ShowResponse",setup(Pe){const j=G(),F=de(),g=Z(),k=j.params.id,c=u({}),C=u([]),y=u(!1),x=u(1),I=u(20),U=u(0),M=()=>{F.back()},o=u({dateRange:"all",startDate:null,endDate:null,search:""}),z=u(fe),T=(l=!0)=>{const e={search:o.value.search};if(l&&(e.page=x.value,e.per_page=I.value),o.value.dateRange!=="all"){const{start:a,end:n,hasValidDates:p}=ve(o.value.dateRange,o.value.startDate,o.value.endDate);p&&(e.start_date=L(a),e.end_date=L(n))}return e},h=async()=>{y.value=!0;try{const l=await w.get(`/forms/${k}`);c.value=l.data;const e=T(!0);console.log("Params being sent:",e);const a=await w.get(`/forms/${k}/responses`,{params:e});console.log("API response:",a.data),C.value=a.data.responses.data,U.value=a.data.responses.total}catch(l){console.error("Error fetching reports:",l),g.error("Error al cargar los reportes")}finally{y.value=!1}},O=async()=>{try{const l=T(!1);console.log("Export params:",l);const e=await w.get(`/forms/${k}/export-excel`,{params:l});if(e.data.download_url){window.open(e.data.download_url,"_blank","noopener noreferrer");let a="Reporte exportado correctamente";o.value.dateRange!=="all"&&(a+=` (filtrado por ${{today:"hoy",week:"esta semana",month:"este mes",custom:"fechas personalizadas"}[o.value.dateRange]})`),o.value.search&&(a+=` (búsqueda: "${o.value.search}")`),g.success(a)}}catch(l){console.error("Error exporting responses:",l),g.error("Error al exportar el reporte")}},q=async l=>{try{const e=await w.get(`/form-responses/${l}/pdf`),a=e.data.download_url,n=document.createElement("a");n.href=a,n.target="_blank",n.rel="noopener noreferrer";const p=e.data.file_name||`respuestas_${c.value.name}_${new Date().toISOString().split("T")[0]}.pdf`;n.setAttribute("download",p),n.click(),g.success("Reporte exportado correctamente")}catch(e){console.error("Error exporting responses:",e),g.error("Error al exportar el reporte")}},$=l=>{F.push({name:"UserResponse",params:{formId:k,responseId:l.id,userId:l.user.id}})},K=Q(()=>Math.ceil(U.value/I.value)),H=l=>{x.value=l,h()},_=()=>{x.value=1,h()};return W(()=>{h()}),(l,e)=>(d(),D(ne,{fluid:""},{default:s(()=>[t(E,{class:"mb-4"},{default:s(()=>[t(m,{cols:"12"},{default:s(()=>[t(S,null,{default:s(()=>[t(B,{class:"d-flex align-center justify-space-between"},{default:s(()=>[t(V,{icon:"",variant:"text",onClick:M,class:"mr-3"},{default:s(()=>[t(N,{icon:R(ie)},null,8,["icon"])]),_:1}),r("div",null,[r("h2",ye,f(c.value.name),1),r("p",xe,f(c.value.description||"Sin descripción"),1)]),r("div",_e,[t(V,{color:"primary",variant:"outlined",onClick:O,loading:y.value,"prepend-icon":R(ce)},{default:s(()=>[v(f(o.value.dateRange==="all"&&!o.value.search?"Exportar Todos (Excel)":"Exportar Filtrados (Excel)"),1)]),_:1},8,["loading","prepend-icon"]),t(V,{color:"secondary",variant:"outlined",onClick:h,loading:y.value,"prepend-icon":R(pe)},{default:s(()=>e[6]||(e[6]=[v(" Actualizar ")])),_:1},8,["loading","prepend-icon"])])]),_:1})]),_:1})]),_:1})]),_:1}),t(E,null,{default:s(()=>[t(m,{cols:"12"},{default:s(()=>[t(S,null,{default:s(()=>[t(B,null,{default:s(()=>[e[7]||(e[7]=v(" Respuestas de Usuarios ")),t(X)]),_:1}),t(A,{class:"pb-0"},{default:s(()=>[t(E,null,{default:s(()=>[t(m,{cols:"12"},{default:s(()=>[t(P,{modelValue:o.value.search,"onUpdate:modelValue":[e[0]||(e[0]=a=>o.value.search=a),_],label:"Buscar por usuario",variant:"outlined",density:"compact","prepend-inner-icon":R(me),onKeyup:Y(_,["enter"])},null,8,["modelValue","prepend-inner-icon"])]),_:1}),t(m,{cols:"12"},{default:s(()=>[t(ee,{modelValue:o.value.dateRange,"onUpdate:modelValue":[e[1]||(e[1]=a=>o.value.dateRange=a),_],items:z.value,label:"Rango de fechas",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),o.value.dateRange==="custom"?(d(),D(m,{key:0,cols:"12",md:"6"},{default:s(()=>[t(P,{modelValue:o.value.startDate,"onUpdate:modelValue":[e[2]||(e[2]=a=>o.value.startDate=a),_],type:"date",label:"Fecha inicial",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):b("",!0),o.value.dateRange==="custom"?(d(),D(m,{key:1,cols:"12",md:"6"},{default:s(()=>[t(P,{modelValue:o.value.endDate,"onUpdate:modelValue":[e[3]||(e[3]=a=>o.value.endDate=a),_],type:"date",label:"Fecha final",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1})]),_:1}),t(ae,{class:"mx-4"}),t(A,null,{default:s(()=>[y.value?(d(),i("div",Ve,[t(te,{indeterminate:"",color:"primary",size:"64"}),e[8]||(e[8]=r("p",{class:"mt-4"},"Cargando respuestas...",-1))])):C.value.length===0?(d(),i("div",Re,[t(N,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:s(()=>e[9]||(e[9]=[v("mdi-clipboard-text")])),_:1}),e[10]||(e[10]=r("h3",{class:"text-h6 text-grey-darken-1"},"No hay respuestas",-1)),e[11]||(e[11]=r("p",{class:"text-body-2 text-grey"},"No se encontraron respuestas con los filtros aplicados",-1))])):(d(),i("div",ke,[t(se,null,{default:s(()=>[r("thead",null,[r("tr",null,[e[12]||(e[12]=r("th",null,"Usuario",-1)),e[13]||(e[13]=r("th",null,"Fecha de respuesta",-1)),e[14]||(e[14]=r("th",null,"Puntaje",-1)),c.value.has_rating?(d(),i("th",he,"Acciones")):b("",!0)])]),r("tbody",null,[(d(!0),i(oe,null,le(C.value,a=>{var n;return d(),i("tr",{key:a.id,onClick:p=>$(a),style:{cursor:"pointer"}},[r("td",null,f(((n=a.user)==null?void 0:n.name)||"Usuario desconocido"),1),r("td",null,f(R(ge)(a.submitted_at)),1),c.value.has_rating?(d(),i("td",we,f((a==null?void 0:a.score)||"—"),1)):b("",!0),r("td",{onClick:e[4]||(e[4]=ue(()=>{},["stop"]))},[r("div",Ce,[t(V,{color:"primary",variant:"outlined",onClick:p=>q(a.id)},{default:s(()=>e[15]||(e[15]=[v(" Exportar PDF ")])),_:2},1032,["onClick"]),t(V,{color:"info",variant:"outlined",onClick:p=>$(a.id)},{default:s(()=>e[16]||(e[16]=[v(" Ver Respuestas ")])),_:2},1032,["onClick"])])])],8,be)}),128))])]),_:1}),r("div",De,[t(re,{modelValue:x.value,"onUpdate:modelValue":[e[5]||(e[5]=a=>x.value=a),H],length:K.value,"total-visible":7},null,8,["modelValue","length"])])]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},Te=J(Ee,[["__scopeId","data-v-ec7a24af"]]);export{Te as default};
