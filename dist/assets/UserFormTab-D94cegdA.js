import{s as p,o as r,a as n,w as l,d as t,e as b,ae as F,ao as R,_ as j,a0 as E,J as h,B as S,q as K,l as D,c as w,u as L,v as T,V as P,b as $,a2 as J,t as v,k as z,ab as N,ag as G,aq as H,al as O,C as U,ap as Q,ar as W,A as X,ai as A,K as Y,U as Z,as as ee,a8 as te,L as I}from"./index-mAfd8qbF.js";import{f as se,g as ae}from"./mdi-CCqP_oQm.js";import{d as oe}from"./debounce-uNM_DU8Y.js";const le={__name:"UserFormTable",props:{items:{type:Array,default:()=>[]},page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean},emits:["update:page","sort"],setup(g,{emit:k}){const c=k;return(i,s)=>(r(),p("div",null,[n(R,{density:"comfortable",class:"fixed-table elevation-1 rounded-lg"},{default:l(()=>[t("thead",null,[t("tr",null,[t("th",{onClick:s[0]||(s[0]=u=>c("sort","folio")),class:"cursor-pointer folio-header"},[s[3]||(s[3]=b(" Folio ")),F(i.$slots,"sort-icon",{column:"folio"})]),t("th",{onClick:s[1]||(s[1]=u=>c("sort","name")),class:"cursor-pointer name-header"},[s[4]||(s[4]=b(" Nombre ")),F(i.$slots,"sort-icon",{column:"name"})]),t("th",{onClick:s[2]||(s[2]=u=>c("sort","created_at")),class:"cursor-pointer date-header"},[s[5]||(s[5]=b(" Fecha de Creación ")),F(i.$slots,"sort-icon",{column:"created_at"})]),s[6]||(s[6]=t("th",{class:"response-header"},"Estado",-1))])]),t("tbody",null,[F(i.$slots,"rows")])]),_:3})]))}},ne={class:"d-flex align-center mb-1",style:{"justify-content":"space-between"}},re={class:"text-caption",style:{"margin-right":"8px"}},ie={class:"font-weight-medium mb-1"},de={class:"text-caption"},ue={class:"mt-2"},ce={key:0,class:"text-center py-8"},me={key:1,class:"text-center py-8"},pe={key:2},fe=["onClick"],ve={class:"folio-cell"},ge={class:"name-cell"},ye={class:"date-cell"},_e={class:"response-cell"},be={key:1},he={class:"d-flex justify-center mt-4"},xe={__name:"UserFormView",props:{items:Array,isLoading:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1}},setup(g){const k=g,c=E(),i=h("folio"),s=h(!1),u=h(1),y=h(10),x=a=>{i.value===a?s.value=!s.value:(i.value=a,s.value=!1)},C=a=>a?new Date(a).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"—",d=a=>{if(!a.can_respond&&a.frequency==="once_per_day")return{text:"Completado",color:"success"};if(!a.has_responded&&a.frequency==="once_per_day")return{text:"Sin Responder",color:"warning"};if(a.frequency==="multiple_per_day")return{text:"Formulario Persistente",color:"info"}},f=S(()=>k.items.filter(a=>a.can_respond!==!1)),_=S(()=>[...f.value].sort((a,o)=>{var V,M;const B=((V=a[i.value])==null?void 0:V.toString().toLowerCase())??"",e=((M=o[i.value])==null?void 0:M.toString().toLowerCase())??"";return B.localeCompare(e)*(s.value?-1:1)})),m=S(()=>{const a=(u.value-1)*y.value;return _.value.slice(a,a+y.value)}),q=a=>{c.push({name:"FillForm",params:{id:a.id}})};return(a,o)=>{const B=K("router-link");return r(),p("div",null,[g.isMobile?(r(),p(L,{key:0},[m.value.length?(r(!0),p(L,{key:0},T(m.value,e=>(r(),w(N,{key:e.id,class:"mb-4 pa-3 elevation-1 rounded-lg row-clickable",onClick:V=>q(e),style:{cursor:"pointer"}},{default:l(()=>[n(P,{"no-gutters":"",align:"center",class:"mb-1"},{default:l(()=>[n($,{cols:"12"},{default:l(()=>[t("div",ne,[t("div",re,[n(B,{to:`/formulario/${e.id}`,onClick:o[0]||(o[0]=J(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:l(()=>[b(v(e.folio),1)]),_:2},1032,["to"])])]),t("div",ie,v(e.name),1),t("div",de,[o[4]||(o[4]=t("strong",null,"Creado:",-1)),b(" "+v(C(e.created_at)),1)]),t("div",ue,[n(z,{color:d(e).color,"text-color":"white",size:"small"},{default:l(()=>[b(v(d(e).text),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(r(),w(N,{key:1,class:"mb-4 pa-4 elevation-1 rounded-lg text-center"},{default:l(()=>o[5]||(o[5]=[t("div",{class:"font-weight-bold mb-2",style:{"font-size":"1.5rem"}},"No existen formularios...",-1)])),_:1}))],64)):D("",!0),g.isMobile?D("",!0):(r(),w(N,{key:1,class:"elevation-1"},{default:l(()=>[n(G,{class:"pa-0"},{default:l(()=>[g.isLoading?(r(),p("div",ce,[n(H,{indeterminate:"",color:"primary",size:"64"}),o[6]||(o[6]=t("p",{class:"mt-4"},"Cargando formularios...",-1))])):!g.items||g.items.length===0?(r(),p("div",me,o[7]||(o[7]=[t("h3",{class:"text-h6 text-grey-darken-1"},"Aun no hay formularios que llenar",-1)]))):(r(),p("div",pe,[n(le,{items:_.value,page:u.value,itemsPerPage:y.value,sortBy:i.value,sortDesc:s.value,"onUpdate:page":o[1]||(o[1]=e=>u.value=e),onSort:x,density:"comfortable",class:"fixed-table"},{"sort-icon":l(({column:e})=>[i.value===e?(r(),w(O,{key:0,size:"16",class:"ml-1"},{default:l(()=>[b(v(s.value?U(se):U(ae)),1)]),_:1})):D("",!0)]),rows:l(()=>[m.value.length?(r(!0),p(L,{key:0},T(m.value,e=>(r(),p("tr",{key:e.id,onClick:V=>q(e),class:"row-clickable",style:{cursor:"pointer"}},[t("td",ve,v(e.folio),1),t("td",ge,v(e.name),1),t("td",ye,v(C(e.created_at)),1),t("td",_e,[n(z,{color:d(e).color,"text-color":"white",size:"small"},{default:l(()=>[b(v(d(e).text),1)]),_:2},1032,["color"])])],8,fe))),128)):(r(),p("tr",be,o[8]||(o[8]=[t("td",{colspan:5,class:"text-center py-8"},[t("div",{class:"font-weight-bold mb-2",style:{"font-size":"1.5rem"}},"No existen formularios aun...")],-1)])))]),_:1},8,["items","page","itemsPerPage","sortBy","sortDesc"]),t("div",he,[n(Q,{modelValue:u.value,"onUpdate:modelValue":[o[2]||(o[2]=e=>u.value=e),o[3]||(o[3]=e=>u.value=e)],length:Math.ceil(_.value.length/y.value),"total-visible":7},null,8,["modelValue","length"])])]))]),_:1})]),_:1}))])}}},ke=j(xe,[["__scopeId","data-v-a789902c"]]),we={class:"d-flex align-center mb-2",style:{gap:"16px"}},Pe={__name:"UserFormTab",setup(g){const{mdAndDown:k}=W(),c=h({search:"",folio:""}),i=X();A(()=>i.permissions,d=>{d.length>0&&console.log("Permisos cargados",d)},{immediate:!0});const s=h(1),u=h({data:[],last_page:1}),y=h(!1),x=async()=>{y.value=!0;try{const d=await I.get("/my-forms",{params:{search:c.value.search,page:s.value}}),f=await Promise.all(d.data.data.map(async _=>{try{const m=await I.get(`/forms/${_.id}/check-response`);return{..._,has_responded:m.data.has_responded,frequency:m.data.frequency,can_respond:m.data.can_respond}}catch(m){console.error("Failed to fetch form response status",m)}}));u.value={...d.data,data:f},console.log(f)}catch(d){console.error("Failed to fetch forms",d)}finally{y.value=!1}};Y(()=>{x()});const C=oe(x,400);return A(()=>c.value.search,()=>{s.value=1,C()}),(d,f)=>(r(),w(te,{fluid:""},{default:l(()=>[n(P,{class:"align-center justify-space-between mb-4"},{default:l(()=>[n($,{cols:"auto",class:"d-flex align-center"},{default:l(()=>f[1]||(f[1]=[t("h1",{class:"text-h4 text-md-h3 font-weight-bold ma-0"},"Tus Formularios",-1)])),_:1})]),_:1}),n(P,{class:"mb-2"},{default:l(()=>[n($,{cols:"12"},{default:l(()=>[t("div",we,[n(Z,{modelValue:c.value.search,"onUpdate:modelValue":f[0]||(f[0]=_=>c.value.search=_),label:"Buscar por Nombre o Folio",clearable:"",density:"comfortable",variant:"outlined","hide-details":"",onKeyup:ee(x,["enter"]),"prepend-inner-icon":"mdi-magnify",style:{"min-width":"220px"},"onClick:clear":x},null,8,["modelValue"])])]),_:1})]),_:1}),n(P,null,{default:l(()=>[n($,null,{default:l(()=>[n(ke,{items:u.value.data,isMobile:U(k),isLoading:y.value,onFormUpdated:x},null,8,["items","isMobile","isLoading"])]),_:1})]),_:1})]),_:1}))}};export{Pe as default};
