import{_ as M,aC as W,J as o,B as Q,ai as N,K as X,c as Y,w as t,a as s,b as d,d as v,f as S,C as $,a0 as Z,al as A,V as f,H as G,U as F,s as k,aq as ee,e as D,am as ae,u as se,a8 as te,L as w,o as y}from"./index-DA8Oyi7H.js";import{j as oe}from"./mdi-CCqP_oQm.js";import{_ as le}from"./BusinessUnitFilter-fcuvndFd.js";import{B as ne}from"./BusinessUnitSelectTable-CGWI1bjG.js";/* empty css                */import"./StatusChip-CY_B-sI1.js";const ue={key:0,class:"text-center py-8"},ie={key:1,class:"text-center py-8"},re={class:"v-messages v-messages__wrapper",style:{"min-height":"24px","padding-top":"10px"}},ce={__name:"create",setup(de){const U=Z(),h=W().params.id,i=o(""),n=o(null),u=o(null),z=o({}),x=o([]),l=o([]),B=o(!1),r=o(1),I=o(10),_=o(0),m=o("folio"),g=o(!1),V=o(""),E=o(null),p=o(!1),T=e=>{if(!e)return"No disponible";const a=[e.street,e.outdoor_number,e.neighborhood,e.city,e.postal_code,e.state,e.country].filter(Boolean);return a.length?a.join(", "):"No disponible"},j=(e,a=50)=>e?e.length>a?e.slice(0,a)+"...":e:"",b=async()=>{B.value=!0;try{const e={...z.value,organization_id:n.value,business_id:u.value,page:r.value,per_page:I.value,sort_by:m.value,sort_desc:g.value?1:0,search:V.value},{data:a}=await w.get("/business-units",{params:e});x.value=a.data,_.value=a.total}catch(e){x.value=[],_.value=0,console.error("Error fetching business units:",e)}finally{B.value=!1}},q=async()=>{try{const{data:e}=await w.get(`/business-unit-groups/${h}`);i.value=e.name,n.value=e.organization_id,u.value=e.business_id,l.value=e.business_units.map(a=>a.id),E.value=e.status}catch(e){console.error("Error fetching group:",e)}},O=Q(()=>x.value);N([n,u,z,r,I,m,g],()=>{b()}),N(V,()=>{r.value=1,b()}),X(async()=>{await q(),b()});function P(e){e.organizationId!==void 0&&e.organizationId!==n.value&&(n.value=e.organizationId),e.businessId!==void 0&&e.businessId!==u.value&&(u.value=e.businessId),z.value={status:e.status,created_at_start:e.createdAtStart,created_at_end:e.createdAtEnd},r.value=1,b()}function R({organizationId:e,businessId:a}){n.value=e,u.value=a,l.value=[],r.value=1,b()}function L(e){V.value=e}function H(e){l.value.includes(e)?l.value=l.value.filter(a=>a!==e):l.value.push(e)}const C=o(!1);async function J(){if(p.value=!1,!i.value||!l.value.length){p.value=!0;return}C.value=!0;try{await w.put(`/business-unit-groups/${h}`,{name:i.value,organization_id:n.value,business_id:u.value,business_units:l.value,status:E.value}),U.push(`/grupos-de-ubicaciones/${h}`)}catch(e){console.error("Error updating group:",e)}finally{C.value=!1}}function K(e){m.value===e?g.value=!g.value:(m.value=e,g.value=!1)}return(e,a)=>(y(),Y(te,null,{default:t(()=>[s(f,{class:"align-center mb-6","no-gutters":""},{default:t(()=>[s(d,{cols:"auto",class:"d-flex align-center"},{default:t(()=>[s(S,{icon:"",variant:"text",class:"px-3 py-2",style:{"border-radius":"8px",border:"1px solid #ccc"},onClick:a[0]||(a[0]=c=>$(U).back())},{default:t(()=>[s(A,{icon:$(oe)},null,8,["icon"])]),_:1}),a[3]||(a[3]=v("h3",{class:"font-weight-medium ml-3 mb-0"},"Editar Grupo de Ubicaciones",-1))]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,{cols:"12"},{default:t(()=>[a[4]||(a[4]=v("h4",{class:"font-weight-bold mb-3"},"Información General",-1)),s(G,{class:"mb-6"})]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,null,{default:t(()=>[s(F,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=c=>i.value=c),label:"Nombre del grupo",variant:"outlined",color:"primary",required:"",class:"mb-4",error:p.value&&!i.value,"error-messages":p.value&&!i.value?"Este campo es obligatorio.":"",hint:"Este campo es requerido.","persistent-hint":""},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,{cols:"12"},{default:t(()=>[s(G,{class:"mb-5"})]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,null,{default:t(()=>[s(le,{onFilter:P,onOrgBizChange:R,onSearch:L,showOrganization:!0,showBusiness:!0,"organization-id":n.value,"business-id":u.value},null,8,["organization-id","business-id"])]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,null,{default:t(()=>[B.value?(y(),k("div",ue,[s(ee,{indeterminate:"",color:"primary",size:"64"}),a[5]||(a[5]=v("p",{class:"mt-4"},"Cargando ubicaciones...",-1))])):_.value===0?(y(),k("div",ie,[s(A,{size:"64",color:"grey lighten-1"},{default:t(()=>a[6]||(a[6]=[D("mdi-domain-off")])),_:1}),a[7]||(a[7]=v("p",{class:"mt-4 text-h6 text-grey-darken-1"},"No existen ubicaciones",-1)),a[8]||(a[8]=v("p",{class:"text-body-2 text-grey"},"No se encontraron ubicaciones con los filtros aplicados",-1))])):(y(),k(se,{key:2},[s(ne,{items:O.value.map(c=>({...c,addressFormatted:j(T(c.address),50)})),total:_.value,page:r.value,"items-per-page":I.value,"sort-by":m.value,"sort-desc":g.value,"selected-business-units":l.value,"onUpdate:page":a[2]||(a[2]=c=>r.value=c),onSort:K,onToggle:H,error:p.value&&!l.value.length,"is-mobile":e.$vuetify.display.smAndDown},null,8,["items","total","page","items-per-page","sort-by","sort-desc","selected-business-units","error","is-mobile"]),v("div",re,[v("div",{class:"v-messages__message",style:ae(p.value&&!l.value.length?"color: #ff2800; font-size: 0.8125rem; font-weight: 400;":"color: #424242; font-size: 0.8125rem; font-weight: 400;")}," Debes seleccionar al menos una ubicación. ",4)])],64))]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,{class:"d-flex justify-end"},{default:t(()=>[s(S,{color:"primary",loading:C.value,onClick:J},{default:t(()=>a[9]||(a[9]=[D(" Guardar Cambios ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}))}},ye=M(ce,[["__scopeId","data-v-e115f02e"]]);export{ye as default};
