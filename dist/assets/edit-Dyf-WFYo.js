import{_ as ie,A as ue,aC as de,J as d,B as P,an as re,ag as O,c as f,w as l,a as t,l as _,b as u,d as n,f as F,C as x,Z as ce,aj as G,V as c,R as me,at as fe,ao as ve,s as L,v as q,u as D,e as w,aB as H,ap as pe,a6 as ge,am as V,o as m,ak as be,L as J,b1 as Z,t as k,k as K,N as ye,x as he,a9 as _e}from"./index-BtdFDd_C.js";import{j as xe,H as we}from"./mdi-CCqP_oQm.js";import{p as Q}from"./permissionTranslations-DjkJmpfr.js";import{_ as Ve,p as X}from"./permissionfilter-BgE5Ncck.js";const ke=["onClick"],Ce={class:"text-center uniform-col",style:{"padding-left":"0","padding-right":"8px"}},ze={class:"d-flex justify-center align-center",style:{height:"100%"}},Pe={class:"text-center uniform-col",style:{"vertical-align":"middle"}},Le={class:"text-center uniform-col",style:{"vertical-align":"middle"}},Ue={class:"text-center uniform-col",style:{"vertical-align":"middle"}},Re={key:0},$e={class:"font-weight-medium"},Ne={class:"text-caption text-medium-emphasis",style:{"padding-top":"4px","padding-bottom":"8px"}},Se={__name:"edit",setup(Be){const B=ce(),Y=de(),E=ue(),U=Y.params.id;function R(){var s,e;return(e=(s=E.user)==null?void 0:s.roles)==null?void 0:e.includes("superadmin")}const v=d(""),p=d(null),g=d([]),b=d(!1),j=d(""),$=d([]),r=d([]),I=d(!1),N=d(!1),y=d(""),h=d(1),S=d(10),T=d(0),W=d(window.innerWidth<600);window.addEventListener("resize",()=>{W.value=window.innerWidth<600});const ee={user:"Usuario",role:"Rol",permission:"Permiso",businessUnit:"Ubicación",businessUnitGroup:"Grupo de Ubicaciones",organization:"Organización",business:"Negocio",form:"Formulario"},ae=["superadmin","admin","sponsor"],i=P(()=>{var s;return ae.includes((s=v.value)==null?void 0:s.toLowerCase())}),A=P(()=>{var s,e;return(e=(s=E.user)==null?void 0:s.permissions)==null?void 0:e.includes("role.update")});function le(s){return s.filter(e=>e.name&&!e.name.startsWith("form_field.")&&!e.name.startsWith("permission.")&&!e.name.startsWith("person.")).map(e=>{var o;let a=e.name.split(".")[0]||e.model||e.model_name||"Otro";return a==="form_response"&&(a="form"),{id:e.id,name:e.name,model:a,modelLabel:ee[a]||a,label:Q[e.name]||Q[(o=e.name)==null?void 0:o.split(".")[1]]||e.name}})}const C=P(()=>{let s=le($.value);if(y.value){const a=y.value.toLowerCase();s=s.filter(o=>o.modelLabel.toLowerCase().includes(a)||o.label.toLowerCase().includes(a)||o.name.toLowerCase().includes(a))}T.value=s.length;const e=(h.value-1)*S.value;return s.slice(e,e+S.value)}),M=P(()=>Math.ceil(T.value/S.value));async function te(){I.value=!0;try{const{data:s}=await V.get(`/roles/${U}?with=permissions,organization`);if(v.value=s.name,p.value=s.organization_id,r.value=(s.permissions||[]).map(e=>e.name),R()){b.value=!0;const e=await V.get("/organizations",{params:{search:j.value}});g.value=e.data.data||e.data,b.value=!1}}catch{g.value=[]}finally{I.value=!1}}async function se(){try{const{data:s}=await V.get("/permissions");$.value=s.data||s}catch{$.value=[]}}re(async()=>{await se(),await te()}),O(y,()=>{h.value=1}),O(j,async s=>{if(R()){b.value=!0;try{const e=await V.get("/organizations",{params:{search:s}});g.value=e.data.data||e.data}catch{g.value=[]}finally{b.value=!1}}});function z(s){i.value||(r.value.includes(s)?r.value=r.value.filter(e=>e!==s):r.value.push(s))}function oe(s){h.value=s}async function ne(){var s,e,a;if(!(!A.value||!v.value||!p.value||!r.value.length||i.value)){N.value=!0;try{await V.put(`/roles/${U}`,{name:v.value,organization_id:p.value,permissions:r.value}),B.push(`/roles/${U}`)}catch(o){console.error("Error al guardar:",((s=o.response)==null?void 0:s.data)||o),alert(((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Error al guardar")}finally{N.value=!1}}}return(s,e)=>(m(),f(ge,null,{default:l(()=>[t(c,{class:"align-center mb-6","no-gutters":""},{default:l(()=>[t(u,{cols:"auto",class:"d-flex align-center"},{default:l(()=>[t(F,{icon:"",variant:"text",class:"px-3 py-2",style:{"border-radius":"8px",border:"1px solid #ccc"},onClick:e[0]||(e[0]=a=>x(B).back())},{default:l(()=>[t(G,{icon:x(xe)},null,8,["icon"])]),_:1}),e[5]||(e[5]=n("h3",{class:"font-weight-medium ml-3 mb-0"},"Editar Rol",-1))]),_:1})]),_:1}),t(c,null,{default:l(()=>[t(u,null,{default:l(()=>[t(me,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),label:"Nombre del rol",variant:"outlined",color:"primary",required:"",class:"mb-4",disabled:i.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),R()?(m(),f(c,{key:0},{default:l(()=>[t(u,null,{default:l(()=>[t(fe,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a),items:g.value,"item-title":a=>`${a.folio??a.id} - ${a.legal_name??a.name}`,"item-value":"id",label:"Organización",variant:"outlined",color:"primary",required:"",class:"mb-4",loading:b.value,searchable:!0,clearable:"",disabled:i.value},null,8,["modelValue","items","item-title","loading","disabled"])]),_:1})]),_:1})):_("",!0),t(c,null,{default:l(()=>[t(u,null,{default:l(()=>[t(Ve,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),disabled:i.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),W.value?(m(),f(c,{key:2},{default:l(()=>[(m(!0),L(D,null,q(C.value,a=>(m(),f(u,{cols:"12",key:a.id},{default:l(()=>[t(_e,{class:J(["permission-card",{"selected-row":r.value.includes(a.name)}]),onClick:o=>!i.value&&z(a.name),elevation:"1",style:{cursor:"pointer","margin-bottom":"12px"}},{default:l(()=>[t(c,{"no-gutters":""},{default:l(()=>[t(u,{cols:"auto",class:"d-flex align-center justify-center",style:{"padding-left":"8px"}},{default:l(()=>[t(Z,{"model-value":r.value.includes(a.name),"onUpdate:modelValue":o=>!i.value&&z(a.name),color:"primary","hide-details":"",ripple:!1,class:"pa-0 ma-0",style:{"--v-checkbox-bg":"#1976d2","--v-checkbox-checked-color":"#fff"},disabled:i.value},null,8,["model-value","onUpdate:modelValue","disabled"])]),_:2},1024),t(u,null,{default:l(()=>[t(c,{"no-gutters":"",align:"center"},{default:l(()=>[t(u,{cols:"auto",class:"d-flex align-center",style:{"min-width":"100px"}},{default:l(()=>[n("div",$e,k(a.modelLabel),1)]),_:2},1024),t(u,{cols:"auto",class:"d-flex align-center",style:{"padding-left":"12px"}},{default:l(()=>[t(K,{color:"primary","text-color":"white",class:"ma-0 pa-2",style:{"font-weight":"500","font-size":"0.95em"}},{default:l(()=>[w(k(a.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(c,{"no-gutters":""},{default:l(()=>[t(u,null,{default:l(()=>[n("div",Ne,k(x(X)[a.name]||"Sin descripción"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),128)),C.value.length===0?(m(),f(u,{key:0,cols:"12"},{default:l(()=>[t(H,{type:"info",variant:"outlined"},{default:l(()=>e[8]||(e[8]=[w("No hay permisos disponibles.")])),_:1})]),_:1})):_("",!0)]),_:1})):(m(),f(c,{key:1},{default:l(()=>[t(u,null,{default:l(()=>[t(ve,{class:"rounded-lg elevation-1 uniform-table",style:{width:"100%"}},{default:l(()=>[e[7]||(e[7]=n("thead",null,[n("tr",null,[n("th",{class:"font-weight-bold text-center uniform-col",style:{width:"80px"}}),n("th",{class:"font-weight-bold text-center uniform-col",style:{width:"200px"}},"Modelo"),n("th",{class:"font-weight-bold text-center uniform-col",style:{width:"220px"}},"Permiso"),n("th",{class:"font-weight-bold text-center uniform-col",style:{width:"60px"}})])],-1)),n("tbody",null,[(m(!0),L(D,null,q(C.value,a=>(m(),L("tr",{key:a.id,class:J(["row-clickable",{"selected-row":r.value.includes(a.name)}]),style:be({cursor:i.value?"not-allowed":"pointer"}),onClick:o=>!i.value&&z(a.name)},[n("td",Ce,[n("div",ze,[t(Z,{"model-value":r.value.includes(a.name),"onUpdate:modelValue":o=>!i.value&&z(a.name),color:"primary","hide-details":"",ripple:!1,class:"pa-0 ma-0",style:{"--v-checkbox-bg":"#1976d2","--v-checkbox-checked-color":"#fff"},disabled:i.value},null,8,["model-value","onUpdate:modelValue","disabled"])])]),n("td",Pe,k(a.modelLabel),1),n("td",Le,[t(K,{color:"primary","text-color":"white",class:"ma-0 pa-2",style:{"font-weight":"500","font-size":"0.95em"}},{default:l(()=>[w(k(a.label),1)]),_:2},1024)]),n("td",Ue,[t(ye,{location:"top",text:x(X)[a.name]||"Sin descripción"},{activator:l(({props:o})=>[t(G,he({ref_for:!0},o,{icon:x(we),color:"primary",style:{cursor:"pointer"}}),null,16,["icon"])]),_:2},1032,["text"])])],14,ke))),128)),C.value.length===0?(m(),L("tr",Re,e[6]||(e[6]=[n("td",{colspan:"4",class:"text-center text-medium-emphasis"},"No hay permisos disponibles.",-1)]))):_("",!0)])]),_:1})]),_:1})]),_:1})),M.value>1?(m(),f(c,{key:3},{default:l(()=>[t(u,{class:"d-flex justify-center"},{default:l(()=>[t(pe,{modelValue:h.value,"onUpdate:modelValue":[e[4]||(e[4]=a=>h.value=a),oe],length:M.value,color:"primary",disabled:i.value},null,8,["modelValue","length","disabled"])]),_:1})]),_:1})):_("",!0),t(c,null,{default:l(()=>[t(u,{class:"d-flex justify-end"},{default:l(()=>[t(F,{color:"primary",loading:N.value,disabled:!A.value||!v.value||!p.value||!r.value.length||i.value,onClick:ne},{default:l(()=>e[9]||(e[9]=[w(" Guardar Cambios ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1}),i.value?(m(),f(c,{key:4},{default:l(()=>[t(u,null,{default:l(()=>[t(H,{type:"info",variant:"outlined",class:"mt-4"},{default:l(()=>e[10]||(e[10]=[w(" Este rol no se puede editar. ")])),_:1})]),_:1})]),_:1})):_("",!0)]),_:1}))}},We=ie(Se,[["__scopeId","data-v-394c97b2"]]);export{We as default};
