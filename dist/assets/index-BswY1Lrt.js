import{s as f,o as i,a as r,d as l,w as a,e as C,ae as q,ao as ue,ap as de,_ as ae,a0 as oe,A as le,B as p,J as b,q as ce,aq as ve,u as T,l as y,c,al as z,v as Y,V as W,b as D,Q as H,a2 as K,t as x,am as Z,ab as me,N as ge,S as fe,G as pe,p as O,m as Q,C as w,H as ee,f as ne,x as ye,L as R,ar as be,K as _e,a8 as ke}from"./index-mAfd8qbF.js";import{b as Ce,k as we,l as he,p as Ve,e as xe,f as Se,g as Ae,i as se}from"./mdi-CCqP_oQm.js";import{_ as te}from"./StatusChip-ejlLwmE5.js";import{_ as $e}from"./BusinessUnitFilter-D6y0WrhT.js";/* empty css                */const ze={class:"d-flex justify-center mt-4"},Le={__name:"BusinessUnitTableMeta",props:{items:{type:Array,default:()=>[]},page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean},emits:["update:page","sort"],setup(L,{emit:B}){const S=L,g=B;return(h,n)=>{var d;return i(),f("div",null,[r(ue,{density:"comfortable",class:"fixed-table elevation-1 rounded-lg"},{default:a(()=>[l("thead",null,[l("tr",null,[l("th",{onClick:n[0]||(n[0]=m=>g("sort","folio")),class:"cursor-pointer folio-header"},[n[5]||(n[5]=C(" Folio ")),q(h.$slots,"sort-icon",{column:"folio"})]),n[8]||(n[8]=l("th",{class:"logo-header"},"Logo",-1)),l("th",{onClick:n[1]||(n[1]=m=>g("sort","legal_name")),class:"cursor-pointer legal-header"},[n[6]||(n[6]=C(" Nombre Legal ")),q(h.$slots,"sort-icon",{column:"legal_name"})]),l("th",{onClick:n[2]||(n[2]=m=>g("sort","address")),class:"cursor-pointer address-header"},[n[7]||(n[7]=C(" Dirección ")),q(h.$slots,"sort-icon",{column:"address"})]),n[9]||(n[9]=l("th",{class:"status-header"},"Estado",-1)),n[10]||(n[10]=l("th",{class:"actions-header"},null,-1))])]),l("tbody",null,[q(h.$slots,"rows")])]),_:3}),l("div",ze,[r(de,{modelValue:S.page,"onUpdate:modelValue":[n[3]||(n[3]=m=>S.page=m),n[4]||(n[4]=m=>g("update:page",m))],length:Math.ceil((((d=S.items)==null?void 0:d.length)||1)/S.itemsPerPage),"total-visible":"7",color:"primary"},null,8,["modelValue","length"])])])}}},Be={key:0,class:"text-center py-8"},Pe={key:0,class:"text-center py-8"},Ie={class:"logo-container-mobile"},Ee=["src"],Ue={class:"d-flex align-center mb-1",style:{"justify-content":"space-between"}},De={class:"text-caption",style:{"margin-right":"8px"}},Ne={key:1},Me={class:"font-weight-medium mb-1"},Te={class:"text-caption"},je=["onClick"],Fe={class:"folio-cell"},qe={key:1},He={class:"logo-cell"},Re=["src"],Ge={class:"legal-cell"},Je={class:"address-cell"},Ke={class:"status-cell"},Oe={__name:"BusinessUnitList",props:{items:Array,isMobile:Boolean,canEditPermission:Boolean,isLoading:Boolean},setup(L){const B=L,S=oe(),g=le(),h=p(()=>g.user||{roles:[],permissions:[]}),n=p(()=>h.value.roles||[]),d=p(()=>h.value.permissions||[]),m=p(()=>n.value.includes("superadmin")),N=p(()=>n.value.includes("admin")),j=p(()=>n.value.includes("sponsor")),P=p(()=>m.value||N.value||j.value),_=p(()=>d.value.includes("businessUnit.update")||B.canEditPermission),v=p(()=>d.value.includes("businessUnit.view")),G=p(()=>v.value||_.value||P.value),V=b("folio"),$=b(!1),u=b(1),e=b(10),k=o=>{V.value===o?$.value=!$.value:(V.value=o,$.value=!1)},I=o=>{if(!o)return"No disponible";const t=[o.street,o.outdoor_number,o.neighborhood,o.city,o.postal_code,o.state,o.country].filter(Boolean);return t.length?t.join(", "):"No disponible"},M=(o,t=60)=>o?o.length>t?o.slice(0,t)+"...":o:"",E=p(()=>[...B.items].sort((o,t)=>{var A,X;const U=V.value==="address"?I(o.address).toLowerCase():((A=o[V.value])==null?void 0:A.toString().toLowerCase())??"",s=V.value==="address"?I(t.address).toLowerCase():((X=t[V.value])==null?void 0:X.toString().toLowerCase())??"";return U.localeCompare(s)*($.value?-1:1)})),F=p(()=>{const o=(u.value-1)*e.value;return E.value.slice(o,o+e.value)}),ie=o=>S.push({path:`/ubicaciones/editar/${o.id}`}),J=o=>S.push({path:`/ubicaciones/${o.id}`}),re=async o=>{if(!P.value)return;const U=o.status==="activa"||o.status==="active"?"inactive":"active";try{const s=await R.put(`/business-units/${o.id}`,{status:U});o.status=s.data.status||U}catch{alert("No se pudo cambiar el estatus")}};return(o,t)=>{const U=ce("router-link");return i(),f("div",null,[L.isLoading?(i(),f("div",Be,[r(ve,{indeterminate:"",color:"primary",size:"64"}),t[4]||(t[4]=l("p",{class:"mt-4"},"Cargando unidades...",-1))])):(i(),f(T,{key:1},[F.value.length?L.isMobile?(i(!0),f(T,{key:1},Y(F.value,s=>(i(),c(me,{key:s.id,class:"mb-4 pa-3 elevation-1 rounded-lg row-clickable",onClick:A=>v.value?J(s):void 0,style:Z({cursor:v.value?"pointer":"default"})},{default:a(()=>[r(W,{"no-gutters":"",align:"center",class:"mb-1"},{default:a(()=>[r(D,{cols:"3",class:"d-flex justify-start align-center"},{default:a(()=>[l("div",Ie,[s.logo?(i(),c(H,{key:0,class:"logo-avatar-mobile",color:"grey lighten-2"},{default:a(()=>[l("img",{src:s.logo,alt:"Logo",class:"logo-img-cover"},null,8,Ee)]),_:2},1024)):(i(),c(H,{key:1,class:"logo-avatar-mobile",color:"grey lighten-2"},{default:a(()=>t[8]||(t[8]=[l("span",{style:{"font-size":"12px",color:"#888"}},"Sin logo",-1)])),_:1}))])]),_:2},1024),r(D,{cols:"1"}),r(D,{cols:"8"},{default:a(()=>[l("div",Ue,[l("div",De,[v.value?(i(),c(U,{key:0,to:`/ubicaciones/${s.id}`,onClick:t[0]||(t[0]=K(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:a(()=>[C(x(s.folio),1)]),_:2},1032,["to"])):(i(),f("span",Ne,x(s.folio),1))]),r(te,{status:s.status},null,8,["status"])]),l("div",Me,x(s.legal_name),1),l("div",Te,[t[9]||(t[9]=l("strong",null,"Dirección:",-1)),C(" "+x(M(I(s.address),60)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128)):y("",!0):(i(),f("div",Pe,[r(z,{size:"64",color:"grey lighten-1"},{default:a(()=>t[5]||(t[5]=[C("mdi-domain-off")])),_:1}),t[6]||(t[6]=l("p",{class:"mt-4 text-h6 text-grey-darken-1"},"No existen unidades",-1)),t[7]||(t[7]=l("p",{class:"text-body-2 text-grey"},"No se encontraron unidades con los filtros aplicados",-1))])),L.isMobile?y("",!0):(i(),c(Le,{key:2,items:E.value.value,page:u.value,itemsPerPage:e.value,sortBy:V.value,sortDesc:$.value,"onUpdate:page":t[3]||(t[3]=s=>u.value=s),onSort:k},{"sort-icon":a(({column:s})=>[V.value===s?(i(),c(z,{key:0,size:"16",class:"ml-1"},{default:a(()=>[C(x($.value?w(Se):w(Ae)),1)]),_:1})):y("",!0)]),rows:a(()=>[F.value.length?(i(!0),f(T,{key:0},Y(F.value,s=>(i(),f("tr",{key:s.id,onClick:A=>v.value?J(s):void 0,class:ge(["row-clickable",{"row-disabled":!v.value}]),style:Z({cursor:v.value?"pointer":"default"})},[l("td",Fe,[v.value?(i(),c(U,{key:0,to:`/ubicaciones/${s.id}`,onClick:t[1]||(t[1]=K(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:a(()=>[C(x(s.folio),1)]),_:2},1032,["to"])):(i(),f("span",qe,x(s.folio),1))]),l("td",He,[s.logo?(i(),c(H,{key:0,size:"48",class:"logo-avatar"},{default:a(()=>[l("img",{src:s.logo,alt:"Logo",class:"logo-img-cover"},null,8,Re)]),_:2},1024)):(i(),c(H,{key:1,size:"48",color:"grey lighten-2",class:"d-flex align-center justify-center"},{default:a(()=>t[10]||(t[10]=[l("span",{style:{"font-size":"12px",color:"#888"}},"Sin logo",-1)])),_:1}))]),l("td",Ge,x(s.legal_name),1),l("td",Je,x(M(I(s.address),60)),1),l("td",Ke,[r(te,{status:s.status},null,8,["status"])]),l("td",{class:"actions-cell",onClick:t[2]||(t[2]=K(()=>{},["stop"]))},[G.value?(i(),c(fe,{key:0,location:"bottom end"},{activator:a(({props:A})=>[r(ne,ye({ref_for:!0},A,{variant:"text",class:"pa-0","min-width":"0",height:"24"}),{default:a(()=>[r(z,{icon:w(xe),size:"20"},null,8,["icon"])]),_:2},1040)]),default:a(()=>[r(pe,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:a(()=>[v.value?(i(),c(O,{key:0,onClick:A=>J(s)},{prepend:a(()=>[r(z,{icon:w(Ce),size:"18"},null,8,["icon"])]),default:a(()=>[r(Q,null,{default:a(()=>t[11]||(t[11]=[C("Ver")])),_:1})]),_:2},1032,["onClick"])):y("",!0),_.value&&v.value?(i(),c(ee,{key:1,class:"my-1"})):y("",!0),_.value?(i(),c(O,{key:2,onClick:A=>ie(s)},{prepend:a(()=>[r(z,{icon:w(we),size:"18"},null,8,["icon"])]),default:a(()=>[r(Q,null,{default:a(()=>t[12]||(t[12]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])):y("",!0),P.value?(i(),c(ee,{key:3,class:"my-1"})):y("",!0),P.value?(i(),c(O,{key:4,onClick:A=>re(s)},{prepend:a(()=>[r(z,{icon:s.status==="activa"||s.status==="active"?w(he):w(Ve),size:"18"},null,8,["icon"])]),default:a(()=>[r(Q,null,{default:a(()=>[C(x(s.status==="activa"||s.status==="active"?"Desactivar":"Activar"),1)]),_:2},1024)]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),_:2},1024)):y("",!0)])],14,je))),128)):y("",!0)]),_:1},8,["items","page","itemsPerPage","sortBy","sortDesc"]))],64))])}}},Qe=ae(Oe,[["__scopeId","data-v-e242db1a"]]),We={key:0},Xe={__name:"index",setup(L){const B=oe(),S=b([]),g=b([]),{mdAndDown:h}=be(),n=b(""),d=b({}),m=le(),N=b(!1),j=b(!1),P=b(!1),_=b(!1);function v(u){var e,k;return(k=(e=m.user)==null?void 0:e.permissions)==null?void 0:k.includes(u)}_e(async()=>{var u,e,k,I,M;if((e=(u=m.user)==null?void 0:u.roles)!=null&&e.includes("superadmin")||(I=(k=m.user)==null?void 0:k.roles)!=null&&I.includes("admin")||v("businessUnit.viewAny")){N.value=!0,j.value=v("businessUnit.create"),P.value=v("businessUnit.update");try{_.value=!0;const{data:E}=await R.get("/business-units");S.value=E.data,g.value=E.data}catch(E){console.error("Error fetching business units:",E)}finally{_.value=!1}}else N.value=!1,v("businessUnit.view")&&((M=m.user)!=null&&M.business_unit_id)&&B.replace(`/ubicaciones/${m.user.business_unit_id}`)});const G=()=>{B.push("/ubicaciones/crear")};async function V(u){n.value=u;try{_.value=!0;const e={};u&&(e.search=u),d.value.organizationId&&(e.organization_id=d.value.organizationId),d.value.businessId&&(e.business_id=d.value.businessId),d.value.createdAtStart&&(e.created_at_start=d.value.createdAtStart),d.value.createdAtEnd&&(e.created_at_end=d.value.createdAtEnd),d.value.status&&(e.status=d.value.status);const{data:k}=await R.get("/business-units",{params:e});g.value=k.data}catch(e){g.value=[],console.error("Error searching business units:",e)}finally{_.value=!1}}async function $(u){d.value=u;try{const e={...u};u.organizationId&&(e.organization_id=u.organizationId,delete e.organizationId),u.businessId&&(e.business_id=u.businessId,delete e.businessId),u.createdAtStart&&(e.created_at_start=u.createdAtStart,delete e.createdAtStart),u.createdAtEnd&&(e.created_at_end=u.createdAtEnd,delete e.createdAtEnd),u.status&&(e.status=u.status),n.value&&(e.search=n.value),_.value=!0;const{data:k}=await R.get("/business-units",{params:e});g.value=k.data}catch(e){console.error("Error fetching filtered business units:",e),g.value=[]}finally{_.value=!1}}return(u,e)=>N.value?(i(),f("div",We,[r(ke,{fluid:""},{default:a(()=>[r(W,{class:"align-center justify-space-between mb-4"},{default:a(()=>[r(D,{cols:"auto",class:"d-flex align-center"},{default:a(()=>e[0]||(e[0]=[l("h3",{class:"font-weight-medium mb-0"},"Ubicaciones",-1)])),_:1}),j.value?(i(),c(D,{key:0,cols:"auto",class:"d-flex align-center justify-end"},{default:a(()=>[r(ne,{color:"primary",class:"text-white",elevation:"1",onClick:G},{default:a(()=>[w(h)?(i(),f(T,{key:0},[r(z,{icon:w(se),start:""},null,8,["icon"]),e[1]||(e[1]=l("span",null,"Agregar",-1))],64)):(i(),f(T,{key:1},[r(z,{icon:w(se),start:""},null,8,["icon"]),e[2]||(e[2]=l("span",null,"Agregar Ubicación",-1))],64))]),_:1})]),_:1})):y("",!0)]),_:1}),r($e,{onSearch:V,onFilter:$,class:"mb-4"}),r(W,null,{default:a(()=>[r(D,null,{default:a(()=>[r(Qe,{items:g.value,isMobile:w(h),"can-edit-permission":P.value,isLoading:_.value},null,8,["items","isMobile","can-edit-permission","isLoading"])]),_:1})]),_:1})]),_:1})])):y("",!0)}},as=ae(Xe,[["__scopeId","data-v-b756b2a0"]]);export{as as default};
