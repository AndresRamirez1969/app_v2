import{s as k,o as r,a,d as o,w as e,e as p,ae as E,ao as ie,ap as re,_ as ue,a0 as ae,A as le,B as L,q as de,aq as ce,u as j,c as b,al as $,v as W,V as G,b as U,Q as H,a2 as I,t as A,am as X,ab as se,l as z,N as me,S as J,G as ve,p as K,m as q,C as w,H as Y,f as M,x as Q,L as oe,J as c,ar as ne,ai as fe,as as pe,U as R,af as ge,ag as ye,at as be,b3 as Z,au as ke,an as xe,K as we,a8 as Ve}from"./index-DA8Oyi7H.js";import{b as Ce,k as he,l as ze,p as $e,e as Se,f as Ae,g as _e,i as ee}from"./mdi-CCqP_oQm.js";import{_ as te}from"./StatusChip-CY_B-sI1.js";/* empty css                */const Be={class:"d-flex justify-center mt-4"},De={__name:"OrganizationTableMeta",props:{items:{type:Array,default:()=>[]},page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean,meta:Object},emits:["update:page","sort"],setup(m,{emit:N}){const y=m,g=N;return(v,n)=>{var _;return r(),k("div",null,[a(ie,{density:"comfortable",class:"fixed-table elevation-1 rounded-lg"},{default:e(()=>[o("thead",null,[o("tr",null,[o("th",{onClick:n[0]||(n[0]=d=>g("sort","folio")),class:"cursor-pointer folio-header"},[n[6]||(n[6]=p(" Folio ")),E(v.$slots,"sort-icon",{column:"folio"})]),n[10]||(n[10]=o("th",{class:"logo-header"},"Logo",-1)),o("th",{onClick:n[1]||(n[1]=d=>g("sort","legal_name")),class:"cursor-pointer legal-header"},[n[7]||(n[7]=p(" Nombre Legal ")),E(v.$slots,"sort-icon",{column:"legal_name"})]),o("th",{onClick:n[2]||(n[2]=d=>g("sort","alias")),class:"cursor-pointer alias-header"},[n[8]||(n[8]=p(" Alias ")),E(v.$slots,"sort-icon",{column:"alias"})]),o("th",{onClick:n[3]||(n[3]=d=>g("sort","address")),class:"cursor-pointer address-header"},[n[9]||(n[9]=p(" Dirección ")),E(v.$slots,"sort-icon",{column:"address"})]),n[11]||(n[11]=o("th",{class:"status-header"},"Estado",-1)),n[12]||(n[12]=o("th",{class:"actions-header"},null,-1))])]),o("tbody",null,[E(v.$slots,"rows")])]),_:3}),o("div",Be,[a(re,{modelValue:y.page,"onUpdate:modelValue":[n[4]||(n[4]=d=>y.page=d),n[5]||(n[5]=d=>g("update:page",d))],length:((_=y.meta)==null?void 0:_.last_page)||1,"total-visible":"7",color:"primary"},null,8,["modelValue","length"])])])}}},Pe={key:0,class:"text-center py-8"},Le={key:0,class:"text-center py-8"},Ne={class:"logo-container-mobile"},Te=["src"],Fe={class:"d-flex align-center mb-1",style:{"justify-content":"space-between"}},Oe={class:"text-caption",style:{"margin-right":"8px"}},Me={class:"font-weight-medium mb-1"},Ue={class:"text-caption mb-1"},Ee={class:"text-caption"},je=["onClick"],He={class:"folio-cell"},Ie={class:"logo-cell"},Ke=["src"],qe={class:"legal-cell"},Re={class:"alias-cell"},Ge={class:"address-cell"},Je={class:"status-cell"},Qe={__name:"OrganizationList",props:{items:Array,isMobile:Boolean,isLoading:Boolean,page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean,meta:Object},emits:["update:page","sort"],setup(m,{emit:N}){const y=m,g=N,v=ae(),n=le(),_=L(()=>n.user||{roles:[],permissions:[]}),d=L(()=>_.value.roles||[]),f=L(()=>_.value.permissions||[]),D=L(()=>d.value.includes("superadmin")),V=L(()=>D.value),C=L(()=>f.value.includes("organization.update")),x=L(()=>f.value.includes("organization.view")),F=L(()=>x.value||C.value||V.value),P=l=>{if(!l)return"No disponible";const i=[l.street,l.outdoor_number,l.indoor_number,l.neighborhood,l.city,l.postal_code,l.state,l.country].filter(Boolean);return i.length?i.join(", "):"No disponible"},B=(l,i=50)=>l?l.length>i?l.slice(0,i)+"...":l:"",O=l=>v.push({path:`/organizaciones/editar/${l.id}`}),S=l=>v.push({path:`/organizaciones/${l.id}`}),h=async l=>{if(!V.value)return;const T=l.status==="active"?"inactive":"active";try{const s=await oe.put(`/organizations/${l.id}`,{status:T});l.status=s.data.status||T}catch{alert("No se pudo cambiar el estatus")}},t=l=>{g("sort",{sortBy:l,sortDesc:y.sortBy===l?!y.sortDesc:!1})};return(l,i)=>{const T=de("router-link");return r(),k("div",null,[m.isLoading?(r(),k("div",Pe,[a(ce,{indeterminate:"",color:"primary",size:"64"}),i[4]||(i[4]=o("p",{class:"mt-4"},"Cargando organizaciones...",-1))])):(r(),k(j,{key:1},[m.items.length?m.isMobile?(r(!0),k(j,{key:1},W(m.items,s=>(r(),b(se,{key:s.id,class:"mb-4 pa-3 elevation-1 rounded-lg row-clickable",onClick:u=>x.value?S(s):void 0,style:X({cursor:x.value?"pointer":"default"})},{default:e(()=>[a(G,{"no-gutters":"",align:"center",class:"mb-1"},{default:e(()=>[a(U,{cols:"3",class:"d-flex justify-start align-center"},{default:e(()=>[o("div",Ne,[s.logo?(r(),b(H,{key:0,class:"logo-avatar-mobile",color:"grey lighten-2"},{default:e(()=>[o("img",{src:s.logo,alt:"Logo",class:"logo-img-cover"},null,8,Te)]),_:2},1024)):(r(),b(H,{key:1,class:"logo-avatar-mobile",color:"grey lighten-2"},{default:e(()=>i[8]||(i[8]=[o("span",{style:{"font-size":"12px",color:"#888"}},"Sin logo",-1)])),_:1}))])]),_:2},1024),a(U,{cols:"1"}),a(U,{cols:"8"},{default:e(()=>[o("div",Fe,[o("div",Oe,[a(T,{to:`/organizaciones/${s.id}`,onClick:i[0]||(i[0]=I(()=>{},["stop"])),style:{"text-decoration":"underline",color:"#1976d2 !important"}},{default:e(()=>[p(A(s.folio),1)]),_:2},1032,["to"])]),a(te,{status:s.status},null,8,["status"])]),o("div",Me,A(s.legal_name),1),o("div",Ue,[i[9]||(i[9]=o("strong",null,"Alias:",-1)),p(" "+A(s.alias||"Sin alias"),1)]),o("div",Ee,[i[10]||(i[10]=o("strong",null,"Dirección:",-1)),p(" "+A(B(P(s.address),50)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128)):(r(),b(De,{key:2,items:m.items,page:m.page,itemsPerPage:m.itemsPerPage,sortBy:m.sortBy,sortDesc:m.sortDesc,"onUpdate:page":i[3]||(i[3]=s=>g("update:page",s)),onSort:t},{"sort-icon":e(({column:s})=>[m.sortBy===s?(r(),b($,{key:0,size:"16",class:"ml-1"},{default:e(()=>[p(A(m.sortDesc?w(Ae):w(_e)),1)]),_:1})):z("",!0)]),rows:e(()=>[m.items.length?(r(!0),k(j,{key:0},W(m.items,s=>(r(),k("tr",{key:s.id,onClick:u=>x.value?S(s):void 0,class:me(["row-clickable",{"row-disabled":!x.value}]),style:X({cursor:x.value?"pointer":"default"})},[o("td",He,[a(T,{to:`/organizaciones/${s.id}`,onClick:i[1]||(i[1]=I(()=>{},["stop"])),style:{"text-decoration":"underline",color:"#1976d2 !important"}},{default:e(()=>[p(A(s.folio),1)]),_:2},1032,["to"])]),o("td",Ie,[s.logo?(r(),b(H,{key:0,size:"48",class:"logo-avatar"},{default:e(()=>[o("img",{src:s.logo,alt:"Logo",class:"logo-img-cover"},null,8,Ke)]),_:2},1024)):(r(),b(H,{key:1,size:"48",color:"grey lighten-2",class:"d-flex align-center justify-center"},{default:e(()=>i[11]||(i[11]=[o("span",{style:{"font-size":"12px",color:"#888"}},"Sin logo",-1)])),_:1}))]),o("td",qe,A(s.legal_name),1),o("td",Re,A(s.alias||"Sin alias"),1),o("td",Ge,A(B(P(s.address),50)),1),o("td",Je,[a(te,{status:s.status},null,8,["status"])]),o("td",{class:"actions-cell",onClick:i[2]||(i[2]=I(()=>{},["stop"]))},[F.value?(r(),b(J,{key:0,location:"bottom end"},{activator:e(({props:u})=>[a(M,Q({ref_for:!0},u,{variant:"text",class:"pa-0","min-width":"0",height:"24"}),{default:e(()=>[a($,{icon:w(Se),size:"20"},null,8,["icon"])]),_:2},1040)]),default:e(()=>[a(ve,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:e(()=>[x.value?(r(),b(K,{key:0,onClick:u=>S(s)},{prepend:e(()=>[a($,{icon:w(Ce),size:"18"},null,8,["icon"])]),default:e(()=>[a(q,null,{default:e(()=>i[12]||(i[12]=[p("Ver")])),_:1})]),_:2},1032,["onClick"])):z("",!0),C.value&&x.value?(r(),b(Y,{key:1,class:"my-1"})):z("",!0),C.value?(r(),b(K,{key:2,onClick:u=>O(s)},{prepend:e(()=>[a($,{icon:w(he),size:"18"},null,8,["icon"])]),default:e(()=>[a(q,null,{default:e(()=>i[13]||(i[13]=[p("Editar")])),_:1})]),_:2},1032,["onClick"])):z("",!0),V.value?(r(),b(Y,{key:3,class:"my-1"})):z("",!0),V.value?(r(),b(K,{key:4,onClick:u=>h(s)},{prepend:e(()=>[a($,{icon:s.status==="active"?w(ze):w($e),size:"18"},null,8,["icon"])]),default:e(()=>[a(q,null,{default:e(()=>[p(A(s.status==="active"?"Desactivar":"Activar"),1)]),_:2},1024)]),_:2},1032,["onClick"])):z("",!0)]),_:2},1024)]),_:2},1024)):z("",!0)])],14,je))),128)):z("",!0)]),_:1},8,["items","page","itemsPerPage","sortBy","sortDesc"])):(r(),k("div",Le,[a($,{size:"64",color:"grey lighten-1"},{default:e(()=>i[5]||(i[5]=[p("mdi-domain-off")])),_:1}),i[6]||(i[6]=o("p",{class:"mt-4 text-h6 text-grey-darken-1"},"No existen organizaciones",-1)),i[7]||(i[7]=o("p",{class:"text-body-2 text-grey"},"No se encontraron organizaciones con los filtros aplicados",-1))]))],64))])}}},We=ue(Qe,[["__scopeId","data-v-14f4030c"]]),Xe={class:"d-flex align-center mb-6",style:{gap:"16px"}},Ye={class:"filter-btn-wrapper ml-2 flex-shrink-0",style:{"min-width":"44px",position:"relative"}},Ze={key:1,class:"filter-btn-content"},et={key:0,class:"filter-indicator"},tt={class:"mb-3"},at={__name:"OrganizationFilters",emits:["search","filter"],setup(m,{emit:N}){const y=N,g=c(""),v=c(!1),n=c(null),_=[{title:"Activo",value:"active"},{title:"Inactivo",value:"inactive"}],d=c(null),f=c(null),D=c(!1),V=c(!1),{mdAndDown:C}=ne();let x;fe(g,h=>{clearTimeout(x),x=setTimeout(()=>{y("search",h)},350)});const F=L(()=>!!n.value||!!d.value||!!f.value);function P(){y("search",g.value)}function B(h){return h?typeof h=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(h)?h:new Date(h).toISOString().slice(0,10):null}function O(){y("filter",{status:n.value,created_at_start:B(d.value),created_at_end:B(f.value)}),v.value=!1}function S(){n.value=null,d.value=null,f.value=null,y("filter",{status:null,created_at_start:null,created_at_end:null})}return(h,t)=>(r(),k("div",Xe,[a(R,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=l=>g.value=l),placeholder:"Buscar por nombre legal, alias o folio...","prepend-inner-icon":"mdi-magnify",clearable:"",class:"flex-grow-1 search-bar",density:"compact",variant:"outlined",color:"primary","hide-details":"",style:{"min-width":"220px"},onKeyup:pe(P,["enter"]),"onClick:clear":P},null,8,["modelValue"]),o("div",Ye,[a(M,{icon:w(C),variant:"text",class:"filter-btn filter-btn-center",style:{"border-radius":"8px",border:"1px solid #ccc","min-width":"44px",height:"44px",width:"100%"},color:"#222",onClick:t[1]||(t[1]=l=>v.value=!0)},{default:e(()=>[w(C)?(r(),b($,{key:0},{default:e(()=>t[13]||(t[13]=[o("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[o("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1})):(r(),k("span",Ze,[a($,{class:"mr-2"},{default:e(()=>t[14]||(t[14]=[o("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1}),t[16]||(t[16]=o("span",null,"Filtros",-1)),a($,{class:"ml-2",end:""},{default:e(()=>t[15]||(t[15]=[p("mdi-filter-variant")])),_:1})]))]),_:1},8,["icon"]),F.value?(r(),k("span",et)):z("",!0)]),a(xe,{modelValue:v.value,"onUpdate:modelValue":t[12]||(t[12]=l=>v.value=l),"max-width":"420"},{default:e(()=>[a(se,{class:"modal-padding",style:{position:"relative"}},{default:e(()=>[a(M,{icon:"",variant:"text",class:"position-absolute close-btn",style:{top:"10px",right:"10px",color:"#222","z-index":"10"},onClick:t[2]||(t[2]=l=>v.value=!1)},{default:e(()=>[a($,null,{default:e(()=>t[17]||(t[17]=[o("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),_:1})]),_:1}),a(ge,{class:"font-weight-bold"},{default:e(()=>t[18]||(t[18]=[p("Filtros avanzados")])),_:1}),a(ye,{class:"pb-0"},{default:e(()=>[a(be,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=l=>n.value=l),items:_,label:"Estado",clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"mb-3 filter-padding",style:{"padding-top":"0px","padding-bottom":"0px"}},null,8,["modelValue"]),o("div",tt,[a(J,{modelValue:D.value,"onUpdate:modelValue":t[7]||(t[7]=l=>D.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:e(({props:l})=>[a(R,Q({"model-value":B(d.value),label:"Fecha de Inicio",readonly:""},l,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field mb-2","onClick:clear":t[4]||(t[4]=i=>d.value=null)}),null,16,["model-value"])]),default:e(()=>[a(Z,{modelValue:d.value,"onUpdate:modelValue":[t[5]||(t[5]=l=>d.value=l),t[6]||(t[6]=l=>D.value=!1)],locale:"es"},{header:e(()=>t[19]||(t[19]=[])),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),a(J,{modelValue:V.value,"onUpdate:modelValue":t[11]||(t[11]=l=>V.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:e(({props:l})=>[a(R,Q({"model-value":B(f.value),label:"Fecha de Fin",readonly:""},l,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field","onClick:clear":t[8]||(t[8]=i=>f.value=null)}),null,16,["model-value"])]),default:e(()=>[a(Z,{modelValue:f.value,"onUpdate:modelValue":[t[9]||(t[9]=l=>f.value=l),t[10]||(t[10]=l=>V.value=!1)],locale:"es"},{header:e(()=>t[20]||(t[20]=[])),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])]),_:1}),a(ke,{class:"d-flex flex-column align-end pt-2",style:{gap:"8px"}},{default:e(()=>[a(M,{style:{"background-color":"#1677ff",color:"white","font-weight":"500","font-size":"14px",width:"100%","text-transform":"none"},onClick:O},{default:e(()=>t[21]||(t[21]=[p(" Aplicar ")])),_:1}),a(M,{variant:"text",style:{width:"100%",color:"#555","font-weight":"500","font-size":"13px","text-transform":"none"},onClick:S},{default:e(()=>t[22]||(t[22]=[p(" Limpiar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},lt={key:0},st={key:0,class:"mt-4 text-error text-center"},ut={__name:"index",setup(m){const N=ae(),y=c([]),g=c({}),v=c(!1),n=c(""),{mdAndDown:_}=ne(),d=c(""),f=c({}),D=c("legal_name"),V=c(!1),C=c(1),x=c(10),F=le(),P=c(!1),B=c(!1);function O(s){var u;return Array.isArray((u=F.user)==null?void 0:u.permissions)&&F.user.permissions.includes(s)}async function S(){if(P.value){v.value=!0,n.value="";try{const s={search:d.value,status:f.value.status,created_at_start:f.value.created_at_start??f.value.createdAtStart,created_at_end:f.value.created_at_end??f.value.createdAtEnd,sort_by:D.value,sort_desc:V.value,page:C.value,per_page:x.value},{data:u}=await oe.get("/organizations",{params:s});y.value=Array.isArray(u.data)?u.data:[],g.value=u.meta||{}}catch{n.value="Error al cargar organizaciones",y.value=[]}finally{v.value=!1}}}we(async()=>{if(!O("organization.viewAny")){N.replace("/403");return}P.value=!0,B.value=O("organization.create"),await S()});const h=()=>{N.push("/organizaciones/crear")};function t(s){d.value=s,C.value=1,S()}function l(s){f.value=s,C.value=1,S()}function i(s){C.value=s,S()}function T({sortBy:s,sortDesc:u}){D.value=s,V.value=u,S()}return(s,u)=>P.value?(r(),k("div",lt,[a(Ve,{fluid:""},{default:e(()=>[a(G,{class:"align-center justify-space-between mb-4"},{default:e(()=>[a(U,{cols:"auto",class:"d-flex align-center"},{default:e(()=>u[0]||(u[0]=[o("h3",{class:"font-weight-medium mb-0"},"Organizaciones",-1)])),_:1}),B.value?(r(),b(U,{key:0,cols:"auto",class:"d-flex align-center justify-end"},{default:e(()=>[a(M,{color:"primary",class:"text-white",elevation:"1",onClick:h},{default:e(()=>[w(_)?(r(),k(j,{key:0},[a($,{icon:w(ee),start:""},null,8,["icon"]),u[1]||(u[1]=o("span",null,"Agregar",-1))],64)):(r(),k(j,{key:1},[a($,{icon:w(ee),start:""},null,8,["icon"]),u[2]||(u[2]=o("span",null,"Agregar Organización",-1))],64))]),_:1})]),_:1})):z("",!0)]),_:1}),a(at,{onSearch:t,onFilter:l,class:"mb-4"}),a(G,null,{default:e(()=>[a(U,null,{default:e(()=>[a(We,{items:y.value,isMobile:w(_),isLoading:v.value,page:C.value,itemsPerPage:x.value,sortBy:D.value,sortDesc:V.value,meta:g.value,"onUpdate:page":i,onSort:T},null,8,["items","isMobile","isLoading","page","itemsPerPage","sortBy","sortDesc","meta"]),n.value?(r(),k("div",st,A(n.value),1)):z("",!0)]),_:1})]),_:1})]),_:1})])):z("",!0)}};export{ut as default};
