import{_ as ht,ar as gt,J as P,A as _t,B as r,K as wt,aC as xt,L as U,c,s as i,w as l,a,l as f,b as w,f as B,al as h,C as p,t as d,u as V,S as H,G as q,p as k,m as N,e as y,H as I,x as G,V as S,E as kt,d as t,af as Nt,ao as L,ab as Ct,v as At,a8 as Vt,aB as St,a0 as $t,q as zt,o,am as Et,N as Ut,a2 as Dt}from"./index-DA8Oyi7H.js";import{j as Tt,k as J,l as K,p as O,f as jt,e as st,b as Bt}from"./mdi-CCqP_oQm.js";import{_ as ot}from"./StatusChip-CY_B-sI1.js";const It={key:0,class:"font-weight-medium ml-3 mb-0 d-none d-md-block"},Lt={key:1,class:"font-weight-medium ml-3 mb-0 d-block d-md-none"},Rt={key:1,class:"d-flex align-center justify-center",style:{width:"200px",height:"200px","background-color":"#f5f5f5","border-radius":"12px"}},Ft={key:0},Mt={key:0},Pt={key:1},Ht={key:0},qt={key:1},Gt={key:0},Jt={key:1},Kt={key:0},Ot={key:1},Zt={key:0},Qt={key:1},Wt={key:0},Xt={key:1},Yt={key:0},te={key:1},ee={key:0},le={key:1},se=["onClick"],oe={key:1},ne={style:{"text-align":"center","vertical-align":"middle"}},ae={style:{display:"flex","align-items":"center","justify-content":"left"}},ie=["src"],ue={key:1,style:{"font-size":"12px",color:"#888"}},de={key:1},re={class:"actions-cell"},ce={key:0},pe={key:1},ve={__name:"show",setup(fe){const D=$t(),nt=xt(),{mdAndDown:T}=gt(),n=P(null),$=P(null),R=P([]),at=_t(),Z=r(()=>at.user||{roles:[],permissions:[]}),F=r(()=>Z.value.roles||[]),z=r(()=>Z.value.permissions||[]),C=r(()=>F.value.includes("superadmin")),j=r(()=>F.value.includes("admin")),Q=r(()=>F.value.includes("sponsor")),it=r(()=>z.value.includes("businessUnit.view")),ut=r(()=>z.value.includes("businessUnit.viewAny")),dt=r(()=>z.value.includes("businessUnit.update")),rt=r(()=>C.value||j.value||Q.value||it.value),ct=r(()=>C.value||j.value||dt.value),A=r(()=>C.value||j.value||Q.value),M=r(()=>z.value.includes("user.update")),x=r(()=>z.value.includes("user.view")),pt=r(()=>x.value||M.value||A.value),vt=r(()=>(C.value||j.value)&&!T.value),E=r(()=>{var u,e;return((u=n.value)==null?void 0:u.status)==="activa"||((e=n.value)==null?void 0:e.status)==="active"}),W=()=>{var u;(u=n.value)!=null&&u.id&&D.push({path:`/ubicaciones/editar/${n.value.id}`})},ft=()=>{D.push("/ubicaciones")},bt=u=>D.push({path:`/usuarios/editar/${u.id}`}),X=u=>D.push({path:`/usuarios/${u.id}`}),Y=async()=>{var e;if(!n.value)return;const u=E.value?"inactive":"active";try{const b=await U.put(`/business-units/${n.value.id}`,{status:u});n.value.status=b.data.status||u}catch(b){alert("No se pudo cambiar el estatus"),console.error("Detalle del error:",((e=b==null?void 0:b.response)==null?void 0:e.data)||b)}},mt=async u=>{if(!A.value)return;const b=u.status==="activo"||u.status==="active"?"inactive":"active";try{const s=await U.put(`/users/${u.id}`,{status:b});u.status=s.data.status||b}catch{alert("No se pudo cambiar el estatus del usuario")}},yt=u=>{if(!u)return"No disponible";const e=[u.street,u.outdoor_number,u.neighborhood,u.city,u.postal_code,u.state,u.country].filter(Boolean);return e.length?e.join(", "):"No disponible"};return wt(async()=>{var u;try{const e=nt.params.id,b=await U.get(`/business-units/${e}`);if(n.value=b.data.business_unit||b.data.data||b.data,C.value&&((u=n.value)!=null&&u.business_id))try{const m=await U.get(`/businesses/${n.value.business_id}`);$.value=m.data.business||m.data.data||m.data}catch{$.value=null}const s=await U.get("/users"),v=Array.isArray(s.data)?s.data:s.data.users||s.data.data||[];R.value=v.filter(m=>String(m.business_unit_id)===String(n.value.id))}catch(e){console.error("Error al obtener la ubicación, empresa o usuarios:",e)}}),(u,e)=>{const b=zt("router-link");return rt.value?(o(),c(Vt,{key:0,fluid:""},{default:l(()=>[a(S,{class:"align-center mb-6","no-gutters":""},{default:l(()=>[a(w,{cols:"auto",class:"d-flex align-center"},{default:l(()=>[ut.value?(o(),i(V,{key:0},[a(B,{icon:"",variant:"text",class:"px-3 py-2",style:{"border-radius":"8px",border:"1px solid #ccc","min-width":"44px",height:"44px"},onClick:ft},{default:l(()=>[a(h,{icon:p(Tt)},null,8,["icon"])]),_:1}),n.value?(o(),i("h3",It,d(n.value.folio?`${n.value.folio}`:"")+" "+d(n.value.legal_name?`- ${n.value.legal_name}`:"- Ubicación"),1)):f("",!0),n.value?(o(),i("h3",Lt,d(n.value.folio?`${n.value.folio}`:""),1)):f("",!0)],64)):f("",!0)]),_:1}),a(w,{class:"d-flex justify-end align-center"},{default:l(()=>[ct.value?(o(),i(V,{key:0},[p(T)?(o(),c(H,{key:1,location:"bottom end"},{activator:l(({props:s})=>[a(B,G(s,{icon:"",variant:"text",class:"pa-0","min-width":"0",height:"44",style:{"border-radius":"8px",border:"1px solid #ccc","min-width":"44px"}}),{default:l(()=>[a(h,{icon:p(st),size:"24"},null,8,["icon"])]),_:2},1040)]),default:l(()=>[a(q,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"180px"}},{default:l(()=>[a(k,{onClick:W},{prepend:l(()=>[a(h,{icon:p(J),size:"16"},null,8,["icon"])]),default:l(()=>[a(N,null,{default:l(()=>e[3]||(e[3]=[y("Editar")])),_:1})]),_:1}),A.value?(o(),i(V,{key:0},[a(I,{class:"my-1"}),a(k,{onClick:Y},{prepend:l(()=>[a(h,{icon:E.value?p(K):p(O),size:"16"},null,8,["icon"])]),default:l(()=>[a(N,null,{default:l(()=>[y(d(E.value?"Desactivar":"Activar"),1)]),_:1})]),_:1})],64)):f("",!0)]),_:1})]),_:1})):(o(),c(H,{key:0,location:"bottom end"},{activator:l(({props:s})=>[a(B,G(s,{variant:"text",class:"px-3 py-2",style:{"border-radius":"8px",border:"1px solid #ccc","min-width":"44px",height:"44px"}}),{default:l(()=>[e[1]||(e[1]=y(" Opciones ")),a(h,{icon:p(jt),end:"",size:"18"},null,8,["icon"])]),_:2},1040)]),default:l(()=>[a(q,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:l(()=>[a(k,{onClick:W},{prepend:l(()=>[a(h,{icon:p(J),size:"16"},null,8,["icon"])]),default:l(()=>[a(N,null,{default:l(()=>e[2]||(e[2]=[y("Editar")])),_:1})]),_:1}),A.value?(o(),i(V,{key:0},[a(I,{class:"my-1"}),a(k,{onClick:Y},{prepend:l(()=>[a(h,{icon:E.value?p(K):p(O),size:"16"},null,8,["icon"])]),default:l(()=>[a(N,null,{default:l(()=>[y(d(E.value?"Desactivar":"Activar"),1)]),_:1})]),_:1})],64)):f("",!0)]),_:1})]),_:1}))],64)):f("",!0)]),_:1})]),_:1}),a(S,null,{default:l(()=>[a(w,{cols:"12",md:"4",class:"d-flex justify-center align-center"},{default:l(()=>{var s;return[(s=n.value)!=null&&s.logo?(o(),c(kt,{key:0,src:n.value.logo,"max-width":"320","max-height":"320",class:"rounded-lg",alt:"Logo",style:{background:"none"}},null,8,["src"])):(o(),i("div",Rt,e[4]||(e[4]=[t("span",{class:"text-medium-emphasis"},"Sin logo",-1)])))]}),_:1}),a(w,{cols:"12",md:"8"},{default:l(()=>[a(Nt,{class:"font-weight-bold text-h6",style:{"padding-left":"0.5rem"}},{default:l(()=>e[5]||(e[5]=[y("Información general")])),_:1}),a(L,{class:"rounded-lg elevation-1"},{default:l(()=>{var s,v,m,g,_,tt,et,lt;return[t("tbody",null,[t("tr",null,[e[6]||(e[6]=t("td",{class:"font-weight-bold text-subtitle-1"},"Estado",-1)),t("td",null,[(s=n.value)!=null&&s.status?(o(),c(ot,{key:0,status:n.value.status},null,8,["status"])):(o(),i(V,{key:1},[y(" No disponible ")],64))])]),t("tr",null,[e[7]||(e[7]=t("td",{class:"font-weight-bold text-subtitle-1"},"Folio",-1)),t("td",null,d(((v=n.value)==null?void 0:v.folio)||"No disponible"),1)]),C.value&&$.value?(o(),i("tr",Ft,[e[8]||(e[8]=t("td",{class:"font-weight-bold text-subtitle-1"},"Empresa",-1)),t("td",null,[(m=$.value)!=null&&m.legal_name?(o(),i("span",Mt,d($.value.legal_name),1)):(o(),i("span",Pt,"No disponible"))])])):f("",!0),t("tr",null,[e[9]||(e[9]=t("td",{class:"font-weight-bold text-subtitle-1"},"Nombre legal",-1)),t("td",null,d(((g=n.value)==null?void 0:g.legal_name)||"No disponible"),1)]),t("tr",null,[e[10]||(e[10]=t("td",{class:"font-weight-bold text-subtitle-1"},"Alias",-1)),t("td",null,d(((_=n.value)==null?void 0:_.alias)||"No disponible"),1)]),t("tr",null,[e[11]||(e[11]=t("td",{class:"font-weight-bold text-subtitle-1"},"Descripción",-1)),t("td",null,d(((tt=n.value)==null?void 0:tt.description)||"No disponible"),1)]),t("tr",null,[e[12]||(e[12]=t("td",{class:"font-weight-bold text-subtitle-1"},"Zona horaria",-1)),t("td",null,d(((et=n.value)==null?void 0:et.timezone)||"No disponible"),1)]),t("tr",null,[e[13]||(e[13]=t("td",{class:"font-weight-bold text-subtitle-1"},"Dirección",-1)),t("td",null,[(lt=n.value)!=null&&lt.address?(o(),i("span",Ht,d(yt(n.value.address)),1)):(o(),i("span",qt,"No disponible"))])])])]}),_:1})]),_:1})]),_:1}),p(T)?(o(),c(S,{key:0},{default:l(()=>[a(w,{cols:"12"},{default:l(()=>e[14]||(e[14]=[t("div",{style:{height:"24px"}},null,-1)])),_:1})]),_:1})):f("",!0),a(S,null,{default:l(()=>[a(w,{cols:"12"},{default:l(()=>[e[23]||(e[23]=t("div",{class:"font-weight-bold text-h6 mb-2",style:{"padding-left":"0.5rem"}},"Contacto",-1)),p(T)?(o(),c(Ct,{key:0,class:"rounded-lg elevation-1 pa-0"},{default:l(()=>[a(L,{class:"rounded-lg elevation-0",style:{border:"none"}},{default:l(()=>{var s,v,m,g,_;return[t("tbody",null,[t("tr",null,[e[15]||(e[15]=t("td",{class:"font-weight-bold text-subtitle-1",style:{width:"40%"}},"Nombre",-1)),t("td",null,[(s=n.value)!=null&&s.person&&(n.value.person.first_name||n.value.person.last_name)?(o(),i("span",Gt,d([n.value.person.first_name,n.value.person.last_name].filter(Boolean).join(" ")),1)):(o(),i("span",Jt,"No disponible"))])]),t("tr",null,[e[16]||(e[16]=t("td",{class:"font-weight-bold text-subtitle-1"},"Correo",-1)),t("td",null,[(m=(v=n.value)==null?void 0:v.person)!=null&&m.email?(o(),i("span",Kt,d(n.value.person.email),1)):(o(),i("span",Ot,"No disponible"))])]),t("tr",null,[e[17]||(e[17]=t("td",{class:"font-weight-bold text-subtitle-1"},"Teléfono",-1)),t("td",null,[(_=(g=n.value)==null?void 0:g.person)!=null&&_.phone_number?(o(),i("span",Zt,d(n.value.person.phone_number),1)):(o(),i("span",Qt,"No disponible"))])])])]}),_:1})]),_:1})):(o(),c(L,{key:1,class:"rounded-lg elevation-1"},{default:l(()=>{var s,v,m,g,_;return[e[22]||(e[22]=t("thead",null,[t("tr",null,[t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"15%"}},"Nombre"),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"5%"}}),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"20%"}},"Correo"),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"25%"}},"Teléfono"),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"15%"}}),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"10%"}}),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"10%"}})])],-1)),t("tbody",null,[t("tr",null,[t("td",null,[(s=n.value)!=null&&s.person&&(n.value.person.first_name||n.value.person.last_name)?(o(),i("span",Wt,d([n.value.person.first_name,n.value.person.last_name].filter(Boolean).join(" ")),1)):(o(),i("span",Xt,"No disponible"))]),e[18]||(e[18]=t("td",null,null,-1)),t("td",null,[(m=(v=n.value)==null?void 0:v.person)!=null&&m.email?(o(),i("span",Yt,d(n.value.person.email),1)):(o(),i("span",te,"No disponible"))]),t("td",null,[(_=(g=n.value)==null?void 0:g.person)!=null&&_.phone_number?(o(),i("span",ee,d(n.value.person.phone_number),1)):(o(),i("span",le,"No disponible"))]),e[19]||(e[19]=t("td",null,null,-1)),e[20]||(e[20]=t("td",null,null,-1)),e[21]||(e[21]=t("td",null,null,-1))])])]}),_:1}))]),_:1})]),_:1}),a(S,null,{default:l(()=>[a(w,{cols:"12"},{default:l(()=>e[24]||(e[24]=[t("div",{style:{height:"32px"}},null,-1)])),_:1})]),_:1}),vt.value?(o(),c(S,{key:1},{default:l(()=>[a(w,{cols:"12"},{default:l(()=>[e[29]||(e[29]=t("div",{class:"font-weight-bold text-h6 mb-2",style:{"padding-left":"0.5rem"}},"Usuarios",-1)),a(L,{class:"rounded-lg elevation-1 fixed-table"},{default:l(()=>[e[28]||(e[28]=t("thead",null,[t("tr",null,[t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"10%"}},"ID"),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"10%"}},"Foto"),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"20%"}},"Nombre"),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"25%"}},"Correo"),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"15%"}},"Rol"),t("th",{class:"font-weight-bold text-subtitle-1",style:{width:"10%"}},"Estatus"),t("th",{class:"font-weight-bold text-subtitle-1 actions-header",style:{width:"10%"}})])],-1)),t("tbody",null,[(o(!0),i(V,null,At(R.value,s=>(o(),i("tr",{key:s.id,class:Ut(["row-clickable",{"cursor-pointer":x.value}]),onClick:v=>x.value?X(s):void 0,style:Et({cursor:x.value?"pointer":"default"})},[t("td",null,[x.value?(o(),c(b,{key:0,to:`/usuarios/${s.id}`,style:{"text-decoration":"underline",color:"#1976d2 !important"},onClick:e[0]||(e[0]=Dt(()=>{},["stop"]))},{default:l(()=>[y(d(s.id),1)]),_:2},1032,["to"])):(o(),i("span",oe,d(s.id),1))]),t("td",ne,[t("div",ae,[s.profile_picture?(o(),i("img",{key:0,src:s.profile_picture,alt:"Foto de perfil",style:{width:"32px",height:"32px","border-radius":"50%","object-fit":"cover",background:"#f5f5f5"}},null,8,ie)):(o(),i("span",ue,"Sin foto"))])]),t("td",null,[t("span",null,d(s.name||[s.first_name,s.last_name].filter(Boolean).join(" ")||"No disponible"),1)]),t("td",null,d(s.email||"No disponible"),1),t("td",null,d(Array.isArray(s.roles)&&s.roles.length?typeof s.roles[0]=="object"?s.roles[0].name==="superadmin"?"Super Administrador":s.roles[0].name==="admin"?"Administrador":s.roles[0].name==="sponsor"?"Sponsor":s.roles[0].name||"No disponible":s.roles[0]==="superadmin"?"Super Administrador":s.roles[0]==="admin"?"Administrador":s.roles[0]==="sponsor"?"Sponsor":s.roles[0]||"No disponible":"No disponible"),1),t("td",null,[s.status?(o(),c(ot,{key:0,status:s.status},null,8,["status"])):(o(),i("span",de,"No disponible"))]),t("td",re,[pt.value?(o(),c(H,{key:0,location:"bottom end"},{activator:l(({props:v})=>[a(B,G({ref_for:!0},v,{variant:"text",class:"pa-0","min-width":"0",height:"24"}),{default:l(()=>[a(h,{icon:p(st),size:"20"},null,8,["icon"])]),_:2},1040)]),default:l(()=>[a(q,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:l(()=>[x.value?(o(),c(k,{key:0,onClick:v=>X(s)},{prepend:l(()=>[a(h,{icon:p(Bt),size:"18"},null,8,["icon"])]),default:l(()=>[a(N,null,{default:l(()=>e[25]||(e[25]=[y("Ver")])),_:1})]),_:2},1032,["onClick"])):f("",!0),M.value&&x.value?(o(),c(I,{key:1,class:"my-1"})):f("",!0),M.value?(o(),c(k,{key:2,onClick:v=>bt(s)},{prepend:l(()=>[a(h,{icon:p(J),size:"18"},null,8,["icon"])]),default:l(()=>[a(N,null,{default:l(()=>e[26]||(e[26]=[y("Editar")])),_:1})]),_:2},1032,["onClick"])):f("",!0),A.value?(o(),c(I,{key:3,class:"my-1"})):f("",!0),A.value?(o(),c(k,{key:4,onClick:v=>mt(s)},{prepend:l(()=>[a(h,{icon:s.status==="activo"||s.status==="active"?p(K):p(O),size:"18"},null,8,["icon"])]),default:l(()=>[a(N,null,{default:l(()=>[y(d(s.status==="activo"||s.status==="active"?"Desactivar":"Activar"),1)]),_:2},1024)]),_:2},1032,["onClick"])):f("",!0)]),_:2},1024)]),_:2},1024)):f("",!0)])],14,se))),128)),R.value.length===0?(o(),i("tr",ce,e[27]||(e[27]=[t("td",{colspan:"7",class:"text-center text-medium-emphasis"},"No hay usuarios relacionados.",-1)]))):f("",!0)])]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})):(o(),i("div",pe,[a(St,{type:"error",class:"mt-10",variant:"outlined",density:"comfortable"},{default:l(()=>e[30]||(e[30]=[y(" No tienes acceso a esta ubicación. ")])),_:1})]))}}},he=ht(ve,[["__scopeId","data-v-3aba6b25"]]);export{he as default};
