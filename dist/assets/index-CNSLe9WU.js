import{s as p,o,a as t,d as r,w as s,e as V,ac as q,ao as Fe,ap as Pe,_ as Ee,Z as _e,A as ke,B as f,J as m,q as Ie,aq as Me,u as K,l as C,c as D,aj as L,v as ue,V as ye,b as re,a0 as ve,t as F,ak as Ce,a9 as Ae,L as Te,Q as we,G as Oe,p as me,m as pe,C as B,H as Ve,f as W,x as be,am as X,ar as Be,ag as le,as as He,R as fe,ad as Ne,ae as je,at as Re,b5 as ge,b3 as he,au as qe,al as Ke,an as Ge,a6 as Je}from"./index-BtdFDd_C.js";import{b as Qe,k as Ze,l as We,p as Xe,e as Ye,f as et,g as tt,i as $e}from"./mdi-CCqP_oQm.js";import{_ as Se}from"./StatusChip-DyVs1_p3.js";/* empty css                */const lt={class:"d-flex justify-center mt-4"},at={__name:"UserTableMeta",props:{items:{type:Array,default:()=>[]},page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean},emits:["update:page","sort"],setup(M,{emit:N}){const $=M,x=N;return(b,i)=>{var k;return o(),p("div",null,[t(Fe,{density:"comfortable",class:"fixed-table elevation-1 rounded-lg"},{default:s(()=>[r("thead",null,[r("tr",null,[r("th",{onClick:i[0]||(i[0]=y=>x("sort","id")),class:"cursor-pointer id-header"},[i[7]||(i[7]=V(" Identificador ")),q(b.$slots,"sort-icon",{column:"id"})]),r("th",{onClick:i[1]||(i[1]=y=>x("sort","name")),class:"cursor-pointer name-header"},[i[8]||(i[8]=V(" Nombre ")),q(b.$slots,"sort-icon",{column:"name"})]),r("th",{onClick:i[2]||(i[2]=y=>x("sort","email")),class:"cursor-pointer email-header"},[i[9]||(i[9]=V(" Correo ")),q(b.$slots,"sort-icon",{column:"email"})]),r("th",{onClick:i[3]||(i[3]=y=>x("sort","role")),class:"cursor-pointer role-header"},[i[10]||(i[10]=V(" Rol ")),q(b.$slots,"sort-icon",{column:"role"})]),r("th",{onClick:i[4]||(i[4]=y=>x("sort","status")),class:"cursor-pointer status-header"},[i[11]||(i[11]=V(" Estatus ")),q(b.$slots,"sort-icon",{column:"status"})]),i[12]||(i[12]=r("th",{class:"actions-header"},null,-1))])]),r("tbody",null,[q(b.$slots,"rows")])]),_:3}),r("div",lt,[t(Pe,{modelValue:$.page,"onUpdate:modelValue":[i[5]||(i[5]=y=>$.page=y),i[6]||(i[6]=y=>x("update:page",y))],length:Math.ceil((((k=$.items)==null?void 0:k.length)||1)/$.itemsPerPage),"total-visible":"7",color:"primary"},null,8,["modelValue","length"])])])}}},st={key:0,class:"text-center py-8"},nt={key:0,class:"text-center py-8"},it={key:1,class:"mb-4 d-flex justify-end"},ot={class:"d-flex align-center mb-1",style:{"justify-content":"space-between"}},ut={class:"text-caption",style:{"margin-right":"8px"}},rt={class:"font-weight-medium mb-1"},dt={class:"text-caption"},ct={class:"text-caption"},vt={key:0},mt={key:0},pt={key:1},ft=["onClick"],gt={class:"id-cell"},yt={class:"name-cell"},wt={class:"email-cell"},bt={class:"role-cell"},kt={key:0},xt={key:0},Ct={key:1},Vt={class:"status-cell"},ht={__name:"UserList",props:{items:Array,isMobile:Boolean,isLoading:Boolean},setup(M){const N=M,$=_e(),x=ke(),b=f(()=>x.user||{roles:[],permissions:[]}),i=f(()=>b.value.roles||[]),k=f(()=>b.value.permissions||[]),y=f(()=>i.value.includes("superadmin")),_=f(()=>i.value.includes("admin")),P=f(()=>i.value.includes("sponsor")),S=f(()=>k.value.includes("user.update")),A=f(()=>k.value.includes("user.view")),Y=f(()=>k.value.includes("user.create")),G=f(()=>A.value||S.value||d.value),j=f(()=>(N.items||[]).filter(c=>c.roles&&c.roles.some(h=>h.name==="superadmin")?y.value:!0)),E=c=>{if(!S.value||!c||!c.id||c.id===b.value.id)return!1;const u=(c.roles||[]).map(h=>h.name);return y.value?!0:_.value?!u.includes("superadmin"):P.value?!(u.includes("superadmin")||u.includes("admin")):!1},d=f(()=>(y.value||_.value||P.value)&&S.value),n=m("id"),w=m(!1),ee=m(1),te=m(10),T=c=>{n.value===c?w.value=!w.value:(n.value=c,w.value=!1)},I=f(()=>[...j.value].sort((c,u)=>{var g,U,Q,Z,ae,H;let h,a;return n.value==="role"?(h=(((U=(g=c.roles)==null?void 0:g[0])==null?void 0:U.name)||"").toLowerCase(),a=(((Z=(Q=u.roles)==null?void 0:Q[0])==null?void 0:Z.name)||"").toLowerCase()):n.value==="status"?(h=(c.status||"").toLowerCase(),a=(u.status||"").toLowerCase()):(h=((ae=c[n.value])==null?void 0:ae.toString().toLowerCase())??"",a=((H=u[n.value])==null?void 0:H.toString().toLowerCase())??""),h.localeCompare(a)*(w.value?-1:1)})),z=f(()=>{const c=(ee.value-1)*te.value;return I.value.slice(c,c+te.value)}),R=c=>$.push({path:`/usuarios/editar/${c.id}`}),O=c=>$.push({path:`/usuarios/${c.id}`}),J=async c=>{if(!E(c))return;const h=c.status==="activa"||c.status==="active"?"inactive":"active";try{const a=await X.put(`/users/${c.id}/status`,{status:h});c.status=a.data.user.status||h}catch{alert("No se pudo cambiar el estatus")}};return(c,u)=>{const h=Ie("router-link");return o(),p("div",null,[M.isLoading?(o(),p("div",st,[t(Me,{indeterminate:"",color:"primary",size:"64"}),u[4]||(u[4]=r("p",{class:"mt-4"},"Cargando usuarios...",-1))])):(o(),p(K,{key:1},[z.value.length?C("",!0):(o(),p("div",nt,[t(L,{size:"64",color:"grey lighten-1"},{default:s(()=>u[5]||(u[5]=[V("mdi-domain-off")])),_:1}),u[6]||(u[6]=r("p",{class:"mt-4 text-h6 text-grey-darken-1"},"No existen usuarios",-1)),u[7]||(u[7]=r("p",{class:"text-body-2 text-grey"},"No se encontraron usuarios con los filtros aplicados",-1))])),Y.value?(o(),p("div",it,[q(c.$slots,"add-btn",{},void 0,!0)])):M.isMobile?(o(!0),p(K,{key:2},ue(z.value,a=>(o(),D(Ae,{key:a.id,class:"mb-4 pa-3 elevation-1 rounded-lg row-clickable",onClick:g=>A.value?O(a):void 0,style:Ce({cursor:A.value?"pointer":"default"})},{default:s(()=>[t(ye,{"no-gutters":"",align:"center",class:"mb-1"},{default:s(()=>[t(re,{cols:"12"},{default:s(()=>[r("div",ot,[r("div",ut,[t(h,{to:`/usuarios/${a.id}`,onClick:u[0]||(u[0]=ve(()=>{},["stop"])),class:"blue--text text--darken-2",style:{"text-decoration":"underline",color:"#1976d2 !important"}},{default:s(()=>[V(F(a.id),1)]),_:2},1032,["to"])]),t(Se,{status:a.status},null,8,["status"])]),r("div",rt,F(a.name),1),r("div",dt,[u[8]||(u[8]=r("strong",null,"Correo:",-1)),V(" "+F(a.email),1)]),r("div",ct,[u[9]||(u[9]=r("strong",null,"Rol:",-1)),a.roles&&a.roles.length?(o(),p("span",vt,[(o(!0),p(K,null,ue(a.roles,(g,U)=>(o(),p("span",{key:g.id},[V(F(g.name==="superadmin"?"Super Administrador":g.name==="admin"?"Administrador":g.name==="sponsor"?"Sponsor":g.name),1),U<a.roles.length-1?(o(),p("span",mt,", ")):C("",!0)]))),128))])):(o(),p("span",pt,"Sin rol"))])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128)):C("",!0),M.isMobile?C("",!0):(o(),D(at,{key:3,items:I.value.value,page:ee.value,itemsPerPage:te.value,sortBy:n.value,sortDesc:w.value,"onUpdate:page":u[3]||(u[3]=a=>ee.value=a),onSort:T},{"sort-icon":s(({column:a})=>[n.value===a?(o(),D(L,{key:0,size:"16",class:"ml-1"},{default:s(()=>[V(F(w.value?B(et):B(tt)),1)]),_:1})):C("",!0)]),rows:s(()=>[z.value.length?(o(!0),p(K,{key:0},ue(z.value,a=>(o(),p("tr",{key:a.id,onClick:g=>A.value?O(a):void 0,class:Te(["row-clickable",{"row-disabled":!A.value}]),style:Ce({cursor:A.value?"pointer":"default"})},[r("td",gt,[t(h,{to:`/usuarios/${a.id}`,onClick:u[1]||(u[1]=ve(()=>{},["stop"])),class:"blue--text text--darken-2",style:{"text-decoration":"underline",color:"#1976d2 !important"}},{default:s(()=>[V(F(a.id),1)]),_:2},1032,["to"])]),r("td",yt,F(a.name),1),r("td",wt,F(a.email),1),r("td",bt,[a.roles&&a.roles.length?(o(),p("span",kt,[(o(!0),p(K,null,ue(a.roles,(g,U)=>(o(),p("span",{key:g.id},[V(F(g.name==="superadmin"?"Super Administrador":g.name==="admin"?"Administrador":g.name==="sponsor"?"Sponsor":g.name),1),U<a.roles.length-1?(o(),p("span",xt,", ")):C("",!0)]))),128))])):(o(),p("span",Ct,"Sin rol"))]),r("td",Vt,[t(Se,{status:a.status},null,8,["status"])]),r("td",{class:"actions-cell",onClick:u[2]||(u[2]=ve(()=>{},["stop"]))},[G.value?(o(),D(we,{key:0,location:"bottom end"},{activator:s(({props:g})=>[t(W,be({ref_for:!0},g,{variant:"text",class:"pa-0","min-width":"0",height:"24"}),{default:s(()=>[t(L,{icon:B(Ye),size:"20"},null,8,["icon"])]),_:2},1040)]),default:s(()=>[t(Oe,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:s(()=>[A.value?(o(),D(me,{key:0,onClick:g=>O(a)},{prepend:s(()=>[t(L,{icon:B(Qe),size:"18"},null,8,["icon"])]),default:s(()=>[t(pe,null,{default:s(()=>u[10]||(u[10]=[V("Ver")])),_:1})]),_:2},1032,["onClick"])):C("",!0),S.value&&A.value?(o(),D(Ve,{key:1,class:"my-1"})):C("",!0),S.value?(o(),D(me,{key:2,onClick:g=>R(a)},{prepend:s(()=>[t(L,{icon:B(Ze),size:"18"},null,8,["icon"])]),default:s(()=>[t(pe,null,{default:s(()=>u[11]||(u[11]=[V("Editar")])),_:1})]),_:2},1032,["onClick"])):C("",!0),S.value&&d.value&&E(a)?(o(),D(Ve,{key:3,class:"my-1"})):C("",!0),S.value&&d.value&&E(a)?(o(),D(me,{key:4,onClick:g=>J(a)},{prepend:s(()=>[t(L,{icon:a.status==="activa"||a.status==="active"?B(We):B(Xe),size:"18"},null,8,["icon"])]),default:s(()=>[t(pe,null,{default:s(()=>[V(F(a.status==="activa"||a.status==="active"?"Desactivar":"Activar"),1)]),_:2},1024)]),_:2},1032,["onClick"])):C("",!0)]),_:2},1024)]),_:2},1024)):C("",!0)])],14,ft))),128)):C("",!0)]),_:1},8,["items","page","itemsPerPage","sortBy","sortDesc"]))],64))])}}},$t=Ee(ht,[["__scopeId","data-v-d4754c45"]]),St={class:"d-flex align-center mb-6",style:{gap:"16px"}},_t={class:"filter-btn-wrapper ml-2 flex-shrink-0",style:{"min-width":"44px",position:"relative"}},At={key:1,class:"filter-btn-content"},Bt={key:0,class:"filter-indicator"},Lt={key:0,class:"mb-3"},zt={key:1,class:"mb-3"},Ut={key:2,class:"mb-3"},Dt={class:"mb-3"},Ft={__name:"UserFilters",emits:["search","filter"],setup(M,{emit:N}){const $=N,x=m(""),b=m(!1),i=m(null),k=[{title:"Activo",value:"active"},{title:"Inactivo",value:"inactive"}],y=m(null),_=m(null),P=m(!1),S=m(!1),{mdAndDown:A}=Be(),Y=ke(),G=f(()=>Y.user||{roles:[],permissions:[]}),j=f(()=>G.value.roles||[]),E=f(()=>G.value.permissions||[]),d=f(()=>j.value.includes("superadmin")),n=f(()=>j.value.includes("admin")),w=f(()=>j.value.includes("sponsor"));f(()=>E.value.includes("user.viewAny"));const ee=f(()=>E.value.includes("business.viewAny")),te=f(()=>E.value.includes("businessUnit.viewAny")),T=f(()=>d.value),I=f(()=>d.value||n.value||ee.value),z=f(()=>d.value||n.value||w.value||te.value),R=m(null),O=m([]),J=m(""),c=m(!1),u=async v=>{c.value=!0;try{const{data:e}=await X.get("/organizations",{params:{q:v||"",limit:10}});O.value=(e.data||[]).map(l=>({...l,display:`${l.folio}${l.legal_name?" - "+l.legal_name:""}`}))}catch{O.value=[]}finally{c.value=!1}};function h(v,e,l){return e?(v.folio+" "+(v.legal_name||"")).toLowerCase().includes(e.toLowerCase()):!0}const a=m(null),g=m([]),U=m(""),Q=m(!1),Z=async v=>{Q.value=!0;try{const{data:e}=await X.get("/businesses",{params:{q:v||"",limit:10}});g.value=(e.data||[]).map(l=>({...l,display:`${l.folio}${l.legal_name?" - "+l.legal_name:""}`}))}catch{g.value=[]}finally{Q.value=!1}};function ae(v,e,l){return e?(v.folio+" "+(v.legal_name||"")).toLowerCase().includes(e.toLowerCase()):!0}const H=m(null),se=m([]),ne=m(""),de=m(!1),ce=async v=>{de.value=!0;try{const{data:e}=await X.get("/business-units",{params:{q:v||"",limit:10}});se.value=(e.data||[]).map(l=>({...l,display:`${l.folio}${l.legal_name?" - "+l.legal_name:""}`}))}catch{se.value=[]}finally{de.value=!1}};function Le(v,e,l){return e?(v.folio+" "+(v.legal_name||"")).toLowerCase().includes(e.toLowerCase()):!0}le(b,v=>{v&&T.value&&O.value.length===0&&u(""),v&&I.value&&g.value.length===0&&Z(""),v&&z.value&&se.value.length===0&&ce("")}),le(J,v=>{T.value&&u(v)}),le(U,v=>{I.value&&Z(v)}),le(ne,v=>{z.value&&ce(v)}),le(x,v=>{$("search",v)});const ze=f(()=>!!i.value||!!y.value||!!_.value||T.value&&!!R.value||I.value&&!!a.value||z.value&&!!H.value);function xe(){$("search",x.value)}function ie(v){return v?typeof v=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(v)?v:new Date(v).toISOString().slice(0,10):null}function Ue(){$("filter",{organization_id:T.value?R.value:null,business_id:I.value?a.value:null,business_unit_id:z.value?H.value:null,status:i.value,createdAtStart:ie(y.value),createdAtEnd:ie(_.value)}),b.value=!1}function De(){i.value=null,y.value=null,_.value=null,T.value&&(R.value=null,J.value=""),I.value&&(a.value=null,U.value=""),z.value&&(H.value=null,ne.value=""),$("filter",{organization_id:null,business_id:null,business_unit_id:null,status:null,createdAtStart:null,createdAtEnd:null})}return(v,e)=>(o(),p("div",St,[t(fe,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l),placeholder:"Buscar por identificador, nombre, correo o rol...","prepend-inner-icon":"mdi-magnify",clearable:"",class:"flex-grow-1 search-bar",density:"compact",variant:"outlined",color:"primary","hide-details":"",style:{"min-width":"220px"},onKeyup:He(xe,["enter"]),"onClick:clear":xe},null,8,["modelValue"]),r("div",_t,[t(W,{icon:B(A),variant:"text",class:"filter-btn filter-btn-center",style:{"border-radius":"8px",border:"1px solid #ccc","min-width":"44px",height:"44px",width:"100%"},color:"#222",onClick:e[1]||(e[1]=l=>b.value=!0)},{default:s(()=>[B(A)?(o(),D(L,{key:0},{default:s(()=>e[19]||(e[19]=[r("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[r("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1})):(o(),p("span",At,[t(L,{class:"mr-2"},{default:s(()=>e[20]||(e[20]=[r("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[r("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1}),e[22]||(e[22]=r("span",null,"Filtros",-1)),t(L,{class:"ml-2",end:""},{default:s(()=>e[21]||(e[21]=[V("mdi-filter-variant")])),_:1})]))]),_:1},8,["icon"]),ze.value?(o(),p("span",Bt)):C("",!0)]),t(Ke,{modelValue:b.value,"onUpdate:modelValue":e[18]||(e[18]=l=>b.value=l),"max-width":"420"},{default:s(()=>[t(Ae,{class:"modal-padding",style:{position:"relative"}},{default:s(()=>[t(W,{icon:"",variant:"text",class:"position-absolute close-btn",style:{top:"10px",right:"10px",color:"#222","z-index":"10"},onClick:e[2]||(e[2]=l=>b.value=!1)},{default:s(()=>[t(L,null,{default:s(()=>e[23]||(e[23]=[r("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[r("path",{fill:"currentColor",d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),_:1})]),_:1}),t(Ne,{class:"font-weight-bold"},{default:s(()=>e[24]||(e[24]=[V("Filtros avanzados")])),_:1}),t(je,{class:"pb-0"},{default:s(()=>[t(Re,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value=l),items:k,label:"Estado",clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"mb-3 filter-padding",style:{"padding-top":"0px","padding-bottom":"0px"}},null,8,["modelValue"]),T.value?(o(),p("div",Lt,[t(ge,{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=l=>R.value=l),items:O.value,loading:c.value,"search-input":J.value,"onUpdate:searchInput":[e[5]||(e[5]=l=>J.value=l),u],"item-title":"display","item-value":"id",label:"Buscar organización (folio o nombre legal)",clearable:"","hide-details":"",variant:"outlined",color:"primary",density:"compact",filter:h,"menu-props":{maxHeight:"300px"}},null,8,["modelValue","items","loading","search-input"])])):C("",!0),I.value?(o(),p("div",zt,[t(ge,{modelValue:a.value,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value=l),items:g.value,loading:Q.value,"search-input":U.value,"onUpdate:searchInput":[e[7]||(e[7]=l=>U.value=l),Z],"item-title":"display","item-value":"id",label:"Buscar empresa (folio o nombre legal)",clearable:"","hide-details":"",variant:"outlined",color:"primary",density:"compact",filter:ae,"menu-props":{maxHeight:"300px"}},null,8,["modelValue","items","loading","search-input"])])):C("",!0),z.value?(o(),p("div",Ut,[t(ge,{modelValue:H.value,"onUpdate:modelValue":e[8]||(e[8]=l=>H.value=l),items:se.value,loading:de.value,"search-input":ne.value,"onUpdate:searchInput":[e[9]||(e[9]=l=>ne.value=l),ce],"item-title":"display","item-value":"id",label:"Buscar ubicación (folio o nombre legal)",clearable:"","hide-details":"",variant:"outlined",color:"primary",density:"compact",filter:Le,"menu-props":{maxHeight:"300px"}},null,8,["modelValue","items","loading","search-input"])])):C("",!0),r("div",Dt,[t(we,{modelValue:P.value,"onUpdate:modelValue":e[13]||(e[13]=l=>P.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:s(({props:l})=>[t(fe,be({"model-value":ie(y.value),label:"Creado desde",readonly:""},l,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field mb-2","onClick:clear":e[10]||(e[10]=oe=>y.value=null)}),null,16,["model-value"])]),default:s(()=>[t(he,{modelValue:y.value,"onUpdate:modelValue":[e[11]||(e[11]=l=>y.value=l),e[12]||(e[12]=l=>P.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(we,{modelValue:S.value,"onUpdate:modelValue":e[17]||(e[17]=l=>S.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:s(({props:l})=>[t(fe,be({"model-value":ie(_.value),label:"Creado hasta",readonly:""},l,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field","onClick:clear":e[14]||(e[14]=oe=>_.value=null)}),null,16,["model-value"])]),default:s(()=>[t(he,{modelValue:_.value,"onUpdate:modelValue":[e[15]||(e[15]=l=>_.value=l),e[16]||(e[16]=l=>S.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])])]),_:1}),t(qe,{class:"d-flex flex-column align-end pt-2",style:{gap:"8px"}},{default:s(()=>[t(W,{style:{"background-color":"#1677ff",color:"white","font-weight":"500","font-size":"14px",width:"100%","text-transform":"none"},onClick:Ue},{default:s(()=>e[25]||(e[25]=[V(" Aplicar ")])),_:1}),t(W,{variant:"text",style:{width:"100%",color:"#555","font-weight":"500","font-size":"13px","text-transform":"none"},onClick:De},{default:s(()=>e[26]||(e[26]=[V(" Limpiar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Pt={key:0},Ot={__name:"index",setup(M){const N=_e(),$=m([]),x=m([]),{mdAndDown:b}=Be(),i=m(""),k=m({}),y=ke(),_=m(!1),P=m(!1),S=m(!1);function A(d){var n;return Array.isArray((n=y.user)==null?void 0:n.permissions)&&y.user.permissions.includes(d)}Ge(async()=>{if(!A("user.viewAny")){_.value=!1;return}_.value=!0,P.value=A("user.create");try{S.value=!0;const{data:d}=await X.get("/users");$.value=d.data,x.value=d.data}catch(d){console.error("Error fetching users:",d)}finally{S.value=!1}});const Y=()=>{N.push("/usuarios/crear")};function G(d){i.value=d,E()}async function j(d){k.value=d;try{const{data:n}=await X.get("/users",{params:d});x.value=n.data}catch(n){console.error("Error fetching filtered users:",n),x.value=[]}}function E(){let d=$.value;if(i.value){const n=i.value.toLowerCase();d=d.filter(w=>w.name&&w.name.toLowerCase().includes(n)||w.email&&w.email.toLowerCase().includes(n)||w.username&&w.username.toLowerCase().includes(n)||w.id&&String(w.id).toLowerCase().includes(n)||w.roles&&w.roles.length&&(w.roles[0].name&&w.roles[0].name.toLowerCase().includes(n)||w.roles[0].description&&w.roles[0].description.toLowerCase().includes(n)))}k.value.status&&(d=d.filter(n=>n.status===k.value.status)),k.value.organization_id&&(d=d.filter(n=>n.organization_id==k.value.organization_id)),k.value.business_id&&(d=d.filter(n=>n.business_id==k.value.business_id)),k.value.createdAtStart&&(d=d.filter(n=>n.created_at&&n.created_at>=k.value.createdAtStart)),k.value.createdAtEnd&&(d=d.filter(n=>n.created_at&&n.created_at<=k.value.createdAtEnd)),x.value=d}return(d,n)=>_.value?(o(),p("div",Pt,[t(Je,{fluid:""},{default:s(()=>[t(ye,{class:"align-center justify-space-between mb-4"},{default:s(()=>[t(re,{cols:"auto",class:"d-flex align-center"},{default:s(()=>n[0]||(n[0]=[r("h3",{class:"font-weight-medium mb-0"},"Usuarios",-1)])),_:1}),P.value?(o(),D(re,{key:0,cols:"auto",class:"d-flex align-center justify-end"},{default:s(()=>[t(W,{color:"primary",class:"text-white",elevation:"1",onClick:Y},{default:s(()=>[B(b)?(o(),p(K,{key:0},[t(L,{icon:B($e),start:""},null,8,["icon"]),n[1]||(n[1]=r("span",null,"Agregar",-1))],64)):(o(),p(K,{key:1},[t(L,{icon:B($e),start:""},null,8,["icon"]),n[2]||(n[2]=r("span",null,"Agregar Usuario",-1))],64))]),_:1})]),_:1})):C("",!0)]),_:1}),t(Ft,{onSearch:G,onFilter:j,class:"mb-4"}),t(ye,null,{default:s(()=>[t(re,null,{default:s(()=>[t($t,{items:x.value,isMobile:B(b),isLoading:S.value},null,8,["items","isMobile","isLoading"])]),_:1})]),_:1})]),_:1})])):C("",!0)}};export{Ot as default};
