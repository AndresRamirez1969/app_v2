import{aC as j,J as f,an as q,c as g,w as t,a,b as y,a9 as x,ad as k,d as u,f as w,aj as R,C as V,t as _,e as d,V as b,ae as $,s as i,aq as L,u as W,v as A,a6 as P,am as B,Z as J,o as n,l as M,k as O,E as T}from"./index-BtdFDd_C.js";import{j as Z,t as G}from"./mdi-CCqP_oQm.js";const H={class:"d-flex align-center"},K={class:"text-h5 mb-1"},Q={class:"text-body-2 text-grey-darken-1 mb-0"},X={key:0,class:"text-center py-8"},Y={key:1,class:"text-center py-8"},ee={key:2},se={key:0},te={key:0},ae={key:1,class:"text-center py-4"},oe={key:1,class:"text-body-1"},ie={__name:"ShowUserResponse",setup(re){const v=j(),I=J(),N=v.params.formId,E=v.params.responseId,U=v.params.userId,p=f({}),c=f({}),h=f({}),m=f(!1),D=()=>{I.back()},F=async()=>{m.value=!0;try{const o=await B.get(`/forms/${N}/responses/${U}`);p.value=o.data.form,c.value=o.data.response[0],h.value=o.data.user,console.log("Datos completos:",o.data)}catch(o){console.error("Error fetching user response:",o)}finally{m.value=!1}},z=async o=>{try{const e=await B.get(`/form-responses/${o}/pdf`),s=e.data.download_url,l=document.createElement("a");l.href=s,l.target="_blank",l.rel="noopener noreferrer";const r=e.data.file_name||`respuestas_${p.value.name}_${new Date().toISOString().split("T")[0]}.pdf`;l.setAttribute("download",r),l.click(),toast.success("Reporte exportado correctamente")}catch(e){console.error("Error exporting responses:",e),toast.error("Error al exportar el reporte")}},S=o=>{var s;const e=(s=c.value.field_responses)==null?void 0:s.find(l=>l.form_field_id===o);return e?e.value:"—"},C=(o,e)=>{var l;const s=(l=c.value.field_responses)==null?void 0:l.find(r=>r.form_field_id===o);if(!s)return console.log(`No se encontró respuesta para el campo ${o}`),null;if(console.log(`Campo ${o} (${e}):`,s),e==="file"||e==="signature"){const r=s.value;return console.log(`Valor del campo ${e}:`,r),r&&(r.startsWith("http://")||r.startsWith("https://"))?r:r&&!r.startsWith("http")?"https://tasker-v2-bucket.s3.us-east-2.amazonaws.com/"+r:null}return s.value||"—"};return q(()=>{F()}),(o,e)=>(n(),g(P,{fluid:""},{default:t(()=>[a(b,{class:"mb-4"},{default:t(()=>[a(y,{cols:"12"},{default:t(()=>[a(x,null,{default:t(()=>[a(k,{class:"d-flex align-center justify-space-between"},{default:t(()=>[u("div",H,[a(w,{icon:"",variant:"text",onClick:D,class:"mr-3"},{default:t(()=>[a(R,{icon:V(Z)},null,8,["icon"])]),_:1}),u("div",null,[u("h2",K,_(p.value.name),1),u("p",Q,[e[1]||(e[1]=d(" Respuesta de: ")),u("strong",null,_(h.value.name||"Usuario"),1)])])]),a(w,{color:"primary",variant:"outlined",onClick:e[0]||(e[0]=s=>z(V(E))),loading:m.value,"prepend-icon":V(G)},{default:t(()=>e[2]||(e[2]=[d("Exportar PDF")])),_:1},8,["loading","prepend-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),a(b,null,{default:t(()=>[a(y,{cols:"12"},{default:t(()=>[a(x,null,{default:t(()=>[a(k,null,{default:t(()=>e[3]||(e[3]=[d("Respuestas del Usuario")])),_:1}),a($,null,{default:t(()=>[m.value?(n(),i("div",X,[a(L,{indeterminate:"",color:"primary",size:"64"}),e[4]||(e[4]=u("p",{class:"mt-4"},"Cargando respuestas...",-1))])):!c.value.field_responses||c.value.field_responses.length===0?(n(),i("div",Y,e[5]||(e[5]=[u("p",{class:"text-grey"},"No hay respuestas para mostrar",-1)]))):(n(),i("div",ee,[a(b,null,{default:t(()=>[(n(!0),i(W,null,A(p.value.fields,s=>(n(),g(y,{key:s.id,cols:"12",md:"6"},{default:t(()=>[a(x,{variant:"outlined",class:"mb-3"},{default:t(()=>[a(k,{class:"text-subtitle-1 pa-3"},{default:t(()=>[d(_(s.label)+" ",1),s.is_required?(n(),g(O,{key:0,color:"error",size:"x-small",class:"ml-2"},{default:t(()=>e[6]||(e[6]=[d(" Requerido ")])),_:1})):M("",!0)]),_:2},1024),a($,{class:"pt-0"},{default:t(()=>[s.type==="signature"||s.type==="file"?(n(),i("div",se,[C(s.id,s.type)?(n(),i("div",te,[a(T,{src:C(s.id,s.type),alt:"Firma o archivo",class:"mb-2","max-height":"200",contain:""},null,8,["src"])])):(n(),i("div",ae,[a(R,{size:"48",color:"grey"},{default:t(()=>e[7]||(e[7]=[d("mdi-file-image")])),_:1}),e[8]||(e[8]=u("p",{class:"text-grey mt-2"},"No hay archivo disponible",-1))]))])):(n(),i("p",oe,_(S(s.id)),1))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{ie as default};
