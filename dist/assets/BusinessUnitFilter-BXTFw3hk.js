import{J as n,ar as ie,A as oe,B as i,ag as B,s as g,o as v,a as t,d as o,as as ue,R as L,l as M,w as s,c as re,C as P,aj as z,e as A,f as S,a9 as de,ad as ve,ae as me,at as pe,b5 as j,Q as J,b3 as Q,x as R,au as ce,al as fe,am as q}from"./index-BtdFDd_C.js";/* empty css                */const ge={class:"d-flex align-center mb-6",style:{gap:"16px"}},xe={class:"filter-btn-wrapper ml-2 flex-shrink-0",style:{"min-width":"44px",position:"relative"}},Ve={key:1,class:"filter-btn-content"},ye={key:0,class:"filter-indicator"},be={key:0,class:"mb-3"},we={key:1,class:"mb-3"},he={class:"mb-3"},ze={__name:"BusinessUnitFilter",emits:["search","filter"],setup(Ce,{emit:G}){const x=G,V=n(""),d=n(!1),m=n(null),W=[{title:"Activo",value:"active"},{title:"Inactivo",value:"inactive"}],u=n(null),r=n(null),U=n(!1),$=n(!1),{mdAndDown:N}=ie(),X=oe(),T=i(()=>X.user||{roles:[],permissions:[]}),F=i(()=>T.value.roles||[]),Y=i(()=>T.value.permissions||[]),p=i(()=>F.value.includes("superadmin")),Z=i(()=>F.value.includes("admin")),_=i(()=>F.value.includes("sponsor")),ee=i(()=>Y.value.includes("businessUnit.viewAny")),y=i(()=>p.value||Z.value||_.value||ee.value),c=n(null),b=n([]),w=n(""),I=n(!1),O=async a=>{if(p.value){I.value=!0;try{const{data:e}=await q.get("/organizations",{params:{q:a||"",limit:10}});b.value=(e.data||[]).map(l=>({...l,display:`${l.folio}${l.legal_name?" - "+l.legal_name:""}`}))}catch{b.value=[]}finally{I.value=!1}}};function le(a,e,l){return e?(a.folio+" "+(a.legal_name||"")).toLowerCase().includes(e.toLowerCase()):!0}const f=n(null),h=n([]),C=n(""),H=n(!1),D=async a=>{if(y.value){H.value=!0;try{const{data:e}=await q.get("/businesses",{params:{q:a||"",limit:10}});h.value=(e.data||[]).map(l=>({...l,display:`${l.folio}${l.legal_name?" - "+l.legal_name:""}`}))}catch{h.value=[]}finally{H.value=!1}}};function ae(a,e,l){return e?(a.folio+" "+(a.legal_name||"")).toLowerCase().includes(e.toLowerCase()):!0}B(d,a=>{a&&p.value&&b.value.length===0&&O(""),a&&y.value&&h.value.length===0&&D("")}),B(w,a=>{p.value&&O(a)}),B(C,a=>{y.value&&D(a)}),B(V,a=>{x("search",a)});const te=i(()=>!!m.value||!!u.value||!!r.value||!!c.value||!!f.value);function K(){x("search",V.value)}function k(a){return a?typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a)?a:new Date(a).toISOString().slice(0,10):null}function se(){x("filter",{organizationId:c.value,businessId:f.value,status:m.value,createdAtStart:k(u.value),createdAtEnd:k(r.value)}),d.value=!1}function ne(){m.value=null,u.value=null,r.value=null,c.value=null,w.value="",f.value=null,C.value="",x("filter",{organizationId:null,businessId:null,status:null,createdAtStart:null,createdAtEnd:null})}return(a,e)=>(v(),g("div",ge,[t(L,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),placeholder:"Buscar por nombre legal, alias, folio o dirección...","prepend-inner-icon":"mdi-magnify",clearable:"",class:"flex-grow-1 search-bar",density:"compact",variant:"outlined",color:"primary","hide-details":"",style:{"min-width":"220px"},onKeyup:ue(K,["enter"]),"onClick:clear":K},null,8,["modelValue"]),o("div",xe,[t(S,{icon:P(N),variant:"text",class:"filter-btn filter-btn-center",style:{"border-radius":"8px",border:"1px solid #ccc","min-width":"44px",height:"44px",width:"100%"},color:"#222",onClick:e[1]||(e[1]=l=>d.value=!0)},{default:s(()=>[P(N)?(v(),re(z,{key:0},{default:s(()=>e[17]||(e[17]=[o("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[o("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1})):(v(),g("span",Ve,[t(z,{class:"mr-2"},{default:s(()=>e[18]||(e[18]=[o("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1}),e[20]||(e[20]=o("span",null,"Filtros",-1)),t(z,{class:"ml-2",end:""},{default:s(()=>e[19]||(e[19]=[A("mdi-filter-variant")])),_:1})]))]),_:1},8,["icon"]),te.value?(v(),g("span",ye)):M("",!0)]),t(fe,{modelValue:d.value,"onUpdate:modelValue":e[16]||(e[16]=l=>d.value=l),"max-width":"420"},{default:s(()=>[t(de,{class:"modal-padding",style:{position:"relative"}},{default:s(()=>[t(S,{icon:"",variant:"text",class:"position-absolute close-btn",style:{top:"10px",right:"10px",color:"#222","z-index":"10"},onClick:e[2]||(e[2]=l=>d.value=!1)},{default:s(()=>[t(z,null,{default:s(()=>e[21]||(e[21]=[o("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),_:1})]),_:1}),t(ve,{class:"font-weight-bold"},{default:s(()=>e[22]||(e[22]=[A("Filtros avanzados")])),_:1}),t(me,{class:"pb-0"},{default:s(()=>[t(pe,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value=l),items:W,label:"Estado",clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"mb-3 filter-padding",style:{"padding-top":"0px","padding-bottom":"0px"}},null,8,["modelValue"]),p.value?(v(),g("div",be,[t(j,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=l=>c.value=l),items:b.value,loading:I.value,"search-input":w.value,"onUpdate:searchInput":[e[5]||(e[5]=l=>w.value=l),O],"item-title":"display","item-value":"id",label:"Buscar organización (folio o nombre legal)",clearable:"","hide-details":"",variant:"outlined",color:"primary",density:"compact",filter:le,"menu-props":{maxHeight:"300px"}},null,8,["modelValue","items","loading","search-input"])])):M("",!0),y.value?(v(),g("div",we,[t(j,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=l=>f.value=l),items:h.value,loading:H.value,"search-input":C.value,"onUpdate:searchInput":[e[7]||(e[7]=l=>C.value=l),D],"item-title":"display","item-value":"id",label:"Buscar empresa (folio o nombre legal)",clearable:"","hide-details":"",variant:"outlined",color:"primary",density:"compact",filter:ae,"menu-props":{maxHeight:"300px"}},null,8,["modelValue","items","loading","search-input"])])):M("",!0),o("div",he,[t(J,{modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=l=>U.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:s(({props:l})=>[t(L,R({"model-value":k(u.value),label:"Creado desde",readonly:""},l,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field mb-2","onClick:clear":e[8]||(e[8]=E=>u.value=null)}),null,16,["model-value"])]),default:s(()=>[t(Q,{modelValue:u.value,"onUpdate:modelValue":[e[9]||(e[9]=l=>u.value=l),e[10]||(e[10]=l=>U.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(J,{modelValue:$.value,"onUpdate:modelValue":e[15]||(e[15]=l=>$.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:s(({props:l})=>[t(L,R({"model-value":k(r.value),label:"Creado hasta",readonly:""},l,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field","onClick:clear":e[12]||(e[12]=E=>r.value=null)}),null,16,["model-value"])]),default:s(()=>[t(Q,{modelValue:r.value,"onUpdate:modelValue":[e[13]||(e[13]=l=>r.value=l),e[14]||(e[14]=l=>$.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])])]),_:1}),t(ce,{class:"d-flex flex-column align-end pt-2",style:{gap:"8px"}},{default:s(()=>[t(S,{style:{"background-color":"#1677ff",color:"white","font-weight":"500","font-size":"14px",width:"100%","text-transform":"none"},onClick:se},{default:s(()=>e[23]||(e[23]=[A(" Aplicar ")])),_:1}),t(S,{variant:"text",style:{width:"100%",color:"#555","font-weight":"500","font-size":"13px","text-transform":"none"},onClick:ne},{default:s(()=>e[24]||(e[24]=[A(" Limpiar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ze as _};
