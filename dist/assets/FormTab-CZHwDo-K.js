import{_ as X,s as h,o as u,a as t,d as l,w as e,e as d,ae as M,ao as ee,ap as te,a0 as Y,ak as ae,J as g,B as O,q as se,aq as oe,u as I,l as x,c as $,al as F,v as G,a2 as T,t as w,k as J,C as f,S as le,G as re,p as q,m as j,H as W,f as U,x as ie,L as K,V as N,b as S,ab as Z,ar as ne,A as ue,ai as H,K as de,U as ce,as as me,at as pe,af as fe,ag as ve,au as ge,an as ye,a8 as be}from"./index-DA8Oyi7H.js";import{C as Q}from"./constants-nBv8b9vA.js";import{b as Ce,c as ke,d as Ve,e as we,f as he,g as xe,h as $e,i as Pe}from"./mdi-CCqP_oQm.js";import{d as Fe}from"./debounce-B42zFX2p.js";const _e={class:"d-flex justify-center mt-4"},Be={__name:"FormTableMeta",props:{items:{type:Array,default:()=>[]},page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean},emits:["update:page","sort"],setup(P,{emit:L}){const c=P,k=L;return(m,o)=>{var p;return u(),h("div",null,[t(ee,{density:"comfortable",class:"fixed-table elevation-1 rounded-lg"},{default:e(()=>[l("thead",null,[l("tr",null,[l("th",{onClick:o[0]||(o[0]=n=>k("sort","folio")),class:"cursor-pointer folio-header"},[o[6]||(o[6]=d(" Folio ")),M(m.$slots,"sort-icon",{column:"folio"},void 0,!0)]),l("th",{onClick:o[1]||(o[1]=n=>k("sort","name")),class:"cursor-pointer name-header"},[o[7]||(o[7]=d(" Nombre ")),M(m.$slots,"sort-icon",{column:"name"},void 0,!0)]),l("th",{onClick:o[2]||(o[2]=n=>k("sort","status")),class:"cursor-pointer status-header"},[o[8]||(o[8]=d(" Estado ")),M(m.$slots,"sort-icon",{column:"status"},void 0,!0)]),l("th",{onClick:o[3]||(o[3]=n=>k("sort","created_at")),class:"cursor-pointer date-header"},[o[9]||(o[9]=d(" Fecha de Creación ")),M(m.$slots,"sort-icon",{column:"created_at"},void 0,!0)]),o[10]||(o[10]=l("th",{class:"actions-header"},"Acciones",-1))])]),l("tbody",null,[M(m.$slots,"rows",{},void 0,!0)])]),_:3}),l("div",_e,[t(te,{modelValue:c.page,"onUpdate:modelValue":[o[4]||(o[4]=n=>c.page=n),o[5]||(o[5]=n=>k("update:page",n))],length:Math.ceil((((p=c.items)==null?void 0:p.length)||1)/c.itemsPerPage),"total-visible":"7",color:"primary"},null,8,["modelValue","length"])])])}}},Le=X(Be,[["__scopeId","data-v-29b7e2c5"]]),ze={key:0,class:"text-center py-8"},Ae={key:0,class:"text-center py-8"},De={class:"d-flex align-center mb-1",style:{"justify-content":"space-between"}},Me={class:"text-caption",style:{"margin-right":"8px"}},Se={class:"font-weight-medium mb-1"},Ue={class:"text-caption"},Ne=["onClick"],Ee={class:"folio-cell"},Ie={class:"name-cell"},Te={class:"status-cell"},qe={class:"date-cell"},je={__name:"FormView",props:{items:Array,isMobile:Boolean,isLoading:Boolean},emits:["formUpdated"],setup(P,{emit:L}){const c=P,k=Y(),m=ae(),o=g("folio"),p=g(!1),n=g(1),z=g(10),A=L,E=i=>{o.value===i?p.value=!p.value:(o.value=i,p.value=!1)},_=i=>i?new Date(i).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"—",D=i=>({draft:"Borrador",active:"Activo",archived:"Archivado"})[i]||i,y=O(()=>[...c.items].sort((i,s)=>{var V,R;const C=((V=i[o.value])==null?void 0:V.toString().toLowerCase())??"",a=((R=s[o.value])==null?void 0:R.toString().toLowerCase())??"";return C.localeCompare(a)*(p.value?-1:1)})),B=O(()=>{const i=(n.value-1)*z.value;return y.value.slice(i,i+z.value)}),v=i=>{k.push({name:"FormDetail",params:{id:i.id}})},r=async i=>{var s,C;if(i.fields.length===0){m.error("No se puede publicar un formulario sin campos");return}try{await K.put(`/forms/${i.id}/status`,{status:"active"}),i.status="active",m.success("Se ha publicado el formulario"),A("formUpdated")}catch(a){console.error("Error al publicar formulario:",a),m.error("Error al publicar formulario: "+(((C=(s=a.response)==null?void 0:s.data)==null?void 0:C.message)||a.message))}},b=async i=>{var s,C;try{await K.put(`/forms/${i.id}/status`,{status:"archived"}),i.status="archived",m.success("Se ha archivado el formulario"),A("formUpdated")}catch(a){console.error("Error al archivar formulario:",a),m.error("Error al archivar formulario: "+(((C=(s=a.response)==null?void 0:s.data)==null?void 0:C.message)||a.message))}};return(i,s)=>{const C=se("router-link");return u(),h("div",null,[P.isLoading?(u(),h("div",ze,[t(oe,{indeterminate:"",color:"primary",size:"64"}),s[4]||(s[4]=l("p",{class:"mt-4"},"Cargando formularios...",-1))])):(u(),h(I,{key:1},[B.value.length?P.isMobile?(u(!0),h(I,{key:1},G(B.value,a=>(u(),$(Z,{key:a.id,class:"mb-4 pa-3 elevation-1 rounded-lg row-clickable",onClick:V=>v(a),style:{cursor:"pointer"}},{default:e(()=>[t(N,{"no-gutters":"",align:"center",class:"mb-1"},{default:e(()=>[t(S,{cols:"12"},{default:e(()=>[l("div",De,[l("div",Me,[t(C,{to:`/formulario/${a.id}`,onClick:s[0]||(s[0]=T(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:e(()=>[d(w(a.folio),1)]),_:2},1032,["to"])]),t(J,{color:f(Q)(a.status),"text-color":"white",size:"small"},{default:e(()=>[d(w(D(a.status)),1)]),_:2},1032,["color"])]),l("div",Se,w(a.name),1),l("div",Ue,[s[8]||(s[8]=l("strong",null,"Creado:",-1)),d(" "+w(_(a.created_at)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):x("",!0):(u(),h("div",Ae,[t(F,{size:"64",color:"grey lighten-1"},{default:e(()=>s[5]||(s[5]=[d("mdi-domain-off")])),_:1}),s[6]||(s[6]=l("p",{class:"mt-4 text-h6 text-grey-darken-1"},"No existen formularios",-1)),s[7]||(s[7]=l("p",{class:"text-body-2 text-grey"},"No se encontraron formularios con los filtros aplicados",-1))])),P.isMobile?x("",!0):(u(),$(Le,{key:2,items:y.value,page:n.value,itemsPerPage:z.value,sortBy:o.value,sortDesc:p.value,"onUpdate:page":s[3]||(s[3]=a=>n.value=a),onSort:E},{"sort-icon":e(({column:a})=>[o.value===a?(u(),$(F,{key:0,size:"16",class:"ml-1"},{default:e(()=>[d(w(p.value?f(he):f(xe)),1)]),_:1})):x("",!0)]),rows:e(()=>[B.value.length?(u(!0),h(I,{key:0},G(B.value,a=>(u(),h("tr",{key:a.id,onClick:V=>v(a),class:"row-clickable",style:{cursor:"pointer"}},[l("td",Ee,[t(C,{to:`/formulario/${a.id}`,onClick:s[1]||(s[1]=T(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:e(()=>[d(w(a.folio),1)]),_:2},1032,["to"])]),l("td",Ie,w(a.name),1),l("td",Te,[t(J,{color:f(Q)(a.status),"text-color":"white",size:"small"},{default:e(()=>[d(w(D(a.status)),1)]),_:2},1032,["color"])]),l("td",qe,w(_(a.created_at)),1),l("td",{class:"actions-cell",onClick:s[2]||(s[2]=T(()=>{},["stop"]))},[t(le,{location:"bottom end"},{activator:e(({props:V})=>[t(U,ie({ref_for:!0},V,{variant:"text",class:"pa-0","min-width":"0",height:"24"}),{default:e(()=>[t(F,{icon:f(we),size:"20"},null,8,["icon"])]),_:2},1040)]),default:e(()=>[t(re,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:e(()=>[t(q,{onClick:V=>v(a)},{prepend:e(()=>[t(F,{icon:f(Ce),size:"18"},null,8,["icon"])]),default:e(()=>[t(j,null,{default:e(()=>s[9]||(s[9]=[d("Ver")])),_:1})]),_:2},1032,["onClick"]),t(W,{class:"my-1"}),a.status==="draft"?(u(),$(q,{key:0,onClick:V=>r(a)},{prepend:e(()=>[t(F,{icon:f(ke),size:"18",color:"green"},null,8,["icon"])]),default:e(()=>[t(j,null,{default:e(()=>s[10]||(s[10]=[d("Publicar")])),_:1})]),_:2},1032,["onClick"])):x("",!0),a.status==="draft"?(u(),$(W,{key:1,class:"my-1"})):x("",!0),a.status!=="archived"?(u(),$(q,{key:2,onClick:V=>b(a)},{prepend:e(()=>[t(F,{icon:f(Ve),size:"18",color:"red"},null,8,["icon"])]),default:e(()=>[t(j,null,{default:e(()=>s[11]||(s[11]=[d("Archivar")])),_:1})]),_:2},1032,["onClick"])):x("",!0)]),_:2},1024)]),_:2},1024)])],8,Ne))),128)):x("",!0)]),_:1},8,["items","page","itemsPerPage","sortBy","sortDesc"]))],64))])}}},He=X(je,[["__scopeId","data-v-65d0f8d5"]]),Oe={class:"d-flex align-center mb-2",style:{gap:"16px"}},We={__name:"FormTab",setup(P){const{mdAndDown:L}=ne(),c=g({search:"",folio:"",status:null}),k=g([{title:"Borrador",value:"draft"},{title:"Activo",value:"active"},{title:"Archivado",value:"archived"}]),m=ue(),o=Y(),p=g(!1),n=g(!1),z=g(!1),A=()=>{z.value=window.innerWidth<768};H(()=>m.permissions,v=>{v.length>0&&console.log("Permisos cargados",v)},{immediate:!0});const E=O(()=>m.hasPermissions("form.create")),_=g(1),D=g({data:[],last_page:1}),y=async()=>{try{p.value=!0;const v=await K.get("/forms",{params:{search:c.value.search,page:_.value,status:c.value.status}});D.value=v.data}catch(v){console.error("Failed to fetch forms",v)}finally{p.value=!1}};de(()=>{y(),A(),window.addEventListener("resize",A)});const B=Fe(y,400);return H(()=>c.value.search,()=>{_.value=1,B()}),H(()=>c.value.status,()=>{_.value=1,y()}),(v,r)=>(u(),$(be,{fluid:""},{default:e(()=>[t(N,{class:"align-center justify-space-between mb-4"},{default:e(()=>[t(S,{cols:"auto",class:"d-flex align-center"},{default:e(()=>[r[6]||(r[6]=l("h1",{class:"text-h4 text-md-h3 font-weight-bold ma-0"},"Formularios",-1)),t(U,{icon:f($e),variant:"text",color:"primary",size:"small",class:"ml-2",onClick:r[0]||(r[0]=b=>n.value=!0)},null,8,["icon"])]),_:1}),E.value?(u(),$(S,{key:0,cols:"auto",class:"d-flex align-center justify-end"},{default:e(()=>[t(U,{color:"primary",class:"text-white",elevation:"1",onClick:r[1]||(r[1]=b=>f(o).push({name:"CreateForm",params:{id:f(m).user.id}}))},{default:e(()=>[t(F,{start:"",icon:f(Pe)},null,8,["icon"]),r[7]||(r[7]=l("span",null,"Crear Formulario",-1))]),_:1})]),_:1})):x("",!0)]),_:1}),t(N,{class:"mb-2"},{default:e(()=>[t(S,{cols:"12"},{default:e(()=>[l("div",Oe,[t(ce,{modelValue:c.value.search,"onUpdate:modelValue":r[2]||(r[2]=b=>c.value.search=b),label:"Buscar por Nombre o Folio",clearable:"",density:"comfortable",variant:"outlined","hide-details":"",onKeyup:me(y,["enter"]),"prepend-inner-icon":"mdi-magnify",style:{"min-width":"220px"},"onClick:clear":y},null,8,["modelValue"]),t(pe,{modelValue:c.value.status,"onUpdate:modelValue":[r[3]||(r[3]=b=>c.value.status=b),y],items:k.value,label:"Estado",clearable:"",density:"comfortable",variant:"outlined","hide-details":"",style:{width:"1px"}},null,8,["modelValue","items"])])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(S,null,{default:e(()=>[t(He,{items:D.value.data,isMobile:f(L),isLoading:p.value,onFormUpdated:y},null,8,["items","isMobile","isLoading"])]),_:1})]),_:1}),t(ye,{modelValue:n.value,"onUpdate:modelValue":r[5]||(r[5]=b=>n.value=b),"max-width":"600"},{default:e(()=>[t(Z,null,{default:e(()=>[t(fe,null,{default:e(()=>r[8]||(r[8]=[d("Información sobre Formularios")])),_:1}),t(ve,null,{default:e(()=>r[9]||(r[9]=[l("p",null,"Aqui podras ver los formularios que has creado, editarlos o publicarlos.",-1),l("p",null,' Para publicar un formulario, haz click en el boton de "Acciones" y selecciona "Publicar". Una vez que se publique un formulario, estara disponible para que usuarios asignados lo contesten. ',-1),l("p",null,"Para editar o ver mas informacion sobre un formulario, haz click en cualquier parte de la fila del formulario.",-1)])),_:1}),t(ge,null,{default:e(()=>[t(U,{color:"primary",onClick:r[4]||(r[4]=b=>n.value=!1)},{default:e(()=>r[10]||(r[10]=[d("Cerrar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{We as default};
