import{_ as ve,s as d,o as n,l as h,a as s,d as o,H as se,w as t,ae as H,e as g,ao as we,ap as be,a0 as fe,A as oe,B as _,J as p,q as xe,aq as he,u as N,c as A,al as B,b as Q,V as Z,v as X,a2 as Y,t as O,k as re,am as ue,ab as ge,S as le,G as ze,p as de,m as me,C as L,f as q,x as ne,ar as ye,ai as te,as as Ce,U as ae,af as Ve,ag as $e,b5 as Se,b3 as ce,au as _e,an as Ae,L as ke,K as Pe,a8 as Oe}from"./index-DA8Oyi7H.js";import{b as Be,k as Le,e as De,f as Ie,g as Ue,i as pe}from"./mdi-CCqP_oQm.js";/* empty css                */const Ne={key:0,class:"mb-3"},Re={class:"d-flex justify-center mt-4"},Me={__name:"RoleTableMeta",props:{items:{type:Array,default:()=>[]},page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean,showOrganization:Boolean},emits:["update:page","sort"],setup(M,{emit:F}){const k=M,w=F;return(v,i)=>{var y;return n(),d("div",null,[k.showOrganization?(n(),d("div",Ne,[i[6]||(i[6]=o("h4",{class:"font-weight-bold"},"Organización",-1)),s(se,{class:"mb-4"})])):h("",!0),s(we,{density:"comfortable",class:"fixed-table elevation-1 rounded-lg"},{default:t(()=>[o("thead",null,[H(v.$slots,"header",{},()=>[o("tr",null,[o("th",{onClick:i[0]||(i[0]=b=>w("sort","id")),class:"cursor-pointer id-header"},[i[7]||(i[7]=g(" Identificador ")),H(v.$slots,"sort-icon",{column:"id"},void 0,!0)]),o("th",{onClick:i[1]||(i[1]=b=>w("sort","name")),class:"cursor-pointer name-header"},[i[8]||(i[8]=g(" Nombre ")),H(v.$slots,"sort-icon",{column:"name"},void 0,!0)]),k.showOrganization?(n(),d("th",{key:0,onClick:i[2]||(i[2]=b=>w("sort","organization_id")),class:"cursor-pointer org-header"},[i[9]||(i[9]=g(" Organización ")),H(v.$slots,"sort-icon",{column:"organization_id"},void 0,!0)])):h("",!0),o("th",{onClick:i[3]||(i[3]=b=>w("sort","permissions")),class:"cursor-pointer permissions-header"},[i[10]||(i[10]=g(" Permisos ")),H(v.$slots,"sort-icon",{column:"permissions"},void 0,!0)]),i[11]||(i[11]=o("th",{class:"actions-header"},null,-1))])],!0)]),o("tbody",null,[H(v.$slots,"rows",{showOrganization:k.showOrganization},void 0,!0)])]),_:3}),o("div",Re,[s(be,{modelValue:k.page,"onUpdate:modelValue":[i[4]||(i[4]=b=>k.page=b),i[5]||(i[5]=b=>w("update:page",b))],length:Math.ceil((((y=k.items)==null?void 0:y.length)||1)/k.itemsPerPage),"total-visible":"7",color:"primary"},null,8,["modelValue","length"])])])}}},Fe=ve(Me,[["__scopeId","data-v-834a23cc"]]),Ee={key:0,class:"text-center py-8"},Te={key:0,class:"text-center py-8"},He={key:1,class:"mb-4 d-flex justify-end"},je={class:"d-flex align-center mb-1",style:{"justify-content":"space-between"}},Ge={class:"text-caption",style:{"margin-right":"8px"}},Ke={class:"font-weight-medium mb-1"},qe={key:0,class:"text-caption"},Je={class:"text-caption"},Qe={key:1},We={key:0,class:"org-cell"},Xe=["onClick"],Ye={class:"id-cell"},Ze={class:"name-cell"},et={key:0,class:"org-cell"},tt={key:1,class:"org-cell",style:{display:"none"}},at={class:"permissions-cell"},st={key:1},lt={key:1},nt=["colspan"],ot={__name:"RoleList",props:{items:Array,isMobile:Boolean,isLoading:Boolean},setup(M){const F={superadmin:"Super Administrador",admin:"Administrador",sponsor:"Sponsor"},k=["superadmin","admin","sponsor"],w=M,v=fe(),i=oe(),y=_(()=>i.user||{roles:[],permissions:[],organization_id:null}),b=_(()=>y.value.roles||[]),P=_(()=>y.value.permissions||[]),$=_(()=>b.value.includes("superadmin")),S=_(()=>P.value.includes("role.update")),x=_(()=>P.value.includes("role.view")),I=_(()=>P.value.includes("role.create")),E=_(()=>x.value||S.value);function U(u){var a;return k.includes((a=u.name)==null?void 0:a.toLowerCase())}const R=_(()=>$.value?w.items||[]:(w.items||[]).filter(u=>U(u)||u.organization_id===y.value.organization_id)),z=p("id"),m=p(!1),f=p(1),j=p(10),G=u=>{z.value===u?m.value=!m.value:(z.value=u,m.value=!1)},W=_(()=>[...R.value].sort((u,a)=>{var C,D,J,ie;let V,l;return z.value==="permissions"?(V=((C=u.permissions)==null?void 0:C.length)||0,l=((D=a.permissions)==null?void 0:D.length)||0,(V-l)*(m.value?-1:1)):z.value==="organization_id"?(V=u.organization_id??"",l=a.organization_id??"",V.toString().localeCompare(l.toString())*(m.value?-1:1)):(V=((J=u[z.value])==null?void 0:J.toString().toLowerCase())??"",l=((ie=a[z.value])==null?void 0:ie.toString().toLowerCase())??"",V.localeCompare(l)*(m.value?-1:1))})),K=_(()=>{const u=(f.value-1)*j.value;return W.value.slice(u,u+j.value)}),ee=u=>v.push({path:`/roles/editar/${u.id}`}),c=u=>v.push({path:`/roles/${u.id}`});function e(u){return u.name==="superadmin"?"Único":["admin","sponsor"].includes(u.name)?"Global":u.organization_id??"N/A"}function r(u){return F[u]||u}function T(u){if(!u.permissions||!u.permissions.length)return[];const a={user:"Usuario",organization:"Organización",business:"Empresa",businessUnit:"Unidad de negocio",businessUnitGroup:"Grupo de unidades",role:"Rol",form:"Formulario",form_field:"Campo de formulario",form_response:"Respuesta de formulario"},V=new Set;return u.permissions.forEach(l=>{var J;const D=(J=(l.name||l).split("."))==null?void 0:J[0];D==="person"||D==="permission"||(a[D]?V.add(a[D]):D&&V.add(D.charAt(0).toUpperCase()+D.slice(1)))}),Array.from(V)}return(u,a)=>{const V=xe("router-link");return n(),d("div",null,[M.isLoading?(n(),d("div",Ee,[s(he,{indeterminate:"",color:"primary",size:"64"}),a[5]||(a[5]=o("p",{class:"mt-4"},"Cargando roles...",-1))])):(n(),d(N,{key:1},[K.value.length?h("",!0):(n(),d("div",Te,[s(B,{size:"64",color:"grey lighten-1"},{default:t(()=>a[6]||(a[6]=[g("mdi-domain-off")])),_:1}),a[7]||(a[7]=o("p",{class:"mt-4 text-h6 text-grey-darken-1"},"No existen roles",-1)),a[8]||(a[8]=o("p",{class:"text-body-2 text-grey"},"No se encontraron roles con los filtros aplicados",-1))])),I.value?(n(),d("div",He,[H(u.$slots,"add-btn",{},void 0,!0)])):h("",!0),M.isMobile?(n(),d(N,{key:2},[s(Z,null,{default:t(()=>[$.value?(n(),A(Q,{key:0,cols:"12"},{default:t(()=>[a[9]||(a[9]=o("h4",{class:"font-weight-bold mb-3"},"Organización",-1)),s(se,{class:"mb-4"})]),_:1})):h("",!0)]),_:1}),(n(!0),d(N,null,X(K.value,l=>(n(),A(ge,{key:l.id,class:"mb-4 pa-3 elevation-1 rounded-lg row-clickable",onClick:C=>x.value?()=>c(l):void 0,style:ue({cursor:x.value?"pointer":"default"})},{default:t(()=>[s(Z,{"no-gutters":"",align:"center",class:"mb-1"},{default:t(()=>[s(Q,{cols:"12"},{default:t(()=>[o("div",je,[o("div",Ge,[s(V,{to:`/roles/${l.id}`,onClick:a[0]||(a[0]=Y(()=>{},["stop"])),style:{"text-decoration":"underline",color:"#1976d2 !important"}},{default:t(()=>[g(O(l.id),1)]),_:2},1032,["to"])])]),o("div",Ke,O(r(l.name)),1),$.value?(n(),d("div",qe,[a[10]||(a[10]=o("strong",null,"Organización:",-1)),g(" "+O(e(l)),1)])):h("",!0),o("div",Je,[a[11]||(a[11]=o("strong",null,"Permisos pertenecen a:",-1)),T(l).length?(n(!0),d(N,{key:0},X(T(l),C=>(n(),A(re,{key:C,class:"ma-1",size:"small",color:"primary","text-color":"white"},{default:t(()=>[g(O(C),1)]),_:2},1024))),128)):(n(),d("span",Qe,"Sin permisos"))])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))],64)):(n(),A(Fe,{key:3,items:W.value.value,page:f.value,itemsPerPage:j.value,sortBy:z.value,sortDesc:m.value,showOrganization:$.value.value,"onUpdate:page":a[4]||(a[4]=l=>f.value=l),onSort:G},{"sort-icon":t(({column:l})=>[z.value===l?(n(),A(B,{key:0,size:"16",class:"ml-1"},{default:t(()=>[g(O(m.value?L(Ie):L(Ue)),1)]),_:1})):h("",!0)]),header:t(()=>[o("tr",null,[a[12]||(a[12]=o("th",{class:"id-cell"},"ID",-1)),a[13]||(a[13]=o("th",{class:"name-cell"},"Nombre",-1)),$.value?(n(),d("th",We,"Organización")):h("",!0),a[14]||(a[14]=o("th",{class:"permissions-cell"},"Permisos pertenecen a",-1)),a[15]||(a[15]=o("th",{class:"actions-cell"},null,-1))])]),rows:t(()=>[K.value.length?(n(!0),d(N,{key:0},X(K.value,l=>(n(),d("tr",{key:l.id,onClick:C=>x.value?c(l):null,class:"row-clickable",style:ue({cursor:x.value?"pointer":"default"})},[o("td",Ye,[s(V,{to:`/roles/${l.id}`,onClick:a[1]||(a[1]=Y(()=>{},["stop"])),style:{"text-decoration":"underline",color:"#1976d2 !important"}},{default:t(()=>[g(O(l.id),1)]),_:2},1032,["to"])]),o("td",Ze,O(r(l.name)),1),$.value?(n(),d("td",et,[l.organization&&(l.organization.folio||l.organization.legal_name||l.organization.name)?(n(),A(V,{key:0,to:`/organizaciones/${l.organization.id}`,onClick:a[2]||(a[2]=Y(()=>{},["stop"])),style:{"text-decoration":"underline",color:"#1976d2 !important"}},{default:t(()=>[g(O(l.organization.folio??l.organization.id)+" - "+O(l.organization.legal_name??l.organization.name),1)]),_:2},1032,["to"])):(n(),d(N,{key:1},[g(O(e(l)),1)],64))])):(n(),d("td",tt)),o("td",at,[T(l).length?(n(!0),d(N,{key:0},X(T(l),C=>(n(),A(re,{key:C,class:"ma-1",size:"small",color:"primary","text-color":"white"},{default:t(()=>[g(O(C),1)]),_:2},1024))),128)):(n(),d("span",st,"Sin permisos"))]),o("td",{class:"actions-cell",onClick:a[3]||(a[3]=Y(()=>{},["stop"]))},[E.value&&(!U(l)||U(l)&&x.value)?(n(),A(le,{key:0,location:"bottom end"},{activator:t(({props:C})=>[s(q,ne({ref_for:!0},C,{variant:"text",class:"pa-0","min-width":"0",height:"24"}),{default:t(()=>[s(B,{icon:L(De),size:"20"},null,8,["icon"])]),_:2},1040)]),default:t(()=>[s(ze,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:t(()=>[x.value?(n(),A(de,{key:0,onClick:C=>c(l)},{prepend:t(()=>[s(B,{icon:L(Be),size:"18"},null,8,["icon"])]),default:t(()=>[s(me,null,{default:t(()=>a[16]||(a[16]=[g("Ver")])),_:1})]),_:2},1032,["onClick"])):h("",!0),S.value&&x.value&&!U(l)?(n(),A(se,{key:1,class:"my-1"})):h("",!0),S.value&&!U(l)?(n(),A(de,{key:2,onClick:C=>ee(l)},{prepend:t(()=>[s(B,{icon:L(Le),size:"18"},null,8,["icon"])]),default:t(()=>[s(me,null,{default:t(()=>a[17]||(a[17]=[g("Editar")])),_:1})]),_:2},1032,["onClick"])):h("",!0)]),_:2},1024)]),_:2},1024)):h("",!0)])],12,Xe))),128)):(n(),d("tr",lt,[o("td",{colspan:$.value?5:4,class:"text-center py-8"},a[18]||(a[18]=[o("div",{class:"font-weight-bold mb-2",style:{"font-size":"1.5rem"}},"No se encontraron roles",-1)]),8,nt)]))]),_:1},8,["items","page","itemsPerPage","sortBy","sortDesc","showOrganization"]))],64))])}}},it=ve(ot,[["__scopeId","data-v-8762d9ca"]]),rt={class:"d-flex align-center mb-6",style:{gap:"16px"}},ut={class:"filter-btn-wrapper ml-2 flex-shrink-0",style:{"min-width":"44px",position:"relative"}},dt={key:1,class:"filter-btn-content"},mt={key:0,class:"filter-indicator"},ct={key:0,class:"mb-3"},pt={class:"mb-3"},vt={__name:"RoleFilters",emits:["search","filter"],setup(M,{emit:F}){const k=F,w=p(""),v=p(!1),i=p(null),y=p(null),b=p(!1),P=p(!1),{mdAndDown:$}=ye(),S=p(null),x=p([]),I=p(""),E=p(!1),U=oe(),R=_(()=>{var c,e;return(e=(c=U.user)==null?void 0:c.roles)==null?void 0:e.includes("superadmin")}),z=async c=>{E.value=!0;try{const{data:e}=await ke.get("/organizations",{params:{q:c||"",limit:10}});x.value=(e.data||[]).map(r=>({...r,display:`${r.folio}${r.legal_name?" - "+r.legal_name:""}`}))}catch{x.value=[]}finally{E.value=!1}};te(v,c=>{c&&x.value.length===0&&R.value&&z("")}),te(I,c=>{R.value&&z(c)});function m(c,e,r){return e?(c.folio+" "+(c.legal_name||"")).toLowerCase().includes(e.toLowerCase()):!0}te(w,c=>{k("search",c)});const f=_(()=>!!i.value||!!y.value||!!S.value);function j(){k("search",w.value)}function G(c){return c?typeof c=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(c)?c:new Date(c).toISOString().slice(0,10):null}function W(){k("filter",{organizationId:R.value?S.value:void 0,createdAtStart:G(i.value),createdAtEnd:G(y.value)}),v.value=!1}function K(){i.value=null,y.value=null,S.value=null,I.value="",k("filter",{organizationId:null,createdAtStart:null,createdAtEnd:null})}function ee(){K(),v.value=!1}return(c,e)=>(n(),d("div",rt,[s(ae,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=r=>w.value=r),placeholder:"Buscar por identificador, nombre o rol...","prepend-inner-icon":"mdi-magnify",clearable:"",class:"flex-grow-1 search-bar",density:"compact",variant:"outlined",color:"primary","hide-details":"",style:{"min-width":"220px"},onKeyup:Ce(j,["enter"]),"onClick:clear":j},null,8,["modelValue"]),o("div",ut,[s(q,{icon:L($),variant:"text",class:"filter-btn filter-btn-center",style:{"border-radius":"8px",border:"1px solid #ccc","min-width":"44px",height:"44px",width:"100%"},color:"#222",onClick:e[1]||(e[1]=r=>v.value=!0)},{default:t(()=>[L($)?(n(),A(B,{key:0},{default:t(()=>e[14]||(e[14]=[o("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[o("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1})):(n(),d("span",dt,[s(B,{class:"mr-2"},{default:t(()=>e[15]||(e[15]=[o("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M3 6h18v2H3V6m3 6h12v2H6v-2m3 6h6v2H9v-2z"})],-1)])),_:1}),e[17]||(e[17]=o("span",null,"Filtros",-1)),s(B,{class:"ml-2",end:""},{default:t(()=>e[16]||(e[16]=[g("mdi-filter-variant")])),_:1})]))]),_:1},8,["icon"]),f.value?(n(),d("span",mt)):h("",!0)]),s(Ae,{modelValue:v.value,"onUpdate:modelValue":e[13]||(e[13]=r=>v.value=r),"max-width":"420"},{default:t(()=>[s(ge,{class:"modal-padding",style:{position:"relative"}},{default:t(()=>[s(q,{icon:"",variant:"text",class:"position-absolute close-btn",style:{top:"10px",right:"10px",color:"#222","z-index":"10"},onClick:e[2]||(e[2]=r=>v.value=!1)},{default:t(()=>[s(B,null,{default:t(()=>e[18]||(e[18]=[o("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),_:1})]),_:1}),s(Ve,{class:"font-weight-bold"},{default:t(()=>e[19]||(e[19]=[g("Filtros avanzados")])),_:1}),s($e,{class:"pb-0"},{default:t(()=>[R.value?(n(),d("div",ct,[s(Se,{modelValue:S.value,"onUpdate:modelValue":e[3]||(e[3]=r=>S.value=r),items:x.value,loading:E.value,"search-input":I.value,"onUpdate:searchInput":[e[4]||(e[4]=r=>I.value=r),z],"item-title":"display","item-value":"id",label:"Buscar organización (folio o nombre legal)",clearable:"","hide-details":"",variant:"outlined",color:"primary",density:"compact",filter:m,"menu-props":{maxHeight:"300px"}},null,8,["modelValue","items","loading","search-input"])])):h("",!0),o("div",pt,[s(le,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=r=>b.value=r),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:t(({props:r})=>[s(ae,ne({"model-value":G(i.value),label:"Creado desde",readonly:""},r,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field mb-2","onClick:clear":e[5]||(e[5]=T=>i.value=null)}),null,16,["model-value"])]),default:t(()=>[s(ce,{modelValue:i.value,"onUpdate:modelValue":[e[6]||(e[6]=r=>i.value=r),e[7]||(e[7]=r=>b.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"]),s(le,{modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=r=>P.value=r),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290","min-width":"auto"},{activator:t(({props:r})=>[s(ae,ne({"model-value":G(y.value),label:"Creado hasta",readonly:""},r,{clearable:"","hide-details":"",variant:"outlined",color:"primary",class:"filter-padding date-field","onClick:clear":e[9]||(e[9]=T=>y.value=null)}),null,16,["model-value"])]),default:t(()=>[s(ce,{modelValue:y.value,"onUpdate:modelValue":[e[10]||(e[10]=r=>y.value=r),e[11]||(e[11]=r=>P.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])])]),_:1}),s(_e,{class:"d-flex flex-column align-end pt-2",style:{gap:"8px"}},{default:t(()=>[s(q,{style:{"background-color":"#1677ff",color:"white","font-weight":"500","font-size":"14px",width:"100%","text-transform":"none"},onClick:W},{default:t(()=>e[20]||(e[20]=[g(" Aplicar ")])),_:1}),s(q,{variant:"text",style:{width:"100%",color:"#555","font-weight":"500","font-size":"13px","text-transform":"none"},onClick:ee},{default:t(()=>e[21]||(e[21]=[g(" Limpiar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ft={key:0},wt={__name:"index",setup(M){const F=fe(),k=p([]),w=p([]),{mdAndDown:v}=ye(),i=p(""),y=p({}),b=oe(),P=p(!1),$=p(!1),S=p(!1);function x(m){var f;return Array.isArray((f=b.user)==null?void 0:f.permissions)&&b.user.permissions.includes(m)}Pe(async()=>{if(!x("role.viewAny")){P.value=!1;return}P.value=!0,$.value=x("role.create");try{S.value=!0,await I()}catch(m){console.error("Error fetching roles:",m)}finally{S.value=!1}});const I=async(m={})=>{try{const{data:f}=await ke.get("/roles",{params:m});k.value=f.data||[],w.value=f.data||[]}catch(f){console.error("Error fetching roles:",f),k.value=[],w.value=[]}},E=()=>{F.push("/roles/crear")};function U(m){i.value=m,z()}async function R(m){m.organizationId?y.value={...m}:y.value={...m,organizationId:void 0},await z()}async function z(){const m={...y.value,search:i.value};await I(m)}return(m,f)=>P.value?(n(),d("div",ft,[s(Oe,{fluid:""},{default:t(()=>[s(Z,{class:"align-center justify-space-between mb-4"},{default:t(()=>[s(Q,{cols:"auto",class:"d-flex align-center"},{default:t(()=>f[0]||(f[0]=[o("h3",{class:"font-weight-medium mb-0"},"Roles",-1)])),_:1}),$.value?(n(),A(Q,{key:0,cols:"auto",class:"d-flex align-center justify-end"},{default:t(()=>[s(q,{color:"primary",class:"text-white",elevation:"1",onClick:E},{default:t(()=>[L(v)?(n(),d(N,{key:0},[s(B,{icon:L(pe),start:""},null,8,["icon"]),f[1]||(f[1]=o("span",null,"Agregar",-1))],64)):(n(),d(N,{key:1},[s(B,{icon:L(pe),start:""},null,8,["icon"]),f[2]||(f[2]=o("span",null,"Agregar Rol",-1))],64))]),_:1})]),_:1})):h("",!0)]),_:1}),s(vt,{onSearch:U,onFilter:R,class:"mb-4"}),s(Z,null,{default:t(()=>[s(Q,null,{default:t(()=>[s(it,{items:w.value,isMobile:L(v),isLoading:S.value},null,8,["items","isMobile","isLoading"])]),_:1})]),_:1})]),_:1})])):h("",!0)}};export{wt as default};
