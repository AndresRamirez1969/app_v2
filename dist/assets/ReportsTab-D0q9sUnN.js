import{_ as T,s as h,o as v,a as t,d as a,w as e,e as d,ae as R,ao as X,ap as Y,a0 as Z,J as _,B as D,q as ee,l as S,c as V,u as N,v as j,V as P,b as C,a2 as E,t as b,ab as z,S as W,G as te,p as se,m as ae,al as L,C as $,f as q,x as Q,af as K,ag as O,b9 as le,A as oe,ai as G,K as ne,ba as re,U as H,as as ie,b3 as de,k as J,a8 as ue,L as ce}from"./index-DA8Oyi7H.js";import{b as me,e as pe,f as ve,g as fe,q as ge,r as ye,s as be}from"./mdi-CCqP_oQm.js";import{d as xe}from"./debounce-B42zFX2p.js";const _e={class:"cursor-pointer name-header"},he={class:"d-flex justify-center mt-4"},we={__name:"ReportsTableMeta",props:{items:{type:Array,default:()=>[]},page:Number,itemsPerPage:Number,sortBy:String,sortDesc:Boolean},emits:["update:page","sort"],setup(w,{emit:s}){const g=w,u=s;return(c,l)=>{var o;return v(),h("div",null,[t(X,{density:"comfortable",class:"fixed-table elevation-1 rounded-lg"},{default:e(()=>[a("thead",null,[a("tr",null,[a("th",{onClick:l[0]||(l[0]=y=>u("sort","folio")),class:"cursor-pointer folio-header"},[l[5]||(l[5]=d(" Folio ")),R(c.$slots,"sort-icon",{column:"folio"},void 0,!0)]),a("th",{onClick:l[1]||(l[1]=y=>u("sort","name")),class:"cursor-pointer name-header"},[l[6]||(l[6]=d(" Nombre ")),R(c.$slots,"sort-icon",{column:"name"},void 0,!0)]),a("th",_e,[l[7]||(l[7]=d(" Respuestas ")),R(c.$slots,"sort-icon",{column:"answers"},void 0,!0)]),a("th",{onClick:l[2]||(l[2]=y=>u("sort","created_at")),class:"cursor-pointer date-header"},[l[8]||(l[8]=d(" Fecha de Creación ")),R(c.$slots,"sort-icon",{column:"created_at"},void 0,!0)]),l[9]||(l[9]=a("th",{class:"actions-header"},"Acciones",-1))])]),a("tbody",null,[R(c.$slots,"rows",{},void 0,!0)])]),_:3}),a("div",he,[t(Y,{modelValue:g.page,"onUpdate:modelValue":[l[3]||(l[3]=y=>g.page=y),l[4]||(l[4]=y=>u("update:page",y))],length:Math.ceil((((o=g.items)==null?void 0:o.length)||1)/g.itemsPerPage),"total-visible":"7",color:"primary"},null,8,["modelValue","length"])])])}}},ke=T(we,[["__scopeId","data-v-c7ddbf3b"]]),Ve={class:"d-flex align-center mb-1",style:{"justify-content":"space-between"}},Ce={class:"text-caption",style:{"margin-right":"8px"}},$e={class:"font-weight-medium mb-1"},De={class:"text-caption"},Fe=["onClick"],Pe={class:"folio-cell"},Se={class:"name-cell"},Le={class:"answers-cell"},Me={class:"date-cell"},Be={key:1},Re={__name:"ReportsView",props:{items:Array,isMobile:Boolean},setup(w){const s=w,g=Z(),u=_("folio"),c=_(!1),l=_(1),o=_(10),y=f=>{u.value===f?c.value=!c.value:(u.value=f,c.value=!1)},U=f=>f?new Date(f).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"—",M=D(()=>[...s.items].sort((f,r)=>{var m,I;const k=((m=f[u.value])==null?void 0:m.toString().toLowerCase())??"",n=((I=r[u.value])==null?void 0:I.toString().toLowerCase())??"";return k.localeCompare(n)*(c.value?-1:1)})),F=D(()=>{const f=(l.value-1)*o.value;return M.value.slice(f,f+o.value)}),B=f=>{g.push({name:"Show Response",params:{id:f.id}})};return(f,r)=>{const k=ee("router-link");return v(),h("div",null,[w.isMobile?(v(),h(N,{key:0},[F.value.length?(v(!0),h(N,{key:0},j(F.value,n=>(v(),V(z,{key:n.id,class:"mb-4 pa-3 elevation-1 rounded-lg row-clickable",onClick:m=>B(n),style:{cursor:"pointer"}},{default:e(()=>[t(P,{"no-gutters":"",align:"center",class:"mb-1"},{default:e(()=>[t(C,{cols:"12"},{default:e(()=>[a("div",Ve,[a("div",Ce,[t(k,{to:`/formulario/${n.id}`,onClick:r[0]||(r[0]=E(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:e(()=>[d(b(n.folio),1)]),_:2},1032,["to"])])]),a("div",$e,b(n.name),1),a("div",De,[r[4]||(r[4]=a("strong",null,"Creado:",-1)),d(" "+b(U(n.created_at)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(v(),V(z,{key:1,class:"mb-4 pa-4 elevation-1 rounded-lg text-center"},{default:e(()=>r[5]||(r[5]=[a("div",{class:"font-weight-bold mb-2",style:{"font-size":"1.5rem"}},"Cargando formularios...",-1)])),_:1}))],64)):S("",!0),w.isMobile?S("",!0):(v(),V(ke,{key:1,items:M.value,page:l.value,itemsPerPage:o.value,sortBy:u.value,sortDesc:c.value,"onUpdate:page":r[3]||(r[3]=n=>l.value=n),onSort:y},{"sort-icon":e(({column:n})=>[u.value===n?(v(),V(L,{key:0,size:"16",class:"ml-1"},{default:e(()=>[d(b(c.value?$(ve):$(fe)),1)]),_:1})):S("",!0)]),rows:e(()=>[F.value.length?(v(!0),h(N,{key:0},j(F.value,n=>(v(),h("tr",{key:n.id,onClick:m=>B(n),class:"row-clickable",style:{cursor:"pointer"}},[a("td",Pe,[t(k,{to:`/formulario/${n.id}`,onClick:r[1]||(r[1]=E(()=>{},["stop"])),style:{"text-decoration":"underline"}},{default:e(()=>[d(b(n.folio),1)]),_:2},1032,["to"])]),a("td",Se,b(n.name),1),a("td",Le,b(n.responses.length),1),a("td",Me,b(U(n.created_at)),1),a("td",{class:"actions-cell",onClick:r[2]||(r[2]=E(()=>{},["stop"]))},[t(W,{location:"bottom end"},{activator:e(({props:m})=>[t(q,Q({ref_for:!0},m,{variant:"text",class:"pa-0","min-width":"0",height:"24"}),{default:e(()=>[t(L,{icon:$(pe),size:"20"},null,8,["icon"])]),_:2},1040)]),default:e(()=>[t(te,{class:"custom-dropdown elevation-1 rounded-lg",style:{"min-width":"200px"}},{default:e(()=>[t(se,{onClick:m=>B(n)},{prepend:e(()=>[t(L,{icon:$(me),size:"18"},null,8,["icon"])]),default:e(()=>[t(ae,null,{default:e(()=>r[6]||(r[6]=[d("Ver")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])],8,Fe))),128)):(v(),h("tr",Be,r[7]||(r[7]=[a("td",{colspan:5,class:"text-center py-8"},[a("div",{class:"font-weight-bold mb-2",style:{"font-size":"1.5rem"}},"Cargando formularios...")],-1)])))]),_:1},8,["items","page","itemsPerPage","sortBy","sortDesc"]))])}}},Ue=T(Re,[["__scopeId","data-v-d40e8c44"]]),Ie={class:"d-flex justify-space-between align-center mb-2"},ze={class:"text-h4 font-weight-bold text-success"},Te={class:"text-h4 font-weight-bold text-primary"},Ae={class:"text-body-2 text-grey-darken-1"},Ne={__name:"ReportCards",props:{items:{type:Array}},setup(w){const s=w;console.log(s.items);const g=D(()=>!s.items||s.items.length===0?[]:s.items.map(o=>o.responses.length).reduce((o,y)=>o+y,0)),u=D(()=>!s.items||s.items.length===0?[]:s.items.map(o=>o.assignments.length).reduce((o,y)=>o+y,0)),c=D(()=>g.value===0?0:Math.round(g.value/u.value*100));return(l,o)=>(v(),h("div",null,[t(P,null,{default:e(()=>[t(C,{cols:"12",md:"6"},{default:e(()=>[t(z,{class:"h-100"},{default:e(()=>[t(K,{class:"d-flex align-center"},{default:e(()=>[t(L,{class:"mr-2",color:"primary"},{default:e(()=>o[0]||(o[0]=[d("mdi-account-group")])),_:1}),o[1]||(o[1]=d(" Respuestas "))]),_:1}),t(O,{class:"text-center"},{default:e(()=>[a("div",Ie,[a("div",null,[a("div",ze,b(g.value),1),o[2]||(o[2]=a("div",{class:"text-caption text-grey-darken-1"},"Actuales",-1))]),t(L,{class:"mx-4",color:"grey"},{default:e(()=>o[3]||(o[3]=[d("mdi-arrow-right")])),_:1}),a("div",null,[a("div",Te,b(u.value),1),o[4]||(o[4]=a("div",{class:"text-caption text-grey-darken-1"},"Esperadas",-1))])]),t(le,{"model-value":c.value,color:"success",height:"8",rounded:"",class:"mb-2"},null,8,["model-value"]),a("div",Ae,b(c.value)+"% completado",1)]),_:1})]),_:1})]),_:1}),t(C,{cols:"12",md:"6"},{default:e(()=>[t(z,{class:"h-100"},{default:e(()=>[t(K,null,{default:e(()=>[t(L,{class:"mr-2",color:"primary"},{default:e(()=>o[5]||(o[5]=[d("mdi-account-group")])),_:1}),o[6]||(o[6]=d(" Usuarios que han respondido "))]),_:1}),t(O,null,{default:e(()=>[d(b(u.value),1)]),_:1})]),_:1})]),_:1})]),_:1})]))}},Ee=T(Ne,[["__scopeId","data-v-c5e06293"]]),qe={class:"d-flex align-center mb-2",style:{gap:"16px"}},je={key:0,class:"d-flex align-center gap-2 mb-3"},Ke={__name:"ReportsTab",setup(w){const s=_({search:"",folio:"",date:null}),g=_(!1),u=oe(),c=_(!1),l=()=>{c.value=window.innerWidth<768};D(()=>{var p,i,x;return((x=(i=(p=u.user)==null?void 0:p.roles)==null?void 0:i[0])==null?void 0:x.id)||null});const o=D(()=>s.value.search||s.value.date),y=p=>p?new Date(p).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"",U=()=>{s.value.search="",m()},M=()=>{s.value.date=null,m()},F=()=>{s.value.search="",s.value.date=null,r.value=1,m()},B=p=>{g.value=!1},f=()=>{r.value=1,m()};G(()=>u.permissions,p=>{p.length>0&&console.log("Permisos cargados",p)},{immediate:!0});const r=_(1),k=_({data:[],last_page:1}),n=_(!1),m=async()=>{n.value=!0;try{const p={search:s.value.search,page:r.value};if(s.value.date){const A=new Date(s.value.date).toISOString().split("T")[0];p.created_at=A}const i=await ce.get("/forms/responses/all");k.value=i.data,console.log("Formularios filtrados:",{total:i.data.total,fecha:s.value.date,params:p})}catch(p){console.error("Failed to fetch forms",p)}finally{n.value=!1}};ne(()=>{m(),l(),window.addEventListener("resize",l)});const I=xe(()=>{s.value.search!==""&&(r.value=1,m())},400);return G(()=>s.value.search,p=>{p===""?(r.value=1,m()):I()}),re(()=>{window.removeEventListener("resize",l)}),(p,i)=>(v(),V(P,null,{default:e(()=>[t(ue,{fluid:"",class:"pa-0"},{default:e(()=>[t(P,{align:"center",justify:"space-between",class:"ma-0 px-3 py-2"},{default:e(()=>[t(C,{cols:"auto",class:"pa-0 d-flex align-center"},{default:e(()=>i[4]||(i[4]=[a("h1",{class:"text-h4 text-md-h3 font-weight-bold ma-0"},"Reportes",-1)])),_:1})]),_:1}),t(P,{class:"px-3"},{default:e(()=>[t(C,{cols:"12",md:"12"},{default:e(()=>[t(C,{cols:"12",class:"pa-0"},{default:e(()=>[a("div",qe,[t(H,{modelValue:s.value.search,"onUpdate:modelValue":i[0]||(i[0]=x=>s.value.search=x),placeholder:"Buscar por Nombre o Folio",clearable:"",density:"compact",variant:"outlined","hide-details":"",style:{"min-width":"220px"},onKeyup:ie(m,["enter"]),"prepend-inner-icon":$(ge),class:"flex-grow-1"},null,8,["modelValue","prepend-inner-icon"]),t(W,{modelValue:g.value,"onUpdate:modelValue":i[3]||(i[3]=x=>g.value=x),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:e(({props:x})=>[t(H,Q(x,{modelValue:s.value.date,"onUpdate:modelValue":i[1]||(i[1]=A=>s.value.date=A),placeholder:"Filtrar por fecha","prepend-inner-icon":$(ye),readonly:"",clearable:"",density:"compact",variant:"outlined","hide-details":"",style:{"min-width":"220px"},"onClick:clear":M}),null,16,["modelValue","prepend-inner-icon"])]),default:e(()=>[t(de,{modelValue:s.value.date,"onUpdate:modelValue":[i[2]||(i[2]=x=>s.value.date=x),B],max:new Date().toISOString().substr(0,10),locale:"es"},null,8,["modelValue","max"])]),_:1},8,["modelValue"]),t(q,{color:"primary",variant:"flat",onClick:f,loading:n.value,"prepend-icon":$(be)},{default:e(()=>i[5]||(i[5]=[d(" Filtrar ")])),_:1},8,["loading","prepend-icon"])]),o.value?(v(),h("div",je,[i[7]||(i[7]=a("span",{class:"text-caption text-grey"},"Filtros activos:",-1)),s.value.search?(v(),V(J,{key:0,closable:"",size:"small",color:"primary",variant:"outlined","onClick:close":U},{default:e(()=>[d(" Búsqueda: "+b(s.value.search),1)]),_:1})):S("",!0),s.value.date?(v(),V(J,{key:1,closable:"",size:"small",color:"primary",variant:"outlined","onClick:close":M},{default:e(()=>[d(" Fecha: "+b(y(s.value.date)),1)]),_:1})):S("",!0),t(q,{size:"small",variant:"text",color:"error",onClick:F},{default:e(()=>i[6]||(i[6]=[d(" Limpiar todos ")])),_:1})])):S("",!0)]),_:1}),t(Ue,{items:k.value.data,isMobile:c.value,isLoading:n.value,onFormUpdated:m},null,8,["items","isMobile","isLoading"])]),_:1})]),_:1}),t(P,{class:"mb-4 px-3"},{default:e(()=>[t(C,{cols:"12"},{default:e(()=>[t(Ee,{items:k.value.data},null,8,["items"])]),_:1})]),_:1})]),_:1})]),_:1}))}},Je=T(Ke,[["__scopeId","data-v-adce3c77"]]);export{Je as default};
